<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.550">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Applied Machine Learning Using mlr3 in R - 2&nbsp; Data and Basic Modeling</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../chapters/chapter3/evaluation_and_benchmarking.html" rel="next">
<link href="../../chapters/chapter1/introduction_and_overview.html" rel="prev">
<link href="../../Figures/favicon.ico" rel="icon">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><style>html{ scroll-behavior: smooth; }</style>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>
</head>
<body class="nav-sidebar floating slimcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../chapters/chapter2/data_and_basic_modeling.html">Fundamentals</a></li><li class="breadcrumb-item"><a href="../../chapters/chapter2/data_and_basic_modeling.html"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Data and Basic Modeling</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../../">Applied Machine Learning Using mlr3 in R</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/mlr-org/mlr3book/tree/main/book/" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <a href="../../Applied-Machine-Learning-Using-mlr3-in-R.pdf" title="Download PDF" class="quarto-navigation-tool px-1" aria-label="Download PDF"><i class="bi bi-file-pdf"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Getting Started</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/chapter1/introduction_and_overview.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction and Overview</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Fundamentals</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/chapter2/data_and_basic_modeling.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Data and Basic Modeling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/chapter3/evaluation_and_benchmarking.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Evaluation and Benchmarking</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false">
 <span class="menu-text">Tuning and Feature Selection</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/chapter4/hyperparameter_optimization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Hyperparameter Optimization</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/chapter5/advanced_tuning_methods_and_black_box_optimization.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Advanced Tuning Methods and Black Box Optimization</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/chapter6/feature_selection.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Feature Selection</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false">
 <span class="menu-text">Pipelines and Preprocessing</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/chapter7/sequential_pipelines.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Sequential Pipelines</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/chapter8/non-sequential_pipelines_and_tuning.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Non-sequential Pipelines and Tuning</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/chapter9/preprocessing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Preprocessing</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="false">
 <span class="menu-text">Advanced Topics</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/chapter10/advanced_technical_aspects_of_mlr3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Advanced Technical Aspects of mlr3</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/chapter11/large-scale_benchmarking.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Large-Scale Benchmarking</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/chapter12/model_interpretation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Model Interpretation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/chapter13/beyond_regression_and_classification.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Beyond Regression and Classification</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/chapter14/algorithmic_fairness.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Algorithmic Fairness</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">References</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="false">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 ">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/appendices/solutions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Solutions to exercises</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/appendices/tasks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Tasks</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/appendices/overview-tables.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">C</span>&nbsp; <span class="chapter-title">Overview Tables</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/appendices/errata.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">D</span>&nbsp; <span class="chapter-title">Errata</span></span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li>
<a href="#sec-tasks" id="toc-sec-tasks" class="nav-link active" data-scroll-target="#sec-tasks"><span class="header-section-number">2.1</span> Tasks</a>
  <ul class="collapse">
<li><a href="#sec-tasks-built-in" id="toc-sec-tasks-built-in" class="nav-link" data-scroll-target="#sec-tasks-built-in"><span class="header-section-number">2.1.1</span> Constructing Tasks</a></li>
  <li><a href="#sec-retrieve-data" id="toc-sec-retrieve-data" class="nav-link" data-scroll-target="#sec-retrieve-data"><span class="header-section-number">2.1.2</span> Retrieving Data</a></li>
  <li><a href="#sec-tasks-mutators" id="toc-sec-tasks-mutators" class="nav-link" data-scroll-target="#sec-tasks-mutators"><span class="header-section-number">2.1.3</span> Task Mutators</a></li>
  </ul>
</li>
  <li>
<a href="#sec-learners" id="toc-sec-learners" class="nav-link" data-scroll-target="#sec-learners"><span class="header-section-number">2.2</span> Learners</a>
  <ul class="collapse">
<li><a href="#sec-training" id="toc-sec-training" class="nav-link" data-scroll-target="#sec-training"><span class="header-section-number">2.2.1</span> Training</a></li>
  <li><a href="#sec-predicting" id="toc-sec-predicting" class="nav-link" data-scroll-target="#sec-predicting"><span class="header-section-number">2.2.2</span> Predicting</a></li>
  <li><a href="#sec-param-set" id="toc-sec-param-set" class="nav-link" data-scroll-target="#sec-param-set"><span class="header-section-number">2.2.3</span> Hyperparameters</a></li>
  <li><a href="#sec-basics-featureless" id="toc-sec-basics-featureless" class="nav-link" data-scroll-target="#sec-basics-featureless"><span class="header-section-number">2.2.4</span> Baseline Learners</a></li>
  </ul>
</li>
  <li>
<a href="#sec-eval" id="toc-sec-eval" class="nav-link" data-scroll-target="#sec-eval"><span class="header-section-number">2.3</span> Evaluation</a>
  <ul class="collapse">
<li><a href="#measures" id="toc-measures" class="nav-link" data-scroll-target="#measures"><span class="header-section-number">2.3.1</span> Measures</a></li>
  <li><a href="#scoring-predictions" id="toc-scoring-predictions" class="nav-link" data-scroll-target="#scoring-predictions"><span class="header-section-number">2.3.2</span> Scoring Predictions</a></li>
  <li><a href="#sec-basics-measures-tech" id="toc-sec-basics-measures-tech" class="nav-link" data-scroll-target="#sec-basics-measures-tech"><span class="header-section-number">2.3.3</span> Technical Measures</a></li>
  </ul>
</li>
  <li><a href="#sec-basics-regr-experiment" id="toc-sec-basics-regr-experiment" class="nav-link" data-scroll-target="#sec-basics-regr-experiment"><span class="header-section-number">2.4</span> Our First Regression Experiment</a></li>
  <li>
<a href="#sec-classif" id="toc-sec-classif" class="nav-link" data-scroll-target="#sec-classif"><span class="header-section-number">2.5</span> Classification</a>
  <ul class="collapse">
<li><a href="#sec-basics-classif-experiment" id="toc-sec-basics-classif-experiment" class="nav-link" data-scroll-target="#sec-basics-classif-experiment"><span class="header-section-number">2.5.1</span> Our First Classification Experiment</a></li>
  <li><a href="#taskclassif" id="toc-taskclassif" class="nav-link" data-scroll-target="#taskclassif"><span class="header-section-number">2.5.2</span> TaskClassif</a></li>
  <li><a href="#sec-basics-classif-learner" id="toc-sec-basics-classif-learner" class="nav-link" data-scroll-target="#sec-basics-classif-learner"><span class="header-section-number">2.5.3</span> LearnerClassif and MeasureClassif</a></li>
  <li><a href="#sec-classif-prediction" id="toc-sec-classif-prediction" class="nav-link" data-scroll-target="#sec-classif-prediction"><span class="header-section-number">2.5.4</span> <code>PredictionClassif</code>, Confusion Matrix, and Thresholding</a></li>
  </ul>
</li>
  <li><a href="#sec-row-col-roles" id="toc-sec-row-col-roles" class="nav-link" data-scroll-target="#sec-row-col-roles"><span class="header-section-number">2.6</span> Task Column Roles</a></li>
  <li><a href="#sec-lrns-add" id="toc-sec-lrns-add" class="nav-link" data-scroll-target="#sec-lrns-add"><span class="header-section-number">2.7</span> Supported Learning Algorithms</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion"><span class="header-section-number">2.8</span> Conclusion</a></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises"><span class="header-section-number">2.9</span> Exercises</a></li>
  <li><a href="#citation" id="toc-citation" class="nav-link" data-scroll-target="#citation"><span class="header-section-number">2.10</span> Citation</a></li>
  </ul><div class="toc-actions"><ul><li><a href="https://github.com/mlr-org/mlr3book/edit/main/book/chapters/chapter2/data_and_basic_modeling.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/mlr-org/mlr3book/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li><li><a href="https://github.com/mlr-org/mlr3book/blob/main/book/chapters/chapter2/data_and_basic_modeling.qmd" class="toc-action"><i class="bi empty"></i>View source</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../chapters/chapter2/data_and_basic_modeling.html">Fundamentals</a></li><li class="breadcrumb-item"><a href="../../chapters/chapter2/data_and_basic_modeling.html"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Data and Basic Modeling</span></a></li></ol></nav><div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span id="sec-basics" class="quarto-section-identifier"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Data and Basic Modeling</span></span></h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><p><strong>Natalie Foss</strong> <br><em>University of Wyoming</em></p>
<p><strong>Lars Kotthoff</strong> <br><em>University of Wyoming</em> <br><br></p>
<p>In this chapter, we will introduce the <a href="https://mlr3.mlr-org.com"><code>mlr3</code></a> objects and corresponding <a href="https://cran.r-project.org/package=R6"><code>R6</code></a> classes that implement the essential building blocks of machine learning. These building blocks include the data (and the methods for creating training and test sets), the machine learning algorithm (and its training and prediction process), the configuration of a machine learning algorithm through its hyperparameters, and evaluation measures to assess the quality of predictions.</p>
<div class="page-columns page-full"><p>In the simplest definition, machine learning (ML) is the process of learning models of relationships from data. Supervised learning is a subfield of ML in which datasets consist of labeled observations, which means that each data point consists of features, which are variables to make predictions from, and a target, which is the quantity that we are trying to predict. For example, predicting a car’s miles per gallon (target) based on the car’s properties (features) such as horsepower and the number of gears is a supervised learning problem, which we will return to several times in this book. In <code>mlr3</code>, we refer to datasets, and their associated metadata as tasks (<a href="#sec-tasks" class="quarto-xref"><span>Section 2.1</span></a>). The term ‘task’ is used to refer to the prediction problem that we are trying to solve. Tasks are defined by the features used for prediction and the targets to predict, so there can be multiple tasks associated with any given dataset. For example, predicting miles per gallon (mpg) from horsepower is one task, predicting horsepower from mpg is another task, and predicting the number of gears from the car’s model is yet another task.</p><div class="no-row-height column-margin column-container"><span class="margin-aside">Machine Learning/Supervised Learning</span></div></div>
<div class="page-columns page-full"><p>Supervised learning can be further divided into regression – which is the prediction of numeric target values, e.g.&nbsp;predicting a car’s mpg – and classification – which is the prediction of categorical values/labels, e.g., predicting a car’s model. <a href="../chapter13/beyond_regression_and_classification.html" class="quarto-xref"><span>Chapter 13</span></a> also discusses other tasks, including cost-sensitive classification and unsupervised learning. For any supervised learning task, the goal is to build a model that captures the relationship between the features and target, often with the goal of training the model to learn relationships about the data so it can make predictions for new and previously unseen data. A model is formally a mapping from a feature vector to a prediction. A prediction can take many forms depending on the task; for example, in classification this can be a predicted label, or a set of predicted probabilities or scores. Models are induced by passing training data to machine learning algorithms, such as decision trees, support vector machines, neural networks, and many more. Machine learning algorithms are called learners in <code>mlr3</code> (<a href="#sec-learners" class="quarto-xref"><span>Section 2.2</span></a>) as, given data, they learn models. Each learner has a parameterized space that potential models are drawn from and during the training process, these parameters are fitted to best match the data. For example, the parameters could be the coefficients used for individual features when training a linear regression model. During training, most machine learning algorithms are ‘fitted’/‘trained’ by optimizing a loss-function that quantifies the mismatch between ground truth target values in the training data and the predictions of the model.</p><div class="no-row-height column-margin column-container"><span class="margin-aside">Regression</span><span class="margin-aside">Classification</span><span class="margin-aside">Model</span><span class="margin-aside">Learners</span></div></div>
<div class="page-columns page-full"><p>For a model to be most useful, it should generalize beyond the training data to make ‘good’ predictions (<a href="#sec-predicting" class="quarto-xref"><span>Section 2.2.2</span></a>) on new and previously ‘unseen’ (by the model) data. The simplest way to test this, is to split data into training data and test data – where the model is trained on the training data and then the separate test data is used to evaluate models in an unbiased way by assessing to what extent the model has learned the true relationships that underlie the data (<a href="../chapter3/evaluation_and_benchmarking.html" class="quarto-xref"><span>Chapter 3</span></a>). This evaluation procedure estimates a model’s generalization error, i.e., how well we expect the model to perform in general. There are many ways to evaluate models and to split data for estimating generalization error (<a href="../chapter3/evaluation_and_benchmarking.html#sec-resampling" class="quarto-xref"><span>Section 3.2</span></a>).</p><div class="no-row-height column-margin column-container"><span class="margin-aside">Train/Test Data</span><span class="margin-aside">Generalization Error</span></div></div>
<p>This brief overview of ML provides the basic knowledge required to use <code>mlr3</code> and is summarized in <a href="#fig-ml-abstraction-basics" class="quarto-xref">Figure&nbsp;<span>2.1</span></a>. In the rest of this book, we will provide introductions to methodology when relevant. For texts about ML, including detailed methodology and underpinnings of different algorithms, we recommend <span class="citation" data-cites="hastie2001">Hastie, Friedman, and Tibshirani (<a href="../references.html#ref-hastie2001" role="doc-biblioref">2001</a>)</span>, <span class="citation" data-cites="james_introduction_2014">James et al. (<a href="../references.html#ref-james_introduction_2014" role="doc-biblioref">2014</a>)</span>, and <span class="citation" data-cites="bishop_2006">Bishop (<a href="../references.html#ref-bishop_2006" role="doc-biblioref">2006</a>)</span>.</p>
<p>In the next few sections we will look at the building blocks of <code>mlr3</code> using regression as an example, we will then consider how to extend this to classification in <a href="#sec-classif" class="quarto-xref"><span>Section 2.5</span></a>.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-ml-abstraction-basics" class="quarto-figure quarto-figure-center quarto-float anchored" alt="A flowchart starting with the 'Data D' with two arrows to 'Dtrain' and 'Dtest'. 'Dtrain' has an arrow to 'Learner', which has an arrow to 'Model'. 'Dtest' has an arrow (labeled with 'Features') to 'Model' and an arrow (labeled with 'Labels') to 'Measure'. The 'Model' box has an arrow to 'Prediction', which has an arrow to 'Measure', which has an arrow to 'Performance'. The whole flowchart has curly brackets next to it that says 'Repeat = Resampling'.">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-ml-abstraction-basics-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Figures/mlr3book_figures-1.svg" class="img-fluid figure-img" style="width:100.0%" alt="A flowchart starting with the 'Data D' with two arrows to 'Dtrain' and 'Dtest'. 'Dtrain' has an arrow to 'Learner', which has an arrow to 'Model'. 'Dtest' has an arrow (labeled with 'Features') to 'Model' and an arrow (labeled with 'Labels') to 'Measure'. The 'Model' box has an arrow to 'Prediction', which has an arrow to 'Measure', which has an arrow to 'Performance'. The whole flowchart has curly brackets next to it that says 'Repeat = Resampling'.">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-ml-abstraction-basics-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.1: General overview of the machine learning process.
</figcaption></figure>
</div>
</div>
</div>
<section id="sec-tasks" class="level2 page-columns page-full" data-number="2.1"><h2 data-number="2.1" class="anchored" data-anchor-id="sec-tasks">
<span class="header-section-number">2.1</span> Tasks</h2>
<p>Tasks are objects that contain the (usually tabular) data and additional metadata that define a machine learning problem. The metadata contain, for example, the name of the target feature for supervised machine learning problems. This information is extracted automatically when required, so the user does not have to specify the prediction target every time a model is trained.</p>
<section id="sec-tasks-built-in" class="level3 page-columns page-full" data-number="2.1.1"><h3 data-number="2.1.1" class="anchored" data-anchor-id="sec-tasks-built-in">
<span class="header-section-number">2.1.1</span> Constructing Tasks</h3>
<div class="page-columns page-full"><p><code>mlr3</code> includes a few predefined machine learning tasks in the <a href="https://mlr3.mlr-org.com/reference/mlr_tasks.html"><code>mlr_tasks</code></a> <code>Dictionary</code>.</p><div class="no-row-height column-margin column-container"><span class="margin-aside"><code>mlr_tasks</code></span></div></div>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">mlr_tasks</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;DictionaryTask&gt; with 21 stored values
Keys: ames_housing, bike_sharing, boston_housing, breast_cancer,
  german_credit, ilpd, iris, kc_housing, moneyball, mtcars,
  optdigits, penguins, penguins_simple, pima, ruspini, sonar,
  spam, titanic, usarrests, wine, zoo</code></pre>
</div>
</div>
<div class="page-columns page-full"><p>To get a task from the dictionary, use the <a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html"><code>tsk()</code></a> function and assign the return value to a new variable. Below we retrieve <code>tsk("mtcars")</code>, which uses the <a href="https://www.rdocumentation.org/packages/datasets/topics/mtcars"><code>mtcars</code></a> dataset:</p><div class="no-row-height column-margin column-container"><span class="margin-aside"><code><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">tsk()</a></code></span></div></div>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tsk_mtcars</span> <span class="op">=</span> <span class="fu">tsk</span><span class="op">(</span><span class="st">"mtcars"</span><span class="op">)</span></span>
<span><span class="va">tsk_mtcars</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;TaskRegr:mtcars&gt; (32 x 11): Motor Trends
* Target: mpg
* Properties: -
* Features (10):
  - dbl (10): am, carb, cyl, disp, drat, gear, hp, qsec, vs, wt</code></pre>
</div>
</div>
<p>Running <code><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">tsk()</a></code> without any arguments will list all the tasks in the dictionary, this also works for all other sugar constructors that you will encounter throughout the book.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Help Pages
</div>
</div>
<div class="callout-body-container callout-body">
<p>Usually in R, the help pages of functions can be queried with <code>?</code>. The same is true of R6 classes, so if you want to find the help page of the <code>mtcars</code> task you could use <code><a href="https://mlr3.mlr-org.com/reference/mlr_tasks_mtcars.html">?mlr_tasks_mtcars</a></code>. We have also added a <code>$help()</code> method to many of our classes, which allows you to access the help page from any instance of that class, for example: <code>tsk("mtcars")$help()</code>.</p>
</div>
</div>
<div class="page-columns page-full"><p>To create your own regression task, you will need to construct a new instance of <a href="https://mlr3.mlr-org.com/reference/TaskRegr.html"><code>TaskRegr</code></a>. The simplest way to do this is with the function <a href="https://mlr3.mlr-org.com/reference/as_task_regr.html"><code>as_task_regr()</code></a> to convert a <code>data.frame</code> type object to a regression task, specifying the target feature by passing this to the <code>target</code> argument. By example, we will ignore that <code>mtcars</code> is already available as a predefined task in <code>mlr3</code>. In the code below we load the <code><a href="https://rdrr.io/r/datasets/mtcars.html">datasets::mtcars</a></code> dataset, subset the data to only include columns <code>"mpg"</code>, <code>"cyl"</code>, <code>"disp"</code>, print the modified data’s properties, and then set up a regression task called <code>"cars"</code> (<code>id = "cars"</code>) in which we will try to predict miles per gallon (<code>target = "mpg"</code>) from the number of cylinders (<code>"cyl"</code>) and displacement (<code>"disp"</code>):</p><div class="no-row-height column-margin column-container"><span class="margin-aside"><code>TaskRegr</code></span><span class="margin-aside"><code><a href="https://mlr3.mlr-org.com/reference/as_task_regr.html">as_task_regr()</a></code></span></div></div>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"mtcars"</span>, package <span class="op">=</span> <span class="st">"datasets"</span><span class="op">)</span></span>
<span><span class="va">mtcars_subset</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">mtcars</span>, select <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"mpg"</span>, <span class="st">"cyl"</span>, <span class="st">"disp"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">mtcars_subset</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   32 obs. of  3 variables:
 $ mpg : num  21 21 22.8 21.4 18.7 18.1 14.3 24.4 22.8 19.2 ...
 $ cyl : num  6 6 4 6 8 6 8 4 4 6 ...
 $ disp: num  160 160 108 258 360 ...</code></pre>
</div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tsk_mtcars</span> <span class="op">=</span> <span class="fu">as_task_regr</span><span class="op">(</span><span class="va">mtcars_subset</span>, target <span class="op">=</span> <span class="st">"mpg"</span>, id <span class="op">=</span> <span class="st">"cars"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The data can be in any tabular format, e.g.&nbsp;a <code><a href="https://rdrr.io/r/base/data.frame.html">data.frame()</a></code>, <code>data.table()</code>, or <code>tibble()</code>. The <code>target</code> argument specifies the prediction target column. The <code>id</code> argument is optional and specifies an identifier for the task that is used in plots and summaries; if omitted the variable name of the data will be used as the <code>id</code>.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
UTF8 Column Names
</div>
</div>
<div class="callout-body-container callout-body">
<p>As many machine learning models do not work properly with arbitrary UTF8 names, <code>mlr3</code> defaults to throwing an error if any of the column names passed to <a href="https://mlr3.mlr-org.com/reference/as_task_regr.html"><code>as_task_regr()</code></a> (and other task constructors) contain a non-ASCII character or do not comply with R’s variable naming scheme. Therefore, we recommend converting names with <a href="https://www.rdocumentation.org/packages/base/topics/make.names"><code>make.names()</code></a> if possible. You can bypass this check by setting <code>options(mlr3.allow_utf8_names = TRUE)</code> (but do not be surprised if errors occur later, especially when passing objects to other packages).</p>
</div>
</div>
<p>Printing a task provides a summary and in this case, we can see the task has 32 observations and 3 columns (32 x 3), of which <code>mpg</code> is the target, there are no special properties (<code>Properties: -</code>), and there are 2 features stored in double-precision floating point format.</p>
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tsk_mtcars</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;TaskRegr:cars&gt; (32 x 3)
* Target: mpg
* Properties: -
* Features (2):
  - dbl (2): cyl, disp</code></pre>
</div>
</div>
<p>We can plot the task using the <a href="https://mlr3viz.mlr-org.com"><code>mlr3viz</code></a> package, which gives a graphical summary of the distribution of the target and feature values:</p>
<div class="cell">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://mlr3viz.mlr-org.com">mlr3viz</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">tsk_mtcars</span>, type <span class="op">=</span> <span class="st">"pairs"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="sec-retrieve-data" class="level3" data-number="2.1.2"><h3 data-number="2.1.2" class="anchored" data-anchor-id="sec-retrieve-data">
<span class="header-section-number">2.1.2</span> Retrieving Data</h3>
<p>We have looked at how to create tasks to store data and metadata, now we will look at how to retrieve the stored data.</p>
<p>Various fields can be used to retrieve metadata about a task. The dimensions, for example, can be retrieved using <code>$nrow</code> and <code>$ncol</code>:</p>
<div class="cell">
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">tsk_mtcars</span><span class="op">$</span><span class="va">nrow</span>, <span class="va">tsk_mtcars</span><span class="op">$</span><span class="va">ncol</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 32  3</code></pre>
</div>
</div>
<p>The names of the feature and target columns are stored in the <code>$feature_names</code> and <code>$target_names</code> slots, respectively.</p>
<div class="cell">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>Features <span class="op">=</span> <span class="va">tsk_mtcars</span><span class="op">$</span><span class="va">feature_names</span>,</span>
<span>  Target <span class="op">=</span> <span class="va">tsk_mtcars</span><span class="op">$</span><span class="va">target_names</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Features1 Features2    Target 
    "cyl"    "disp"     "mpg" </code></pre>
</div>
</div>
<p>The columns of a task have unique <code>character</code>-valued names and the rows are identified by unique natural numbers, called row IDs. They can be accessed through the <code>$row_ids</code> field:</p>
<div class="cell">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">tsk_mtcars</span><span class="op">$</span><span class="va">row_ids</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1 2 3 4 5 6</code></pre>
</div>
</div>
<p>Row IDs are not used as features when training or predicting but are metadata that allow access to individual observations. Note that row IDs are not the same as row numbers. This is best demonstrated by example, below we create a regression task from random data, print the original row IDs, which correspond to row numbers 1-5, then we filter three rows (we will return to this method just below) and print the new row IDs, which no longer correspond to the row numbers.</p>
<div class="cell">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">task</span> <span class="op">=</span> <span class="fu">as_task_regr</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  target <span class="op">=</span> <span class="st">"y"</span><span class="op">)</span></span>
<span><span class="va">task</span><span class="op">$</span><span class="va">row_ids</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1 2 3 4 5</code></pre>
</div>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">task</span><span class="op">$</span><span class="fu">filter</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">task</span><span class="op">$</span><span class="va">row_ids</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1 3 4</code></pre>
</div>
</div>
<p>This design decision allows tasks and learners to transparently operate on real database management systems, where primary keys are required to be unique, but not necessarily consecutive. See <a href="../chapter10/advanced_technical_aspects_of_mlr3.html#sec-backends" class="quarto-xref"><span>Section 10.4</span></a> for more information on using databases as data backends for tasks</p>
<p>The data contained in a task can be accessed through <code>$data()</code>, which returns a <a href="https://www.rdocumentation.org/packages/data.table/topics/data.table-package"><code>data.table</code></a> object. This method has optional <code>rows</code> and <code>cols</code> arguments to specify subsets of the data to retrieve.</p>
<div class="cell">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># retrieve all data</span></span>
<span><span class="va">tsk_mtcars</span><span class="op">$</span><span class="fu">data</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     mpg cyl  disp
 1: 21.0   6 160.0
 2: 21.0   6 160.0
 3: 22.8   4 108.0
 4: 21.4   6 258.0
 5: 18.7   8 360.0
---               
28: 30.4   4  95.1
29: 15.8   8 351.0
30: 19.7   6 145.0
31: 15.0   8 301.0
32: 21.4   4 121.0</code></pre>
</div>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># retrieve data for rows with IDs 1, 5, and 10 and all feature columns</span></span>
<span><span class="va">tsk_mtcars</span><span class="op">$</span><span class="fu">data</span><span class="op">(</span>rows <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span>, <span class="fl">10</span><span class="op">)</span>, cols <span class="op">=</span> <span class="va">tsk_mtcars</span><span class="op">$</span><span class="va">feature_names</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   cyl  disp
1:   6 160.0
2:   8 360.0
3:   6 167.6</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Accessing Rows by Number
</div>
</div>
<div class="callout-body-container callout-body">
<p>You can work with row numbers instead of row IDs by using the <code>$row_ids</code> field to extract the row ID corresponding to a given row number:</p>
<div class="cell">
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># select the 2nd row of the task by extracting the second row_id:</span></span>
<span><span class="va">tsk_mtcars</span><span class="op">$</span><span class="fu">data</span><span class="op">(</span>rows <span class="op">=</span> <span class="va">task</span><span class="op">$</span><span class="va">row_ids</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<p>You can always use ‘standard’ R methods to extract summary data from a task, for example, to summarize the underlying data:</p>
<div class="cell">
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="fu">as.data.table</span><span class="op">(</span><span class="va">tsk_mtcars</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      mpg            cyl            disp      
 Min.   :10.4   Min.   :4.00   Min.   : 71.1  
 1st Qu.:15.4   1st Qu.:4.00   1st Qu.:120.8  
 Median :19.2   Median :6.00   Median :196.3  
 Mean   :20.1   Mean   :6.19   Mean   :230.7  
 3rd Qu.:22.8   3rd Qu.:8.00   3rd Qu.:326.0  
 Max.   :33.9   Max.   :8.00   Max.   :472.0  </code></pre>
</div>
</div>
</section><section id="sec-tasks-mutators" class="level3 page-columns page-full" data-number="2.1.3"><h3 data-number="2.1.3" class="anchored" data-anchor-id="sec-tasks-mutators">
<span class="header-section-number">2.1.3</span> Task Mutators</h3>
<div class="page-columns page-full"><p>After a task has been created, you may want to perform operations on the task such as filtering down to subsets of rows and columns, which is often useful for manually creating train and test splits or to fit models on a subset of given features. Above we saw how to access subsets of the underlying dataset using <code>$data()</code>, however, this will not change the underlying task. Therefore, we provide mutators, which modify the given <code>Task</code> in place, which can be seen in the examples below.</p><div class="no-row-height column-margin column-container"><span class="margin-aside">Mutators</span></div></div>
<p>Subsetting by features (columns) is possible with <code>$select()</code> with the desired feature names passed as a character vector and subsetting by observations (rows) is performed with <code>$filter()</code> by passing the row IDs as a numeric vector. </p>
<div class="cell">
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tsk_mtcars_small</span> <span class="op">=</span> <span class="fu">tsk</span><span class="op">(</span><span class="st">"mtcars"</span><span class="op">)</span> <span class="co"># initialize with the full task</span></span>
<span><span class="va">tsk_mtcars_small</span><span class="op">$</span><span class="fu">select</span><span class="op">(</span><span class="st">"cyl"</span><span class="op">)</span> <span class="co"># keep only one feature</span></span>
<span><span class="va">tsk_mtcars_small</span><span class="op">$</span><span class="fu">filter</span><span class="op">(</span><span class="fl">2</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span> <span class="co"># keep only these rows</span></span>
<span><span class="va">tsk_mtcars_small</span><span class="op">$</span><span class="fu">data</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    mpg cyl
1: 21.0   6
2: 22.8   4</code></pre>
</div>
</div>
<p>As <code>R6</code> uses reference semantics (<a href="../chapter1/introduction_and_overview.html#sec-r6" class="quarto-xref"><span>Section 1.5.1</span></a>), you need to use <code>$clone()</code> if you want to modify a task while keeping the original object intact.</p>
<div class="cell">
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># the wrong way</span></span>
<span><span class="va">tsk_mtcars</span> <span class="op">=</span> <span class="fu">tsk</span><span class="op">(</span><span class="st">"mtcars"</span><span class="op">)</span></span>
<span><span class="va">tsk_mtcars_wrong</span> <span class="op">=</span> <span class="va">tsk_mtcars</span></span>
<span><span class="va">tsk_mtcars_wrong</span><span class="op">$</span><span class="fu">filter</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="co"># original data affected</span></span>
<span><span class="va">tsk_mtcars</span><span class="op">$</span><span class="fu">head</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   mpg am carb cyl disp drat gear  hp  qsec vs    wt
1:  21  1    4   6  160  3.9    4 110 16.46  0 2.620
2:  21  1    4   6  160  3.9    4 110 17.02  0 2.875</code></pre>
</div>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># the right way</span></span>
<span><span class="va">tsk_mtcars</span> <span class="op">=</span> <span class="fu">tsk</span><span class="op">(</span><span class="st">"mtcars"</span><span class="op">)</span></span>
<span><span class="va">tsk_mtcars_right</span> <span class="op">=</span> <span class="va">tsk_mtcars</span><span class="op">$</span><span class="fu">clone</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">tsk_mtcars_right</span><span class="op">$</span><span class="fu">filter</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="co"># original data unaffected</span></span>
<span><span class="va">tsk_mtcars</span><span class="op">$</span><span class="fu">head</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    mpg am carb cyl disp drat gear  hp  qsec vs    wt
1: 21.0  1    4   6  160 3.90    4 110 16.46  0 2.620
2: 21.0  1    4   6  160 3.90    4 110 17.02  0 2.875
3: 22.8  1    1   4  108 3.85    4  93 18.61  1 2.320
4: 21.4  0    1   6  258 3.08    3 110 19.44  1 3.215
5: 18.7  0    2   8  360 3.15    3 175 17.02  0 3.440
6: 18.1  0    1   6  225 2.76    3 105 20.22  1 3.460</code></pre>
</div>
</div>
<p>To add extra rows and columns to a task, you can use <code>$rbind()</code> and <code>$cbind()</code> respectively: </p>
<div class="cell">
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tsk_mtcars_small</span><span class="op">$</span><span class="fu">cbind</span><span class="op">(</span> <span class="co"># add another column</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>disp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">150</span>, <span class="fl">160</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">tsk_mtcars_small</span><span class="op">$</span><span class="fu">rbind</span><span class="op">(</span> <span class="co"># add another row</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>mpg <span class="op">=</span> <span class="fl">23</span>, cyl <span class="op">=</span> <span class="fl">5</span>, disp <span class="op">=</span> <span class="fl">170</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">tsk_mtcars_small</span><span class="op">$</span><span class="fu">data</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    mpg cyl disp
1: 21.0   6  150
2: 22.8   4  160
3: 23.0   5  170</code></pre>
</div>
</div>
</section></section><section id="sec-learners" class="level2 page-columns page-full" data-number="2.2"><h2 data-number="2.2" class="anchored" data-anchor-id="sec-learners">
<span class="header-section-number">2.2</span> Learners</h2>
<div class="page-columns page-full"><p>Objects of class <a href="https://mlr3.mlr-org.com/reference/Learner.html"><code>Learner</code></a> provide a unified interface to many popular machine learning algorithms in R. The <a href="https://mlr3.mlr-org.com/reference/mlr_learners.html"><code>mlr_learners</code></a> dictionary contains all the learners available in <code>mlr3</code>. We will discuss the available learners in <a href="#sec-lrns-add" class="quarto-xref"><span>Section 2.7</span></a>; for now, we will just use a regression tree learner as an example to discuss the <code>Learner</code> interface. As with tasks, you can access learners from the dictionary with a single sugar function, in this case, <a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html"><code>lrn()</code></a>.</p><div class="no-row-height column-margin column-container"><span class="margin-aside"><code>Learner</code></span><span class="margin-aside"><code>mlr_learners</code></span><span class="margin-aside"><code><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">lrn()</a></code></span></div></div>
<div class="cell">
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">lrn</span><span class="op">(</span><span class="st">"regr.rpart"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;LearnerRegrRpart:regr.rpart&gt;: Regression Tree
* Model: -
* Parameters: xval=0
* Packages: mlr3, rpart
* Predict Types:  [response]
* Feature Types: logical, integer, numeric, factor, ordered
* Properties: importance, missings, selected_features, weights</code></pre>
</div>
</div>
<p>All <code>Learner</code> objects include the following metadata, which can be seen in the output above:</p>
<ul>
<li>
<code>$feature_types</code>: the type of features the learner can handle.</li>
<li>
<code>$packages</code>: the packages required to be installed to use the learner.</li>
<li>
<code>$properties</code>: the properties of the learner. For example, the “missings” properties means a model can handle missing data, and “importance” means it can compute the relative importance of each feature.</li>
<li>
<code>$predict_types</code>: the types of prediction that the model can make (<a href="#sec-predicting" class="quarto-xref"><span>Section 2.2.2</span></a>).</li>
<li>
<code>$param_set</code>: the set of available hyperparameters (<a href="#sec-param-set" class="quarto-xref"><span>Section 2.2.3</span></a>).</li>
</ul>
<p>To run a machine learning experiment, learners pass through two stages (<a href="#fig-basics-learner" class="quarto-xref">Figure&nbsp;<span>2.2</span></a>):</p>
<ul>
<li>Training: A training <code>Task</code> is passed to the learner’s <code>$train()</code> function which trains and stores a model, i.e., the learned relationship of the features to the target.</li>
<li>Predicting: New data, potentially a different partition of the original dataset, is passed to the <code>$predict()</code> method of the trained learner to predict the target values.</li>
</ul>
<div class="no-row-height column-margin column-container"><span class="margin-aside">Training</span><span class="margin-aside">Predicting</span></div><div class="cell">
<div class="cell-output-display">
<div id="fig-basics-learner" class="quarto-figure quarto-figure-center quarto-float anchored" alt="Diagram shows two boxes, the first is labeled &quot;$train() on Training Data&quot; and shows data pointing at the Learner. The second is labeled &quot;$predict() on New Data to Get Predictions&quot; and shows different data pointing at a learner which now includes a &quot;$model&quot;. An arrow then shows predictions being made from the &quot;Learner&quot; in the second box.">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-basics-learner-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Figures/mlr3book_figures-2.svg" class="img-fluid figure-img" style="width:70.0%" alt="Diagram shows two boxes, the first is labeled &quot;$train() on Training Data&quot; and shows data pointing at the Learner. The second is labeled &quot;$predict() on New Data to Get Predictions&quot; and shows different data pointing at a learner which now includes a &quot;$model&quot;. An arrow then shows predictions being made from the &quot;Learner&quot; in the second box.">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-basics-learner-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.2: Overview of the different stages of a learner. Top – data (features and a target) are passed to an (untrained) learner. Bottom – new data are passed to the trained model which makes predictions for the ‘missing’ target column.
</figcaption></figure>
</div>
</div>
</div>
<section id="sec-training" class="level3 page-columns page-full" data-number="2.2.1"><h3 data-number="2.2.1" class="anchored" data-anchor-id="sec-training">
<span class="header-section-number">2.2.1</span> Training</h3>
<div class="page-columns page-full"><p>In the simplest use case, models are trained by passing a task to a learner with the <code>$train()</code> method:</p><div class="no-row-height column-margin column-container"><span class="margin-aside">$train()</span></div></div>
<div class="cell">
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># load mtcars task</span></span>
<span><span class="va">tsk_mtcars</span> <span class="op">=</span> <span class="fu">tsk</span><span class="op">(</span><span class="st">"mtcars"</span><span class="op">)</span></span>
<span><span class="co"># load a regression tree</span></span>
<span><span class="va">lrn_rpart</span> <span class="op">=</span> <span class="fu">lrn</span><span class="op">(</span><span class="st">"regr.rpart"</span><span class="op">)</span></span>
<span><span class="co"># pass the task to the learner via $train()</span></span>
<span><span class="va">lrn_rpart</span><span class="op">$</span><span class="fu">train</span><span class="op">(</span><span class="va">tsk_mtcars</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="page-columns page-full"><p>After training, the fitted model is stored in the <code>$model</code> field for future inspection and prediction:</p><div class="no-row-height column-margin column-container"><span class="margin-aside">$model</span></div></div>
<div class="cell">
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># inspect the trained model</span></span>
<span><span class="va">lrn_rpart</span><span class="op">$</span><span class="va">model</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>n= 32 

node), split, n, deviance, yval
      * denotes terminal node

1) root 32 1126.00 20.09  
  2) cyl&gt;=5 21  198.50 16.65  
    4) hp&gt;=192.5 7   28.83 13.41 *
    5) hp&lt; 192.5 14   59.87 18.26 *
  3) cyl&lt; 5 11  203.40 26.66 *</code></pre>
</div>
</div>
<p>We see that the regression tree has identified features in the task that are predictive of the target (<code>mpg</code>) and used them to partition observations. The textual representation of the model depends on the type of learner. For more information on any model see the learner help page, which can be accessed in the same way as tasks with the <code><a href="https://rdrr.io/r/utils/help.html">help()</a></code> field, e.g., <code>lrn_rpart$help()</code>.</p>
<section id="sec-basics-partition" class="level4 page-columns page-full" data-number="2.2.1.1"><h4 data-number="2.2.1.1" class="anchored" data-anchor-id="sec-basics-partition">
<span class="header-section-number">2.2.1.1</span> Partitioning Data</h4>
<div class="page-columns page-full"><p>When assessing the quality of a model’s predictions, you will likely want to partition your dataset to get a fair and unbiased estimate of a model’s generalization error. In <a href="../chapter3/evaluation_and_benchmarking.html" class="quarto-xref"><span>Chapter 3</span></a> we will look at resampling and benchmark experiments, which will go into more detail about performance estimation but for now, we will just discuss the simplest method of splitting data using the <a href="https://mlr3.mlr-org.com/reference/partition.html"><code>partition()</code></a> function. This function creates index sets that randomly split the given task into two disjoint sets: a training set (67% of the total data by default) and a test set (the remaining 33% of the total data not in the training set).</p><div class="no-row-height column-margin column-container"><span class="margin-aside"><code><a href="https://mlr3.mlr-org.com/reference/partition.html">partition()</a></code></span></div></div>
<div class="cell">
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">splits</span> <span class="op">=</span> <span class="fu">partition</span><span class="op">(</span><span class="va">tsk_mtcars</span><span class="op">)</span></span>
<span><span class="va">splits</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$train
 [1]  1  3  4  5  8 10 21 25 32  6  7 11 14 15 16 17 22 31 19 20 26

$test
 [1]  2  9 27 30 12 13 23 24 29 18 28</code></pre>
</div>
</div>
<p>When training we will tell the model to only use the training data by passing the row IDs from <code>partition</code> to the <code>row_ids</code> argument of <code>$train()</code>:</p>
<div class="cell">
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">lrn_rpart</span><span class="op">$</span><span class="fu">train</span><span class="op">(</span><span class="va">tsk_mtcars</span>, row_ids <span class="op">=</span> <span class="va">splits</span><span class="op">$</span><span class="va">train</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we can use our trained learner to make predictions on new data.</p>
</section></section><section id="sec-predicting" class="level3 page-columns page-full" data-number="2.2.2"><h3 data-number="2.2.2" class="anchored" data-anchor-id="sec-predicting">
<span class="header-section-number">2.2.2</span> Predicting</h3>
<div class="page-columns page-full"><p>Predicting from trained models is as simple as passing your data as a <code>Task</code> to the <code>$predict()</code> method of the trained <code>Learner</code>.</p><div class="no-row-height column-margin column-container"><span class="margin-aside">$predict()</span></div></div>
<p>Carrying straight on from our last example, we will call the <code>$predict()</code> method of our trained learner and again will use the <code>row_ids</code> argument, but this time to pass the IDs of our test set:</p>
<div class="cell">
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">prediction</span> <span class="op">=</span> <span class="va">lrn_rpart</span><span class="op">$</span><span class="fu">predict</span><span class="op">(</span><span class="va">tsk_mtcars</span>, row_ids <span class="op">=</span> <span class="va">splits</span><span class="op">$</span><span class="va">test</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="page-columns page-full"><p>The <code>$predict()</code> method returns an object inheriting from <a href="https://mlr3.mlr-org.com/reference/Prediction.html"><code>Prediction</code></a>, in this case <a href="https://mlr3.mlr-org.com/reference/PredictionRegr.html"><code>PredictionRegr</code></a> as this is a regression task.</p><div class="no-row-height column-margin column-container"><span class="margin-aside"><code>Prediction</code></span><span class="margin-aside"><code>PredictionRegr</code></span></div></div>
<div class="cell">
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">prediction</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;PredictionRegr&gt; for 11 observations:
    row_ids truth response
          2  21.0     24.9
          9  22.8     24.9
         27  26.0     24.9
---                       
         29  15.8     24.9
         18  32.4     24.9
         28  30.4     24.9</code></pre>
</div>
</div>
<p>The <code>row_ids</code> column corresponds to the row IDs of the predicted observations. The <code>truth</code> column contains the ground truth data if available, which the object extracts from the task, in this case: <code>tsk_mtcars$truth(splits$test)</code>. Finally, the <code>response</code> column contains the values predicted by the model. The <code>Prediction</code> object can easily be converted into a <code>data.table</code> or <code>data.frame</code> using <code><a href="https://rdatatable.gitlab.io/data.table/reference/as.data.table.html">as.data.table()</a></code>/<code><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame()</a></code> respectively.</p>
<p>All data in the above columns can be accessed directly, for example, to get the first two predicted responses:</p>
<div class="cell">
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">prediction</span><span class="op">$</span><span class="va">response</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 24.9 24.9</code></pre>
</div>
</div>
<p>Similarly to plotting <code>Task</code>s, <a href="https://mlr3viz.mlr-org.com"><code>mlr3viz</code></a> provides an <a href="https://www.rdocumentation.org/packages/ggplot2/topics/autoplot"><code>autoplot()</code></a> method for <code>Prediction</code> objects.</p>
<div class="cell">
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://mlr3viz.mlr-org.com">mlr3viz</a></span><span class="op">)</span></span>
<span><span class="va">prediction</span> <span class="op">=</span> <span class="va">lrn_rpart</span><span class="op">$</span><span class="fu">predict</span><span class="op">(</span><span class="va">tsk_mtcars</span>, <span class="va">splits</span><span class="op">$</span><span class="va">test</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">prediction</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-basics-truthresponse" class="quarto-figure quarto-figure-center quarto-float anchored" alt="A scatter plot with predicted values on one axis and ground truth values on the other. A trend line is fit to show that in general there is good agreement between predicted and ground truth values.">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-basics-truthresponse-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="data_and_basic_modeling_files/figure-html/fig-basics-truthresponse-1.png" class="img-fluid figure-img" style="width:70.0%" alt="A scatter plot with predicted values on one axis and ground truth values on the other. A trend line is fit to show that in general there is good agreement between predicted and ground truth values.">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-basics-truthresponse-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.3: Comparing predicted and ground truth values for the mtcars dataset.
</figcaption></figure>
</div>
</div>
</div>
<p>In the examples above we made predictions by passing a task to <code>$predict()</code>. However, if you would rather pass a <code>data.frame</code> type object directly, then you can use <code>$predict_newdata()</code>. Note, the <code>truth</code> column values are all <code>NA</code>, as we did not include a target column in the generated data.</p>
<div class="cell">
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">mtcars_new</span> <span class="op">=</span> <span class="fu">data.table</span><span class="op">(</span>cyl <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">6</span><span class="op">)</span>, disp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">120</span><span class="op">)</span>,</span>
<span>  hp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">150</span><span class="op">)</span>, drat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">3.9</span><span class="op">)</span>, wt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3.8</span>, <span class="fl">4.1</span><span class="op">)</span>,</span>
<span>  qsec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">18</span>, <span class="fl">19.5</span><span class="op">)</span>, vs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>, am <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>  gear <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">6</span>, <span class="fl">4</span><span class="op">)</span>, carb <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">prediction</span> <span class="op">=</span> <span class="va">lrn_rpart</span><span class="op">$</span><span class="fu">predict_newdata</span><span class="op">(</span><span class="va">mtcars_new</span><span class="op">)</span></span>
<span><span class="va">prediction</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;PredictionRegr&gt; for 2 observations:
 row_ids truth response
       1    NA    15.71
       2    NA    15.71</code></pre>
</div>
</div>
<section id="changing-the-prediction-type" class="level4 unnumbered unlisted"><h4 class="unnumbered unlisted anchored" data-anchor-id="changing-the-prediction-type">Changing the Prediction Type</h4>
<p>While predicting a single numeric quantity is the most common prediction type in regression, it is not the only prediction type. Several regression models can also predict standard errors. To predict this, the <code>$predict_type</code> field of a <a href="https://mlr3.mlr-org.com/reference/LearnerRegr.html"><code>LearnerRegr</code></a> must be changed from “response” (the default) to <code>"se"</code> before training. The <code>"rpart"</code> learner we used above does not support predicting standard errors, so in the example below we will use a linear regression model (<code>lrn("regr.lm")</code>).</p>
<div class="cell">
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://mlr3learners.mlr-org.com">mlr3learners</a></span><span class="op">)</span></span>
<span><span class="va">lrn_lm</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">lrn</a></span><span class="op">(</span><span class="st">"regr.lm"</span>, predict_type <span class="op">=</span> <span class="st">"se"</span><span class="op">)</span></span>
<span><span class="va">lrn_lm</span><span class="op">$</span><span class="fu">train</span><span class="op">(</span><span class="va">tsk_mtcars</span>, <span class="va">splits</span><span class="op">$</span><span class="va">train</span><span class="op">)</span></span>
<span><span class="va">lrn_lm</span><span class="op">$</span><span class="fu">predict</span><span class="op">(</span><span class="va">tsk_mtcars</span>, <span class="va">splits</span><span class="op">$</span><span class="va">test</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;PredictionRegr&gt; for 11 observations:
    row_ids truth response    se
          2  21.0    20.20 1.817
          9  22.8    33.32 4.246
         27  26.0    32.22 4.121
---                             
         29  15.8    28.26 4.182
         18  32.4    27.77 1.114
         28  30.4    27.57 2.735</code></pre>
</div>
</div>
<p>Now the output includes an <code>se</code> column as desired. In <a href="#sec-basics-classif-learner" class="quarto-xref"><span>Section 2.5.3</span></a> we will see prediction types playing an even bigger role in the context of classification.</p>
<p>Having covered the unified train/predict interface, we can now look at how to use hyperparameters to configure these methods for individual algorithms.</p>
</section></section><section id="sec-param-set" class="level3 page-columns page-full" data-number="2.2.3"><h3 data-number="2.2.3" class="anchored" data-anchor-id="sec-param-set">
<span class="header-section-number">2.2.3</span> Hyperparameters</h3>
<p><code>Learner</code>s encapsulate a machine learning algorithm and its hyperparameters, which affect <em>how</em> the algorithm is run and can be set by the user. Hyperparameters may affect how a model is trained or how it makes predictions and deciding how to set hyperparameters can require expert knowledge. Hyperparameters can be optimized automatically (<a href="../chapter4/hyperparameter_optimization.html" class="quarto-xref"><span>Chapter 4</span></a>), but in this chapter we will focus on how to set them manually.</p>
<section id="paradox-and-parameter-sets" class="level4 page-columns page-full" data-number="2.2.3.1"><h4 data-number="2.2.3.1" class="anchored" data-anchor-id="paradox-and-parameter-sets">
<span class="header-section-number">2.2.3.1</span> Paradox and Parameter Sets</h4>
<div class="page-columns page-full"><p>We will continue our running example with a regression tree learner. To access the hyperparameters in the decision tree, we use <code>$param_set</code>:</p><div class="no-row-height column-margin column-container"><span class="margin-aside">$param_set</span></div></div>
<div class="cell">
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">lrn_rpart</span><span class="op">$</span><span class="va">param_set</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;ParamSet&gt;
                id    class lower upper nlevels        default value
 1:             cp ParamDbl     0     1     Inf           0.01      
 2:     keep_model ParamLgl    NA    NA       2          FALSE      
 3:     maxcompete ParamInt     0   Inf     Inf              4      
 4:       maxdepth ParamInt     1    30      30             30      
 5:   maxsurrogate ParamInt     0   Inf     Inf              5      
 6:      minbucket ParamInt     1   Inf     Inf &lt;NoDefault[3]&gt;      
 7:       minsplit ParamInt     1   Inf     Inf             20      
 8: surrogatestyle ParamInt     0     1       2              0      
 9:   usesurrogate ParamInt     0     2       3              2      
10:           xval ParamInt     0   Inf     Inf             10     0</code></pre>
</div>
</div>
<div class="page-columns page-full"><p>The output above is a <a href="https://paradox.mlr-org.com/reference/ParamSet.html"><code>ParamSet</code></a> object, supplied by the <a href="https://paradox.mlr-org.com"><code>paradox</code></a> package. These objects provide information on hyperparameters including their name (<code>id</code>), data type (<code>class</code>), technically valid ranges for hyperparameter values (<code>lower</code>, <code>upper</code>), the number of levels possible if the data type is categorical (<code>nlevels</code>), the default value from the underlying package (<code>default</code>), and finally the set value (<code>value</code>). The second column references classes defined in <a href="https://paradox.mlr-org.com"><code>paradox</code></a> that determine the class of the parameter and the possible values it can take. <a href="#tbl-parameters-classes" class="quarto-xref">Table&nbsp;<span>2.1</span></a> lists the possible hyperparameter types, all of which inherit from <a href="https://paradox.mlr-org.com/reference/Param.html"><code>Param</code></a>.</p><div class="no-row-height column-margin column-container"><span class="margin-aside"><code>ParamSet</code></span></div></div>
<div id="tbl-parameters-classes" class="quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-parameters-classes-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2.1: Hyperparameter classes and the type of hyperparameter they represent.
</figcaption><div aria-describedby="tbl-parameters-classes-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="table">
<thead><tr class="header">
<th>Hyperparameter Class</th>
<th>Hyperparameter Type</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><a href="https://paradox.mlr-org.com/reference/ParamDbl.html"><code>ParamDbl</code></a></td>
<td>Real-valued (numeric)</td>
</tr>
<tr class="even">
<td><a href="https://paradox.mlr-org.com/reference/ParamInt.html"><code>ParamInt</code></a></td>
<td>Integer</td>
</tr>
<tr class="odd">
<td><a href="https://paradox.mlr-org.com/reference/ParamFct.html"><code>ParamFct</code></a></td>
<td>Categorical (factor)</td>
</tr>
<tr class="even">
<td><a href="https://paradox.mlr-org.com/reference/ParamLgl.html"><code>ParamLgl</code></a></td>
<td>Logical / Boolean</td>
</tr>
<tr class="odd">
<td><a href="https://paradox.mlr-org.com/reference/ParamUty.html"><code>ParamUty</code></a></td>
<td>Untyped</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<p>In our decision tree example, we can infer from the <code>ParamSet</code> output that:</p>
<ul>
<li>
<code>cp</code> must be a “double” (<code>ParamDbl</code>) taking values between <code>0</code> (<code>lower</code>) and <code>1</code> (<code>upper</code>) with a default of 0.01 (<code>default</code>).</li>
<li>
<code>keep_model</code> must be a “logical” (<code>ParamLgl</code>) taking values <code>TRUE</code> or <code>FALSE</code> with default <code>FALSE</code>
</li>
<li>
<code>xval</code> must be an “integer” (<code>ParamInt</code>) taking values between <code>0</code> and <code>Inf</code> with a default of <code>10</code> and has a set value of <code>0</code>.</li>
</ul>
<p>In rare cases (we try to minimize it as much as possible), hyperparameters are initialized to values which deviate from the default in the underlying package. When this happens, the reason will always be given in the learner help page. In the case of <code>lrn("regr.rpart")</code>, the <code>xval</code> hyperparameter is initialized to <code>0</code> because <code>xval</code> controls internal cross-validations and if a user accidentally leaves this at the default <code>10</code>, model training can take an unnecessarily long time.</p>
</section><section id="getting-and-setting-hyperparameter-values" class="level4 page-columns page-full" data-number="2.2.3.2"><h4 data-number="2.2.3.2" class="anchored" data-anchor-id="getting-and-setting-hyperparameter-values">
<span class="header-section-number">2.2.3.2</span> Getting and Setting Hyperparameter Values</h4>
<p>Now we have looked at how hyperparameter sets are stored, we can think about getting and setting them. Returning to our decision tree, say we are interested in growing a tree with depth <code>1</code>, also known as a “decision stump”, where data is split only once into two terminal nodes. From the parameter set output, we know that the <code>maxdepth</code> parameter has a default of <code>30</code> and that it takes integer values.</p>
<p>There are a few different ways we could change this hyperparameter. The simplest way is during construction of the learner by passing the hyperparameter name and new value to <code><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">lrn()</a></code>:</p>
<div class="cell">
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">lrn_rpart</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">lrn</a></span><span class="op">(</span><span class="st">"regr.rpart"</span>, maxdepth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can get a list of non-default hyperparameters (i.e., those that have been set) by using <code>$param_set$values</code>:</p>
<div class="cell">
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">lrn_rpart</span><span class="op">$</span><span class="va">param_set</span><span class="op">$</span><span class="va">values</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$xval
[1] 0

$maxdepth
[1] 1</code></pre>
</div>
</div>
<p>Now we can see that <code>maxdepth = 1</code> (as we discussed above <code>xval = 0</code> is changed during construction) and the learned regression tree reflects this:</p>
<div class="cell">
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">lrn_rpart</span><span class="op">$</span><span class="fu">train</span><span class="op">(</span><span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">tsk</a></span><span class="op">(</span><span class="st">"mtcars"</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">model</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>n= 32 

node), split, n, deviance, yval
      * denotes terminal node

1) root 32 1126.0 20.09  
  2) cyl&gt;=5 21  198.5 16.65 *
  3) cyl&lt; 5 11  203.4 26.66 *</code></pre>
</div>
</div>
<p>The <code>$values</code> field simply returns a <code>list</code> of set hyperparameters, so another way to update hyperparameters is by updating an element in the list:</p>
<div class="cell">
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">lrn_rpart</span><span class="op">$</span><span class="va">param_set</span><span class="op">$</span><span class="va">values</span><span class="op">$</span><span class="va">maxdepth</span> <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="va">lrn_rpart</span><span class="op">$</span><span class="va">param_set</span><span class="op">$</span><span class="va">values</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$xval
[1] 0

$maxdepth
[1] 2</code></pre>
</div>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># now with depth 2</span></span>
<span><span class="va">lrn_rpart</span><span class="op">$</span><span class="fu">train</span><span class="op">(</span><span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">tsk</a></span><span class="op">(</span><span class="st">"mtcars"</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">model</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>n= 32 

node), split, n, deviance, yval
      * denotes terminal node

1) root 32 1126.00 20.09  
  2) cyl&gt;=5 21  198.50 16.65  
    4) hp&gt;=192.5 7   28.83 13.41 *
    5) hp&lt; 192.5 14   59.87 18.26 *
  3) cyl&lt; 5 11  203.40 26.66 *</code></pre>
</div>
</div>
<div class="page-columns page-full"><p>To set multiple values at once we recommend either setting these during construction or using <code>$set_values()</code>, which updates the given hyperparameters (argument names) with the respective values.</p><div class="no-row-height column-margin column-container"><span class="margin-aside">$set_values()</span></div></div>
<div class="cell">
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">lrn_rpart</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">lrn</a></span><span class="op">(</span><span class="st">"regr.rpart"</span>, maxdepth <span class="op">=</span> <span class="fl">3</span>, xval <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">lrn_rpart</span><span class="op">$</span><span class="va">param_set</span><span class="op">$</span><span class="va">values</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$xval
[1] 1

$maxdepth
[1] 3</code></pre>
</div>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># or with set_values</span></span>
<span><span class="va">lrn_rpart</span><span class="op">$</span><span class="va">param_set</span><span class="op">$</span><span class="fu">set_values</span><span class="op">(</span>xval <span class="op">=</span> <span class="fl">2</span>, cp <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="va">lrn_rpart</span><span class="op">$</span><span class="va">param_set</span><span class="op">$</span><span class="va">values</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$xval
[1] 2

$maxdepth
[1] 3

$cp
[1] 0.5</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Setting Hyperparameters Using a <code>list</code>
</div>
</div>
<div class="callout-body-container callout-body">
<p>As <code>lrn_rpart$param_set$values</code> returns a <code>list</code>, some users may be tempted to set hyperparameters by passing a new <code>list</code> to <code>$values</code> – this would work but <strong>we do not recommend it</strong>. This is because passing a <code>list</code> will wipe any existing hyperparameter values if they are not included in the list. For example:</p>
<div class="cell">
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># set xval and cp</span></span>
<span><span class="va">lrn_rpart_params</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">lrn</a></span><span class="op">(</span><span class="st">"regr.rpart"</span>, xval <span class="op">=</span> <span class="fl">0</span>, cp <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co"># passing maxdepth through a list, removing all other values</span></span>
<span><span class="va">lrn_rpart_params</span><span class="op">$</span><span class="va">param_set</span><span class="op">$</span><span class="va">values</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>maxdepth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co"># we have removed xval and cp by mistake</span></span>
<span><span class="va">lrn_rpart_params</span><span class="op">$</span><span class="va">param_set</span><span class="op">$</span><span class="va">values</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$maxdepth
[1] 1</code></pre>
</div>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># now with set_values</span></span>
<span><span class="va">lrn_rpart_params</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">lrn</a></span><span class="op">(</span><span class="st">"regr.rpart"</span>, xval <span class="op">=</span> <span class="fl">0</span>, cp <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">lrn_rpart_params</span><span class="op">$</span><span class="va">param_set</span><span class="op">$</span><span class="fu">set_values</span><span class="op">(</span>maxdepth <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">lrn_rpart_params</span><span class="op">$</span><span class="va">param_set</span><span class="op">$</span><span class="va">values</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$xval
[1] 0

$cp
[1] 1

$maxdepth
[1] 1</code></pre>
</div>
</div>
</div>
</div>
<p>Whichever method you choose, all have safety checks to ensure your new values fall within the allowed parameter range:</p>
<div class="cell">
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">lrn</a></span><span class="op">(</span><span class="st">"regr.rpart"</span>, cp <span class="op">=</span> <span class="fl">2</span>, maxdepth <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in self$assert(xs): Assertion on 'xs' failed: cp: Element 1 is not &lt;= 1.</code></pre>
</div>
</div>
</section><section id="hyperparameter-dependencies" class="level4" data-number="2.2.3.3"><h4 data-number="2.2.3.3" class="anchored" data-anchor-id="hyperparameter-dependencies">
<span class="header-section-number">2.2.3.3</span> Hyperparameter Dependencies</h4>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
This section covers advanced ML or technical details.
</div>
</div>
<div class="callout-body-container callout-body">

</div>
</div>
<p>More complex hyperparameter spaces may include dependencies, which occur when setting a hyperparameter is conditional on the value of another hyperparameter; this is most important in the context of model tuning (<a href="../chapter4/hyperparameter_optimization.html" class="quarto-xref"><span>Chapter 4</span></a>). One such example is a support vector machine (<code>lrn("regr.svm")</code>). The field <code>$deps</code> returns a <code>data.table</code>, which lists the hyperparameter dependencies in the <code>Learner</code>. For example we can see that the <code>cost</code> (<code>id</code>-column) parameter is dependent on the <code>type</code> (<code>on</code>-column) parameter.</p>
<div class="cell">
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">lrn</a></span><span class="op">(</span><span class="st">"regr.svm"</span><span class="op">)</span><span class="op">$</span><span class="va">param_set</span><span class="op">$</span><span class="va">deps</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        id     on           cond
1:    cost   type &lt;CondAnyOf[9]&gt;
2:      nu   type &lt;CondEqual[9]&gt;
3:  degree kernel &lt;CondEqual[9]&gt;
4:   coef0 kernel &lt;CondAnyOf[9]&gt;
5:   gamma kernel &lt;CondAnyOf[9]&gt;
6: epsilon   type &lt;CondEqual[9]&gt;</code></pre>
</div>
</div>
<p>The <code>cond</code> column tells us what the condition is, which will either mean that <code>id</code> can be set if <code>on</code> equals a single value (<a href="https://paradox.mlr-org.com/reference/Condition.html"><code>CondEqual</code></a>) or any value in the listed set (<a href="https://paradox.mlr-org.com/reference/Condition.html"><code>CondAnyOf</code></a>).</p>
<div class="cell">
<div class="sourceCode" id="cb77"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">lrn</a></span><span class="op">(</span><span class="st">"regr.svm"</span><span class="op">)</span><span class="op">$</span><span class="va">param_set</span><span class="op">$</span><span class="va">deps</span><span class="op">[[</span><span class="fl">1</span>, <span class="st">"cond"</span><span class="op">]</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CondAnyOf: x ∈ {eps-regression, nu-regression}</code></pre>
</div>
<div class="sourceCode" id="cb79"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">lrn</a></span><span class="op">(</span><span class="st">"regr.svm"</span><span class="op">)</span><span class="op">$</span><span class="va">param_set</span><span class="op">$</span><span class="va">deps</span><span class="op">[[</span><span class="fl">3</span>, <span class="st">"cond"</span><span class="op">]</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>CondEqual: x = polynomial</code></pre>
</div>
</div>
<p>This tells us that the parameter <code>cost</code> should only be set if the <code>type</code> parameter is one of <code>"eps-regression"</code> or <code>"nu-regression"</code>, and <code>degree</code> should only be set if <code>kernel</code> is equal to <code>"polynomial"</code>.</p>
<p>The <code>Learner</code> will error if dependent hyperparameters are set when their conditions are not met:</p>
<div class="cell">
<div class="sourceCode" id="cb81"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># error as kernel is not polynomial</span></span>
<span><span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">lrn</a></span><span class="op">(</span><span class="st">"regr.svm"</span>, kernel <span class="op">=</span> <span class="st">"linear"</span>, degree <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>Error in self$assert(xs): Assertion on 'xs' failed: The parameter 'degree' can only be set if the following condition is met 'kernel = polynomial'. Instead the current parameter value is: kernel=linear.</code></pre>
</div>
<div class="sourceCode" id="cb83"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># works because kernel is polynomial</span></span>
<span><span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">lrn</a></span><span class="op">(</span><span class="st">"regr.svm"</span>, kernel <span class="op">=</span> <span class="st">"polynomial"</span>, degree <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;LearnerRegrSVM:regr.svm&gt;
* Model: -
* Parameters: kernel=polynomial, degree=1
* Packages: mlr3, mlr3learners, e1071
* Predict Types:  [response]
* Feature Types: logical, integer, numeric
* Properties: -</code></pre>
</div>
</div>
</section></section><section id="sec-basics-featureless" class="level3 page-columns page-full" data-number="2.2.4"><h3 data-number="2.2.4" class="anchored" data-anchor-id="sec-basics-featureless">
<span class="header-section-number">2.2.4</span> Baseline Learners</h3>
<div class="page-columns page-full"><p>Before we move on to learner evaluation, we will highlight an important class of learners. These are extremely simple or ‘weak’ learners known as baselines. Baselines are useful in model comparison (<a href="../chapter3/evaluation_and_benchmarking.html" class="quarto-xref"><span>Chapter 3</span></a>) and as fallback learners (<a href="../chapter5/advanced_tuning_methods_and_black_box_optimization.html#sec-encapsulation-fallback" class="quarto-xref"><span>Section 5.1.1</span></a>, <a href="../chapter10/advanced_technical_aspects_of_mlr3.html#sec-fallback" class="quarto-xref"><span>Section 10.2.2</span></a>). For regression, we have implemented the baseline <code>lrn("regr.featureless")</code>, which always predicts new values to be the mean (or median, if the <code>robust</code> hyperparameter is set to <code>TRUE</code>) of the target in the training data:</p><div class="no-row-height column-margin column-container"><span class="margin-aside">Baselines</span></div></div>
<div class="cell">
<div class="sourceCode" id="cb85"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># generate data</span></span>
<span><span class="va">df</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/as_task_regr.html">as_task_regr</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">1000</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  target <span class="op">=</span> <span class="st">"y"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">lrn</a></span><span class="op">(</span><span class="st">"regr.featureless"</span><span class="op">)</span><span class="op">$</span><span class="fu">train</span><span class="op">(</span><span class="va">df</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">995</span><span class="op">)</span><span class="op">$</span><span class="fu">predict</span><span class="op">(</span><span class="va">df</span>, <span class="fl">996</span><span class="op">:</span><span class="fl">1000</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;PredictionRegr&gt; for 5 observations:
 row_ids truth response
     996 2.996    1.976
     997 3.675    1.976
     998 3.651    1.976
     999 1.803    1.976
    1000 1.196    1.976</code></pre>
</div>
</div>
<p>It is good practice to test all new models against a baseline, and also to include baselines in experiments with multiple other models. In general, a model that does not outperform a baseline is a ‘bad’ model, on the other hand, a model is not necessarily ‘good’ if it outperforms the baseline.</p>
</section></section><section id="sec-eval" class="level2 page-columns page-full" data-number="2.3"><h2 data-number="2.3" class="anchored" data-anchor-id="sec-eval">
<span class="header-section-number">2.3</span> Evaluation</h2>
<p>Perhaps <em>the most</em> important step of the applied machine learning workflow is evaluating model performance. Without this, we would have no way to know if our trained model makes very accurate predictions, is worse than randomly guessing, or somewhere in between. We will continue with our decision tree example to establish if the quality of our predictions is ‘good’, first we will rerun the above code so it is easier to follow along.</p>
<div class="cell">
<div class="sourceCode" id="cb87"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">lrn_rpart</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">lrn</a></span><span class="op">(</span><span class="st">"regr.rpart"</span><span class="op">)</span></span>
<span><span class="va">tsk_mtcars</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">tsk</a></span><span class="op">(</span><span class="st">"mtcars"</span><span class="op">)</span></span>
<span><span class="va">splits</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/partition.html">partition</a></span><span class="op">(</span><span class="va">tsk_mtcars</span><span class="op">)</span></span>
<span><span class="va">lrn_rpart</span><span class="op">$</span><span class="fu">train</span><span class="op">(</span><span class="va">tsk_mtcars</span>, <span class="va">splits</span><span class="op">$</span><span class="va">train</span><span class="op">)</span></span>
<span><span class="va">prediction</span> <span class="op">=</span> <span class="va">lrn_rpart</span><span class="op">$</span><span class="fu">predict</span><span class="op">(</span><span class="va">tsk_mtcars</span>, <span class="va">splits</span><span class="op">$</span><span class="va">test</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="measures" class="level3 page-columns page-full" data-number="2.3.1"><h3 data-number="2.3.1" class="anchored" data-anchor-id="measures">
<span class="header-section-number">2.3.1</span> Measures</h3>
<div class="page-columns page-full"><p>The quality of predictions is evaluated using measures that compare them to the ground truth data for supervised learning tasks. Similarly to <code>Task</code>s and <code>Learner</code>s, the available measures in <code>mlr3</code> are stored in a dictionary called <a href="https://mlr3.mlr-org.com/reference/mlr_measures.html"><code>mlr_measures</code></a> and can be accessed with <code><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">msr()</a></code>:</p><div class="no-row-height column-margin column-container"><span class="margin-aside"><code>mlr_measures</code></span><span class="margin-aside">msr()</span></div></div>
<div class="cell">
<div class="sourceCode" id="cb88"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/as.data.table.html">as.data.table</a></span><span class="op">(</span><span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">msr</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             key                          label task_type
 1:          aic   Akaike Information Criterion      &lt;NA&gt;
 2:          bic Bayesian Information Criterion      &lt;NA&gt;
 3:  classif.acc        Classification Accuracy   classif
 4:  classif.auc       Area Under the ROC Curve   classif
 5: classif.bacc              Balanced Accuracy   classif
---                                                      
62:  sim.jaccard       Jaccard Similarity Index      &lt;NA&gt;
63:      sim.phi     Phi Coefficient Similarity      &lt;NA&gt;
64:    time_both                   Elapsed Time      &lt;NA&gt;
65: time_predict                   Elapsed Time      &lt;NA&gt;
66:   time_train                   Elapsed Time      &lt;NA&gt;
3 variables not shown: [packages, predict_type, task_properties]</code></pre>
</div>
</div>
<div class="page-columns page-full"><p>All measures implemented in <code>mlr3</code> are defined primarily by three components: 1) the function that defines the measure; 2) whether a lower or higher value is considered ‘good’; and 3) the range of possible values the measure can take. As well as these defining elements, other metadata are important to consider when selecting and using a <code>Measure</code>, including if the measure has any special properties (e.g., requires training data), the type of predictions the measure can evaluate, and whether the measure has any ‘control parameters’. All this information is encapsulated in the <a href="https://mlr3.mlr-org.com/reference/Measure.html"><code>Measure</code></a> object. By example, let us consider the mean absolute error (MAE):</p><div class="no-row-height column-margin column-container"><span class="margin-aside"><code>Measure</code></span></div></div>
<div class="cell">
<div class="sourceCode" id="cb90"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">measure</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">msr</a></span><span class="op">(</span><span class="st">"regr.mae"</span><span class="op">)</span></span>
<span><span class="va">measure</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;MeasureRegrSimple:regr.mae&gt;: Mean Absolute Error
* Packages: mlr3, mlr3measures
* Range: [0, Inf]
* Minimize: TRUE
* Average: macro
* Parameters: list()
* Properties: -
* Predict type: response</code></pre>
</div>
</div>
<p>This measure compares the absolute difference (‘error’) between true and predicted values: <span class="math inline">\(f(y, \hat{y}) = | y - \hat{y} |\)</span>. Lower values are considered better (<code>Minimize: TRUE</code>), which is intuitive as we would like the true values, <span class="math inline">\(y\)</span>, to be identical (or as close as possible) in value to the predicted values, <span class="math inline">\(\hat{y}\)</span>. We can see that the range of possible values the learner can take is from <span class="math inline">\(0\)</span> to <span class="math inline">\(\infty\)</span> (<code>Range: [0, Inf]</code>), it has no special properties (<code>Properties: -</code>), it evaluates <code>response</code> type predictions for regression models (<code>Predict type: response</code>), and it has no control parameters (<code>Parameters: list()</code>).</p>
<p>Now let us see how to use this measure for scoring our predictions.</p>
</section><section id="scoring-predictions" class="level3 page-columns page-full" data-number="2.3.2"><h3 data-number="2.3.2" class="anchored" data-anchor-id="scoring-predictions">
<span class="header-section-number">2.3.2</span> Scoring Predictions</h3>
<p>Usually, supervised learning measures compare the difference between predicted values and the ground truth. <code>mlr3</code> simplifies the process of bringing these quantities together by storing the predictions and true outcomes in the <a href="https://mlr3.mlr-org.com/reference/Prediction.html"><code>Prediction</code></a> object as we have already seen.</p>
<div class="cell">
<div class="sourceCode" id="cb92"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">prediction</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;PredictionRegr&gt; for 11 observations:
    row_ids truth response
          2  21.0    16.70
          8  24.4    26.81
         21  21.5    26.81
---                       
         31  15.0    16.70
         18  32.4    26.81
         26  27.3    26.81</code></pre>
</div>
</div>
<div class="page-columns page-full"><p>To calculate model performance, we simply call the <code>$score()</code> method of a <code>Prediction</code> object and pass as a single argument the measure that we want to compute:</p><div class="no-row-height column-margin column-container"><span class="margin-aside">$score()</span></div></div>
<div class="cell">
<div class="sourceCode" id="cb94"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">prediction</span><span class="op">$</span><span class="fu">score</span><span class="op">(</span><span class="va">measure</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>regr.mae 
   2.591 </code></pre>
</div>
</div>
<p>Note that all task types have default measures that are used if the argument to <code>$score()</code> is omitted, for regression this is the mean squared error (<code>msr("regr.mse")</code>), which is the squared difference between true and predicted values: <span class="math inline">\(f(y, \hat{y}) = (y - \hat{y})^2\)</span>, averaged over the test set.</p>
<div class="page-columns page-full"><p>It is possible to calculate multiple measures at the same time by passing multiple measures to <code>$score()</code>. For example, below we compute performance for mean squared error (<code>"regr.mse"</code>) and mean absolute error (<code>"regr.mae"</code>) – note we use <code><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">msrs()</a></code> to load multiple measures at once.</p><div class="no-row-height column-margin column-container"><span class="margin-aside">msrs()</span></div></div>
<div class="cell">
<div class="sourceCode" id="cb96"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">measures</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">msrs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"regr.mse"</span>, <span class="st">"regr.mae"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">prediction</span><span class="op">$</span><span class="fu">score</span><span class="op">(</span><span class="va">measures</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>regr.mse regr.mae 
   9.567    2.591 </code></pre>
</div>
</div>
</section><section id="sec-basics-measures-tech" class="level3 page-columns page-full" data-number="2.3.3"><h3 data-number="2.3.3" class="anchored" data-anchor-id="sec-basics-measures-tech">
<span class="header-section-number">2.3.3</span> Technical Measures</h3>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
This section covers advanced ML or technical details.
</div>
</div>
<div class="callout-body-container callout-body">

</div>
</div>
<p><code>mlr3</code> also provides measures that do not quantify the quality of the predictions of a model, but instead provide ‘meta’-information about the model. These include:</p>
<ul>
<li>
<code>msr("time_train")</code> – The time taken to train a model.</li>
<li>
<code>msr("time_predict")</code> – The time taken for the model to make predictions.</li>
<li>
<code>msr("time_both")</code> – The total time taken to train the model and then make predictions.</li>
<li>
<code>msr("selected_features")</code> – The number of features selected by a model, which can only be used if the model has the “selected_features” property.</li>
</ul>
<p>For example, we could score our decision tree to see how many seconds it took to train the model and make predictions:</p>
<div class="cell">
<div class="sourceCode" id="cb98"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">measures</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">msrs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"time_train"</span>, <span class="st">"time_predict"</span>, <span class="st">"time_both"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">prediction</span><span class="op">$</span><span class="fu">score</span><span class="op">(</span><span class="va">measures</span>, learner <span class="op">=</span> <span class="va">lrn_rpart</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  time_train time_predict    time_both 
       0.003        0.002        0.005 </code></pre>
</div>
</div>
<p>Notice a few key properties of these measures:</p>
<ol type="1">
<li>
<code>time_both</code> is simply the sum of <code>time_train</code> and <code>time_predict</code>.</li>
<li>We had to pass <code>learner = lrn_rpart</code> to <code>$score()</code> as these measures have the <code>requires_learner</code> property:</li>
</ol>
<div class="cell">
<div class="sourceCode" id="cb100"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">msr</a></span><span class="op">(</span><span class="st">"time_train"</span><span class="op">)</span><span class="op">$</span><span class="va">properties</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "requires_learner"</code></pre>
</div>
</div>
<ol start="3" type="1">
<li>These can be used after model training and predicting because we automatically store model run times whenever <code>$train()</code> and <code>$predict()</code> are called, so the measures above are equivalent to:</li>
</ol>
<div class="cell">
<div class="sourceCode" id="cb102"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">lrn_rpart</span><span class="op">$</span><span class="va">timings</span>, both <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">lrn_rpart</span><span class="op">$</span><span class="va">timings</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  train predict    both 
  0.003   0.002   0.005 </code></pre>
</div>
</div>
<p>The <code>selected_features</code> measure calculates how many features were used in the fitted model.</p>
<div class="cell">
<div class="sourceCode" id="cb104"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">msr_sf</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">msr</a></span><span class="op">(</span><span class="st">"selected_features"</span><span class="op">)</span></span>
<span><span class="va">msr_sf</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;MeasureSelectedFeatures:selected_features&gt;: Absolute or Relative Frequency of Selected Features
* Packages: mlr3
* Range: [0, Inf]
* Minimize: TRUE
* Average: macro
* Parameters: normalize=FALSE
* Properties: requires_task, requires_learner, requires_model
* Predict type: NA</code></pre>
</div>
</div>
<div class="page-columns page-full"><p>We can see that this measure contains control parameters (<code>Parameters: normalize=FALSE</code>), which control how the measure is computed. As with hyperparameters these can be accessed with <code>$param_set</code>:</p><div class="no-row-height column-margin column-container"><span class="margin-aside">Control Parameters</span></div></div>
<div class="cell">
<div class="sourceCode" id="cb106"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">msr_sf</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">msr</a></span><span class="op">(</span><span class="st">"selected_features"</span><span class="op">)</span></span>
<span><span class="va">msr_sf</span><span class="op">$</span><span class="va">param_set</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;ParamSet&gt;
          id    class lower upper nlevels default value
1: normalize ParamLgl    NA    NA       2   FALSE FALSE</code></pre>
</div>
</div>
<p>The <code>normalize</code> hyperparameter specifies whether the returned number of selected features should be normalized by the total number of features, this is useful if you are comparing this value across tasks with differing numbers of features. We would change this parameter in the exact same way as we did with the learner above:</p>
<div class="cell">
<div class="sourceCode" id="cb108"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">msr_sf</span><span class="op">$</span><span class="va">param_set</span><span class="op">$</span><span class="va">values</span><span class="op">$</span><span class="va">normalize</span> <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="va">prediction</span><span class="op">$</span><span class="fu">score</span><span class="op">(</span><span class="va">msr_sf</span>, task <span class="op">=</span> <span class="va">tsk_mtcars</span>, learner <span class="op">=</span> <span class="va">lrn_rpart</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>selected_features 
              0.1 </code></pre>
</div>
</div>
<p>Note that we passed the task and learner as the measure has the <code>requires_task</code> and <code>requires_learner</code> properties.</p>
</section></section><section id="sec-basics-regr-experiment" class="level2" data-number="2.4"><h2 data-number="2.4" class="anchored" data-anchor-id="sec-basics-regr-experiment">
<span class="header-section-number">2.4</span> Our First Regression Experiment</h2>
<p>We have now seen how to train a model, make predictions and score them. What we have not yet attempted is to ascertain if our predictions are any ‘good’. So before look at how the building blocks of <code>mlr3</code> extend to classification, we will take a brief pause to put together everything above in a short experiment to assess the quality of our predictions. We will do this by comparing the performance of a featureless regression learner to a decision tree with changed hyperparameters.</p>
<div class="cell">
<div class="sourceCode" id="cb110"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://mlr3.mlr-org.com">mlr3</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">349</span><span class="op">)</span></span>
<span><span class="co"># load and partition our task</span></span>
<span><span class="va">tsk_mtcars</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">tsk</a></span><span class="op">(</span><span class="st">"mtcars"</span><span class="op">)</span></span>
<span><span class="va">splits</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/partition.html">partition</a></span><span class="op">(</span><span class="va">tsk_mtcars</span><span class="op">)</span></span>
<span><span class="co"># load featureless learner</span></span>
<span><span class="va">lrn_featureless</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">lrn</a></span><span class="op">(</span><span class="st">"regr.featureless"</span><span class="op">)</span></span>
<span><span class="co"># load decision tree and set hyperparameters</span></span>
<span><span class="va">lrn_rpart</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">lrn</a></span><span class="op">(</span><span class="st">"regr.rpart"</span>, cp <span class="op">=</span> <span class="fl">0.2</span>, maxdepth <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="co"># load MSE and MAE measures</span></span>
<span><span class="va">measures</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">msrs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"regr.mse"</span>, <span class="st">"regr.mae"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># train learners</span></span>
<span><span class="va">lrn_featureless</span><span class="op">$</span><span class="fu">train</span><span class="op">(</span><span class="va">tsk_mtcars</span>, <span class="va">splits</span><span class="op">$</span><span class="va">train</span><span class="op">)</span></span>
<span><span class="va">lrn_rpart</span><span class="op">$</span><span class="fu">train</span><span class="op">(</span><span class="va">tsk_mtcars</span>, <span class="va">splits</span><span class="op">$</span><span class="va">train</span><span class="op">)</span></span>
<span><span class="co"># make and score predictions</span></span>
<span><span class="va">lrn_featureless</span><span class="op">$</span><span class="fu">predict</span><span class="op">(</span><span class="va">tsk_mtcars</span>, <span class="va">splits</span><span class="op">$</span><span class="va">test</span><span class="op">)</span><span class="op">$</span><span class="fu">score</span><span class="op">(</span><span class="va">measures</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>regr.mse regr.mae 
  26.727    4.513 </code></pre>
</div>
<div class="sourceCode" id="cb112"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">lrn_rpart</span><span class="op">$</span><span class="fu">predict</span><span class="op">(</span><span class="va">tsk_mtcars</span>, <span class="va">splits</span><span class="op">$</span><span class="va">test</span><span class="op">)</span><span class="op">$</span><span class="fu">score</span><span class="op">(</span><span class="va">measures</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>regr.mse regr.mae 
   6.933    2.206 </code></pre>
</div>
</div>
<p>Before starting the experiment we load the <code>mlr3</code> library and set a seed. We loaded the <code>mtcars</code> task using <code><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">tsk()</a></code> and then split this using <code>partition</code> with the default 2/3 split. Next, we loaded a featureless baseline learner (<code>"regr.featureless"</code>) with the <code><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">lrn()</a></code> function. Then loaded a decision tree (<code>lrn("regr.rpart")</code>) but changed the complexity parameter and max tree depth from their defaults. We then used <code><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">msrs()</a></code> to load multiple measures at once, the mean squared error (MSE: <code>regr.mse</code>) and the mean absolute error (MAE: <code>regr.mae</code>). With all objects loaded, we trained our models, ensuring we passed the same training data to both. Finally, we made predictions from our trained models and scored these. For both MSE and MAE, lower values are ‘better’ (<code>Minimize: TRUE</code>) and we can therefore conclude that our decision tree performs better than the featureless baseline. In <a href="../chapter3/evaluation_and_benchmarking.html#sec-benchmarking" class="quarto-xref"><span>Section 3.3</span></a> we will see how to formalize comparison between models in a more efficient way using <a href="https://mlr3.mlr-org.com/reference/benchmark.html"><code>benchmark()</code></a>.</p>
<p>Now we have put everything together you may notice that our learners and measures both have the <code>"regr."</code> prefix, which is a handy way of reminding us that we are working with a regression task and therefore must make use of learners and measures built for regression. In the next section, we will extend the building blocks of <code>mlr3</code> to consider classification tasks, which make use of learners and measures with the <code>"classif."</code> prefix.</p>
</section><section id="sec-classif" class="level2 page-columns page-full" data-number="2.5"><h2 data-number="2.5" class="anchored" data-anchor-id="sec-classif">
<span class="header-section-number">2.5</span> Classification</h2>
<p>Classification problems are ones in which a model predicts a discrete, categorical target, as opposed to a continuous, numeric quantity. For example, predicting the species of penguin from its physical characteristics would be a classification problem as there is a defined set of species. <code>mlr3</code> ensures that the interface for all tasks is as similar as possible (if not identical) and therefore we will not repeat any content from the previous section but will just focus on differences that make classification a unique machine learning problem. We will first demonstrate the similarities between regression and classification by performing an experiment very similar to the one in <a href="#sec-basics-regr-experiment" class="quarto-xref"><span>Section 2.4</span></a>, using code that will now be familiar to you. We will then move to differences in tasks, learners and predictions, before looking at thresholding, which is a method specific to classification.</p>
<section id="sec-basics-classif-experiment" class="level3" data-number="2.5.1"><h3 data-number="2.5.1" class="anchored" data-anchor-id="sec-basics-classif-experiment">
<span class="header-section-number">2.5.1</span> Our First Classification Experiment</h3>
<p>The interface for classification tasks, learners, and measures, is identical to the regression setting, except the underlying objects inherit from <a href="https://mlr3.mlr-org.com/reference/TaskClassif.html"><code>TaskClassif</code></a>, <a href="https://mlr3.mlr-org.com/reference/LearnerClassif.html"><code>LearnerClassif</code></a>, and <a href="https://mlr3.mlr-org.com/reference/MeasureClassif.html"><code>MeasureClassif</code></a>, respectively. We can therefore run a very similar experiment to the one above.</p>
<div class="cell">
<div class="sourceCode" id="cb114"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://mlr3.mlr-org.com">mlr3</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">349</span><span class="op">)</span></span>
<span><span class="co"># load and partition our task</span></span>
<span><span class="va">tsk_penguins</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">tsk</a></span><span class="op">(</span><span class="st">"penguins"</span><span class="op">)</span></span>
<span><span class="va">splits</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/partition.html">partition</a></span><span class="op">(</span><span class="va">tsk_penguins</span><span class="op">)</span></span>
<span><span class="co"># load featureless learner</span></span>
<span><span class="va">lrn_featureless</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">lrn</a></span><span class="op">(</span><span class="st">"classif.featureless"</span><span class="op">)</span></span>
<span><span class="co"># load decision tree and set hyperparameters</span></span>
<span><span class="va">lrn_rpart</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">lrn</a></span><span class="op">(</span><span class="st">"classif.rpart"</span>, cp <span class="op">=</span> <span class="fl">0.2</span>, maxdepth <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="co"># load accuracy measure</span></span>
<span><span class="va">measure</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">msr</a></span><span class="op">(</span><span class="st">"classif.acc"</span><span class="op">)</span></span>
<span><span class="co"># train learners</span></span>
<span><span class="va">lrn_featureless</span><span class="op">$</span><span class="fu">train</span><span class="op">(</span><span class="va">tsk_penguins</span>, <span class="va">splits</span><span class="op">$</span><span class="va">train</span><span class="op">)</span></span>
<span><span class="va">lrn_rpart</span><span class="op">$</span><span class="fu">train</span><span class="op">(</span><span class="va">tsk_penguins</span>, <span class="va">splits</span><span class="op">$</span><span class="va">train</span><span class="op">)</span></span>
<span><span class="co"># make and score predictions</span></span>
<span><span class="va">lrn_featureless</span><span class="op">$</span><span class="fu">predict</span><span class="op">(</span><span class="va">tsk_penguins</span>, <span class="va">splits</span><span class="op">$</span><span class="va">test</span><span class="op">)</span><span class="op">$</span><span class="fu">score</span><span class="op">(</span><span class="va">measure</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>classif.acc 
     0.4425 </code></pre>
</div>
<div class="sourceCode" id="cb116"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">lrn_rpart</span><span class="op">$</span><span class="fu">predict</span><span class="op">(</span><span class="va">tsk_penguins</span>, <span class="va">splits</span><span class="op">$</span><span class="va">test</span><span class="op">)</span><span class="op">$</span><span class="fu">score</span><span class="op">(</span><span class="va">measure</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>classif.acc 
     0.9469 </code></pre>
</div>
</div>
<p>In this experiment, we loaded the predefined task <code>penguins</code>, which is based on the <a href="https://www.rdocumentation.org/packages/palmerpenguins/topics/penguins"><code>penguins</code></a> dataset, then partitioned the data into training and test splits. We loaded the featureless classification baseline (using the default which always predicts the most common class in the training data, but which also has the option of predicting (uniformly or weighted) random response values) and a classification decision tree, then the accuracy measure (number of correct predictions divided by total number of predictions), trained our models and finally made and scored predictions. Once again we can be happy with our predictions, which are vastly more accurate than the baseline.</p>
<p>Now that we have seen the similarities between classification and regression, we can turn to some key differences.</p>
</section><section id="taskclassif" class="level3 page-columns page-full" data-number="2.5.2"><h3 data-number="2.5.2" class="anchored" data-anchor-id="taskclassif">
<span class="header-section-number">2.5.2</span> TaskClassif</h3>
<div class="page-columns page-full"><p>Classification tasks, objects inheriting from <a href="https://mlr3.mlr-org.com/reference/TaskClassif.html"><code>TaskClassif</code></a>, are very similar to regression tasks, except that the target variable is of type factor and will have a limited number of possible classes/categories that observations can fall into.</p><div class="no-row-height column-margin column-container"><span class="margin-aside"><code>TaskClassif</code></span></div></div>
<p>You can view the predefined classification tasks in <code>mlr3</code> by filtering the <code>mlr_tasks</code> dictionary:</p>
<div class="cell">
<div class="sourceCode" id="cb118"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/as.data.table.html">as.data.table</a></span><span class="op">(</span><span class="va">mlr_tasks</span><span class="op">)</span><span class="op">[</span><span class="va">task_type</span> <span class="op">==</span> <span class="st">"classif"</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              key                                     label task_type
 1: breast_cancer                   Wisconsin Breast Cancer   classif
 2: german_credit                             German Credit   classif
 3:          ilpd                 Indian Liver Patient Data   classif
 4:          iris                              Iris Flowers   classif
 5:     optdigits Optical Recognition of Handwritten Digits   classif
---                                                                  
 9:         sonar                    Sonar: Mines vs. Rocks   classif
10:          spam                         HP Spam Detection   classif
11:       titanic                                   Titanic   classif
12:          wine                              Wine Regions   classif
13:           zoo                               Zoo Animals   classif
10 variables not shown: [nrow, ncol, properties, lgl, int, dbl, chr, fct, ord, pxc]</code></pre>
</div>
</div>
<div class="page-columns page-full"><p>You can create your own task with <a href="https://mlr3.mlr-org.com/reference/as_task_classif.html"><code>as_task_classif</code></a>.</p><div class="no-row-height column-margin column-container"><span class="margin-aside"><code>as_task_classif</code></span></div></div>
<div class="cell">
<div class="sourceCode" id="cb120"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://mlr3.mlr-org.com/reference/as_task_classif.html">as_task_classif</a></span><span class="op">(</span><span class="fu">palmerpenguins</span><span class="fu">::</span><span class="va"><a href="https://allisonhorst.github.io/palmerpenguins/reference/penguins.html">penguins</a></span>, target <span class="op">=</span> <span class="st">"species"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;TaskClassif:palmerpenguins::penguins&gt; (344 x 8)
* Target: species
* Properties: multiclass
* Features (7):
  - int (3): body_mass_g, flipper_length_mm, year
  - dbl (2): bill_depth_mm, bill_length_mm
  - fct (2): island, sex</code></pre>
</div>
</div>
<p>There are two types of classification tasks supported in <code>mlr3</code>: binary classification, in which the outcome can be one of two categories, and multiclass classification, where the outcome can be one of three or more categories.</p>
<p>The <code>sonar</code> task is an example of a binary classification problem, as the target can only take two different values, in <code>mlr3</code> terminology it has the “twoclass” property:</p>
<div class="cell">
<div class="sourceCode" id="cb122"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tsk_sonar</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">tsk</a></span><span class="op">(</span><span class="st">"sonar"</span><span class="op">)</span></span>
<span><span class="va">tsk_sonar</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;TaskClassif:sonar&gt; (208 x 61): Sonar: Mines vs. Rocks
* Target: Class
* Properties: twoclass
* Features (60):
  - dbl (60): V1, V10, V11, V12, V13, V14, V15, V16, V17, V18,
    V19, V2, V20, V21, V22, V23, V24, V25, V26, V27, V28, V29,
    V3, V30, V31, V32, V33, V34, V35, V36, V37, V38, V39, V4,
    V40, V41, V42, V43, V44, V45, V46, V47, V48, V49, V5, V50,
    V51, V52, V53, V54, V55, V56, V57, V58, V59, V6, V60, V7,
    V8, V9</code></pre>
</div>
<div class="sourceCode" id="cb124"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tsk_sonar</span><span class="op">$</span><span class="va">class_names</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "M" "R"</code></pre>
</div>
</div>
<p>In contrast, <code>tsk("penguins")</code> is a multiclass problem as there are more than two species of penguins; it has the “multiclass” property:</p>
<div class="cell">
<div class="sourceCode" id="cb126"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tsk_penguins</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">tsk</a></span><span class="op">(</span><span class="st">"penguins"</span><span class="op">)</span></span>
<span><span class="va">tsk_penguins</span><span class="op">$</span><span class="va">properties</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "multiclass"</code></pre>
</div>
<div class="sourceCode" id="cb128"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">tsk_penguins</span><span class="op">$</span><span class="va">class_names</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Adelie"    "Chinstrap" "Gentoo"   </code></pre>
</div>
</div>
<div class="page-columns page-full"><p>A further difference between these tasks is that binary classification tasks have an extra field called <code>$positive</code>, which defines the ‘positive’ class. In binary classification, as there are only two possible class types, by convention one of these is known as the ‘positive’ class, and the other as the ‘negative’ class. It is arbitrary which is which, though often the more ‘important’ (and often smaller) class is set as the positive class. You can set the positive class during or after construction. If no positive class is specified then <code>mlr3</code> assumes the first level in the <code>target</code> column is the positive class, which can lead to misleading results.</p><div class="no-row-height column-margin column-container"><span class="margin-aside">$positive</span></div></div>
<div class="cell">
<div class="sourceCode" id="cb130"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Load the "Sonar" dataset from the "mlbench" package as an example</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">Sonar</span>, package <span class="op">=</span> <span class="st">"mlbench"</span><span class="op">)</span></span>
<span><span class="co"># specifying the positive class:</span></span>
<span><span class="va">tsk_classif</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/as_task_classif.html">as_task_classif</a></span><span class="op">(</span><span class="va">Sonar</span>, target <span class="op">=</span> <span class="st">"Class"</span>, positive <span class="op">=</span> <span class="st">"R"</span><span class="op">)</span></span>
<span><span class="va">tsk_classif</span><span class="op">$</span><span class="va">positive</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "R"</code></pre>
</div>
<div class="sourceCode" id="cb132"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># changing after construction</span></span>
<span><span class="va">tsk_classif</span><span class="op">$</span><span class="va">positive</span> <span class="op">=</span> <span class="st">"M"</span></span>
<span><span class="va">tsk_classif</span><span class="op">$</span><span class="va">positive</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "M"</code></pre>
</div>
</div>
<p>While the choice of positive and negative class is arbitrary, they are essential to ensuring results from models and performance measures are interpreted as expected – this is best demonstrated when we discuss thresholding (<a href="#sec-classif-prediction" class="quarto-xref"><span>Section 2.5.4</span></a>) and ROC metrics (<a href="../chapter3/evaluation_and_benchmarking.html#sec-roc" class="quarto-xref"><span>Section 3.4</span></a>).</p>
<p>Finally, plotting is possible with <a href="https://mlr3viz.mlr-org.com/reference/autoplot.TaskClassif.html"><code>autoplot.TaskClassif</code></a>, below we plot a comparison between the target column and features.</p>
<div class="cell">
<div class="sourceCode" id="cb134"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">tsk</a></span><span class="op">(</span><span class="st">"penguins"</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"duo"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>strip.text.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="op">-</span><span class="fl">45</span>, size <span class="op">=</span> <span class="fl">8</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-penguins-overview" class="quarto-figure quarto-figure-center quarto-float anchored" alt="Diagram showing the distribution of target and feature values for a subset of the penguins data. The 'Adelie' species has an even split between male/female, short bill length and average bill depth. The 'Chinstrap' species only come from the island 'Dream' and have a lower body mass. The 'Gentoo' species only come from the island 'Biscoe', and have a longer flipper length and higher body mass.">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-penguins-overview-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="data_and_basic_modeling_files/figure-html/fig-penguins-overview-1.png" class="img-fluid figure-img" style="width:100.0%" alt="Diagram showing the distribution of target and feature values for a subset of the penguins data. The 'Adelie' species has an even split between male/female, short bill length and average bill depth. The 'Chinstrap' species only come from the island 'Dream' and have a lower body mass. The 'Gentoo' species only come from the island 'Biscoe', and have a longer flipper length and higher body mass.">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-penguins-overview-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.4: Overview of part of the penguins dataset.
</figcaption></figure>
</div>
</div>
</div>
</section><section id="sec-basics-classif-learner" class="level3 page-columns page-full" data-number="2.5.3"><h3 data-number="2.5.3" class="anchored" data-anchor-id="sec-basics-classif-learner">
<span class="header-section-number">2.5.3</span> LearnerClassif and MeasureClassif</h3>
<div class="page-columns page-full"><p>Classification learners, which inherit from <a href="https://mlr3.mlr-org.com/reference/LearnerClassif.html"><code>LearnerClassif</code></a>, have nearly the same interface as regression learners. However, a key difference is that the possible predictions in classification are either <code>"response"</code> – predicting an observation’s class (a penguin’s species in our example, this is sometimes called “hard labeling”) – or <code>"prob"</code> – predicting a vector of probabilities, also called “posterior probabilities”, of an observation belonging to each class. In classification, the latter can be more useful as it provides information about the confidence of the predictions:</p><div class="no-row-height column-margin column-container"><span class="margin-aside"><code>LearnerClassif</code></span></div></div>
<div class="cell">
<div class="sourceCode" id="cb135"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">lrn_rpart</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">lrn</a></span><span class="op">(</span><span class="st">"classif.rpart"</span>, predict_type <span class="op">=</span> <span class="st">"prob"</span><span class="op">)</span></span>
<span><span class="va">lrn_rpart</span><span class="op">$</span><span class="fu">train</span><span class="op">(</span><span class="va">tsk_penguins</span>, <span class="va">splits</span><span class="op">$</span><span class="va">train</span><span class="op">)</span></span>
<span><span class="va">prediction</span> <span class="op">=</span> <span class="va">lrn_rpart</span><span class="op">$</span><span class="fu">predict</span><span class="op">(</span><span class="va">tsk_penguins</span>, <span class="va">splits</span><span class="op">$</span><span class="va">test</span><span class="op">)</span></span>
<span><span class="va">prediction</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;PredictionClassif&gt; for 113 observations:
    row_ids     truth  response prob.Adelie prob.Chinstrap prob.Gentoo
          2    Adelie    Adelie     0.97030         0.0297     0.00000
          4    Adelie    Adelie     0.97030         0.0297     0.00000
          7    Adelie    Adelie     0.97030         0.0297     0.00000
---                                                                   
        338 Chinstrap Chinstrap     0.04651         0.9302     0.02326
        341 Chinstrap    Adelie     0.97030         0.0297     0.00000
        344 Chinstrap Chinstrap     0.04651         0.9302     0.02326</code></pre>
</div>
</div>
<p>Notice how the predictions include the predicted probabilities for all three classes, as well as the <code>response</code>, which (by default) is the class with the highest predicted probability.</p>
<div class="page-columns page-full"><p>Also, the interface for classification measures, which are of class <a href="https://mlr3.mlr-org.com/reference/MeasureClassif.html"><code>MeasureClassif</code></a>, is identical to regression measures. The key difference in usage is that you will need to ensure your selected measure evaluates the prediction type of interest. To evaluate <code>"response"</code> predictions, you will need measures with <code>predict_type = "response"</code>, or to evaluate probability predictions you will need <code>predict_type = "prob"</code>. The easiest way to find these measures is by filtering the <a href="https://mlr3.mlr-org.com/reference/mlr_measures.html"><code>mlr_measures</code></a> dictionary:</p><div class="no-row-height column-margin column-container"><span class="margin-aside"><code>MeasureClassif</code></span></div></div>
<div class="cell">
<div class="sourceCode" id="cb137"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/as.data.table.html">as.data.table</a></span><span class="op">(</span><span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">msr</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">[</span></span>
<span>    <span class="va">task_type</span> <span class="op">==</span> <span class="st">"classif"</span> <span class="op">&amp;</span> <span class="va">predict_type</span> <span class="op">==</span> <span class="st">"prob"</span> <span class="op">&amp;</span></span>
<span>    <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">task_properties</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="st">"twoclass"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">x</span><span class="op">)</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                 key                                      label
1:   classif.logloss                                   Log Loss
2: classif.mauc_au1p    Weighted average 1 vs. 1 multiclass AUC
3: classif.mauc_au1u             Average 1 vs. 1 multiclass AUC
4: classif.mauc_aunp Weighted average 1 vs. rest multiclass AUC
5: classif.mauc_aunu          Average 1 vs. rest multiclass AUC
6:    classif.mbrier                     Multiclass Brier Score
4 variables not shown: [task_type, packages, predict_type, task_properties]</code></pre>
</div>
</div>
<p>We also filtered to remove any measures that have the <code>"twoclass"</code> property as this would conflict with our <code>"multiclass"</code> task. We need to use <code>sapply</code> for this, the <code>task_properties</code> column is a list column. We can evaluate the quality of our probability predictions and response predictions simultaneously by providing multiple measures:</p>
<div class="cell">
<div class="sourceCode" id="cb139"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">measures</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">msrs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"classif.mbrier"</span>, <span class="st">"classif.logloss"</span>, <span class="st">"classif.acc"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">prediction</span><span class="op">$</span><span class="fu">score</span><span class="op">(</span><span class="va">measures</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> classif.mbrier classif.logloss     classif.acc 
         0.1017          0.2291          0.9469 </code></pre>
</div>
</div>
<p>The accuracy measure evaluates the <code>"response"</code> predictions whereas the Brier score (<code>"classif.mbrier"</code>, squared difference between predicted probabilities and the truth) and logloss (<code>"classif.logloss"</code>, negative logarithm of the predicted probability for the true class) are evaluating the probability predictions.</p>
<p>If no measure is passed to <code>$score()</code>, the default is the classification error (<code>msr("classif.ce")</code>), which is the number of misclassifications divided by the number of predictions, i.e., <span class="math inline">\(1 -\)</span> <code>msr("classif.acc")</code>.</p>
</section><section id="sec-classif-prediction" class="level3 page-columns page-full" data-number="2.5.4"><h3 data-number="2.5.4" class="anchored" data-anchor-id="sec-classif-prediction">
<span class="header-section-number">2.5.4</span> <code>PredictionClassif</code>, Confusion Matrix, and Thresholding</h3>
<div class="page-columns page-full"><p><a href="https://mlr3.mlr-org.com/reference/PredictionClassif.html"><code>PredictionClassif</code></a> objects have two important differences from their regression analog. Firstly, the added field <code>$confusion</code>, and secondly the added method <code>$set_threshold()</code>.</p><div class="no-row-height column-margin column-container"><span class="margin-aside"><code>PredictionClassif</code></span></div></div>
<section id="confusion-matrix" class="level4 unnumbered unlisted page-columns page-full"><h4 class="unnumbered unlisted anchored" data-anchor-id="confusion-matrix">Confusion matrix</h4>
<div class="page-columns page-full"><p>A confusion matrix is a popular way to show the quality of classification (response) predictions in a more detailed fashion by seeing if a model is good at (mis)classifying observations in a particular class. For binary and multiclass classification, the confusion matrix is stored in the <code>$confusion</code> field of the <a href="https://mlr3.mlr-org.com/reference/PredictionClassif.html"><code>PredictionClassif</code></a> object:</p><div class="no-row-height column-margin column-container"><span class="margin-aside">Confusion Matrix</span><span class="margin-aside">$confusion</span></div></div>
<div class="cell">
<div class="sourceCode" id="cb141"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">prediction</span><span class="op">$</span><span class="va">confusion</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           truth
response    Adelie Chinstrap Gentoo
  Adelie        49         3      0
  Chinstrap      1        18      1
  Gentoo         0         1     40</code></pre>
</div>
</div>
<p>The rows in a confusion matrix are the predicted class and the columns are the true class. All off-diagonal entries are incorrectly classified observations, and all diagonal entries are correctly classified. In this case, the classifier does fairly well classifying all penguins, but we could have found that it only classifies the Adelie species well but often conflates Chinstrap and Gentoo, for example.</p>
<p>You can visualize the predicted class labels with <code>autoplot.PredictionClassif()</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb143"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">prediction</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="fig-basics-classlabels" class="quarto-figure quarto-figure-center quarto-float anchored" alt="Two stacked bar plots. Bottom left corresponds to true number of Gentoo species (41), middle left is true Chinstrap (22) and top left is true Adelie (50). Bottom right is predicted number of Gentoo species (41), middle right is Chinstrap (20), and top right is Adelie (52).">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-basics-classlabels-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="data_and_basic_modeling_files/figure-html/fig-basics-classlabels-1.png" class="img-fluid figure-img" style="width:70.0%" alt="Two stacked bar plots. Bottom left corresponds to true number of Gentoo species (41), middle left is true Chinstrap (22) and top left is true Adelie (50). Bottom right is predicted number of Gentoo species (41), middle right is Chinstrap (20), and top right is Adelie (52).">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-basics-classlabels-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.5: Counts of each class label in the ground truth data (left) and predictions (right).
</figcaption></figure>
</div>
</div>
</div>
<p>In the binary classification case, the top left entry corresponds to true positives, the top right to false positives, the bottom left to false negatives and the bottom right to true negatives. Taking <code>tsk_sonar</code> as an example with <code>M</code> as the positive class:</p>
<div class="cell">
<div class="sourceCode" id="cb144"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">splits</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/partition.html">partition</a></span><span class="op">(</span><span class="va">tsk_sonar</span><span class="op">)</span></span>
<span><span class="va">lrn_rpart</span><span class="op">$</span></span>
<span>  <span class="fu">train</span><span class="op">(</span><span class="va">tsk_sonar</span>, <span class="va">splits</span><span class="op">$</span><span class="va">train</span><span class="op">)</span><span class="op">$</span></span>
<span>  <span class="fu">predict</span><span class="op">(</span><span class="va">tsk_sonar</span>, <span class="va">splits</span><span class="op">$</span><span class="va">test</span><span class="op">)</span><span class="op">$</span></span>
<span>  <span class="va">confusion</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        truth
response  M  R
       M 27 10
       R 10 22</code></pre>
</div>
</div>
<p>We will return to the concept of binary (mis)classification in greater detail in <a href="../chapter3/evaluation_and_benchmarking.html#sec-roc" class="quarto-xref"><span>Section 3.4</span></a>.</p>
</section><section id="thresholding" class="level4 unnumbered unlisted page-columns page-full"><h4 class="unnumbered unlisted anchored" data-anchor-id="thresholding">Thresholding</h4>
<div class="page-columns page-full"><p>The final big difference compared to regression we will discuss is thresholding. We saw previously that the default <code>response</code> prediction type is the class with the highest predicted probability. For <code>k</code> classes with predicted probabilities <span class="math inline">\(p_1,\dots,p_k\)</span>, this is the same as saying <code>response</code> = argmax<span class="math inline">\(\{p_1,\dots,p_k\}\)</span>. If the maximum probability is not unique, i.e., multiple classes are predicted to have the highest probability, then the response is chosen randomly from these. In binary classification, this means that the positive class will be selected if the predicted class is greater than 50%, and the negative class otherwise.</p><div class="no-row-height column-margin column-container"><span class="margin-aside">Thresholding</span></div></div>
<p>This 50% value is known as the threshold and it can be useful to change this threshold if there is class imbalance (when one class is over- or under-represented in a dataset), or if there are different costs associated with classes, or simply if there is a preference to ‘over’-predict one class. As an example, let us take <code>tsk("german_credit")</code> in which 700 customers have good credit and 300 have bad. Now we could easily build a model with around “70%” accuracy simply by always predicting a customer will have good credit:</p>
<div class="cell">
<div class="sourceCode" id="cb146"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">task_credit</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">tsk</a></span><span class="op">(</span><span class="st">"german_credit"</span><span class="op">)</span></span>
<span><span class="va">lrn_featureless</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">lrn</a></span><span class="op">(</span><span class="st">"classif.featureless"</span>, predict_type <span class="op">=</span> <span class="st">"prob"</span><span class="op">)</span></span>
<span><span class="va">split</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/partition.html">partition</a></span><span class="op">(</span><span class="va">task_credit</span><span class="op">)</span></span>
<span><span class="va">lrn_featureless</span><span class="op">$</span><span class="fu">train</span><span class="op">(</span><span class="va">task_credit</span>, <span class="va">split</span><span class="op">$</span><span class="va">train</span><span class="op">)</span></span>
<span><span class="va">prediction</span> <span class="op">=</span> <span class="va">lrn_featureless</span><span class="op">$</span><span class="fu">predict</span><span class="op">(</span><span class="va">task_credit</span>, <span class="va">split</span><span class="op">$</span><span class="va">test</span><span class="op">)</span></span>
<span><span class="va">prediction</span><span class="op">$</span><span class="fu">score</span><span class="op">(</span><span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">msr</a></span><span class="op">(</span><span class="st">"classif.acc"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>classif.acc 
        0.7 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb148"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">prediction</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="cell-output-display">
<div id="fig-basics-classlabels-german" class="quarto-figure quarto-figure-center quarto-float anchored" alt="Two stacked bar plots. Bottom left corresponds to true number of 'good' customers (231) and top left is 'bad' customers (99). Right is a single bar corresponding to 330 'good' predictions, 'bad' is never predicted.">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-basics-classlabels-german-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="data_and_basic_modeling_files/figure-html/fig-basics-classlabels-german-1.png" class="img-fluid figure-img" style="width:70.0%" alt="Two stacked bar plots. Bottom left corresponds to true number of 'good' customers (231) and top left is 'bad' customers (99). Right is a single bar corresponding to 330 'good' predictions, 'bad' is never predicted.">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-basics-classlabels-german-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.6: Class labels ground truth (left) and predictions (right). The learner completely ignores the ‘bad’ class.
</figcaption></figure>
</div>
</div>
</div>
<p>While this model may appear to have good performance on the surface, in fact, it just ignores all ‘bad’ customers – this can create big problems in this finance example, as well as in healthcare tasks and other settings where false positives cost more than false negatives (see <a href="../chapter13/beyond_regression_and_classification.html#sec-cost-sens" class="quarto-xref"><span>Section 13.1</span></a> for cost-sensitive classification).</p>
<p>Thresholding allows classes to be selected with a different probability threshold, so instead of predicting that a customer has bad credit if P(good) &lt; 50%, we might predict bad credit if P(good) &lt; 70% – notice how we write this in terms of the positive class, which in this task is ‘good’. Let us see this in practice:</p>
<div class="cell">
<div class="sourceCode" id="cb149"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">prediction</span><span class="op">$</span><span class="fu">set_threshold</span><span class="op">(</span><span class="fl">0.7</span><span class="op">)</span></span>
<span><span class="va">prediction</span><span class="op">$</span><span class="fu">score</span><span class="op">(</span><span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">msr</a></span><span class="op">(</span><span class="st">"classif.acc"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>classif.acc 
     0.5394 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb151"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">lrn_rpart</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">lrn</a></span><span class="op">(</span><span class="st">"classif.rpart"</span>, predict_type <span class="op">=</span> <span class="st">"prob"</span><span class="op">)</span></span>
<span><span class="va">lrn_rpart</span><span class="op">$</span><span class="fu">train</span><span class="op">(</span><span class="va">task_credit</span>, <span class="va">split</span><span class="op">$</span><span class="va">train</span><span class="op">)</span></span>
<span><span class="va">prediction</span> <span class="op">=</span> <span class="va">lrn_rpart</span><span class="op">$</span><span class="fu">predict</span><span class="op">(</span><span class="va">task_credit</span>, <span class="va">split</span><span class="op">$</span><span class="va">test</span><span class="op">)</span></span>
<span><span class="va">prediction</span><span class="op">$</span><span class="fu">score</span><span class="op">(</span><span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">msr</a></span><span class="op">(</span><span class="st">"classif.acc"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>classif.acc 
     0.6939 </code></pre>
</div>
<div class="sourceCode" id="cb153"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">prediction</span><span class="op">$</span><span class="va">confusion</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        truth
response good bad
    good  194  64
    bad    37  35</code></pre>
</div>
<div class="sourceCode" id="cb155"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">prediction</span><span class="op">$</span><span class="fu">set_threshold</span><span class="op">(</span><span class="fl">0.7</span><span class="op">)</span></span>
<span><span class="va">prediction</span><span class="op">$</span><span class="fu">score</span><span class="op">(</span><span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">msr</a></span><span class="op">(</span><span class="st">"classif.acc"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>classif.acc 
     0.6879 </code></pre>
</div>
<div class="sourceCode" id="cb157"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">prediction</span><span class="op">$</span><span class="va">confusion</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        truth
response good bad
    good  181  53
    bad    50  46</code></pre>
</div>
</div>
<p>While our model performs ‘worse’ overall, i.e.&nbsp;with lower accuracy, it is still a ‘better’ model as it more accurately captures the relationship between classes.</p>
<p>In the binary classification setting, <code>$set_threshold()</code> only requires one numeric argument, which corresponds with the threshold for the positive class – hence it is essential to ensure the positive class is correctly set in your task.</p>
<p>In multiclass classification, thresholding works by first assigning a threshold to each of the <code>n</code> classes, dividing the predicted probabilities for each class by these thresholds to return <code>n</code> ratios, and then the class with the highest ratio is selected. For example, say we are predicting if a new observation will be of class A, B, C, or D and we have predicted <span class="math inline">\(P(A = 0.2), P(B = 0.4), P(C = 0.1), P(D = 0.3)\)</span>. We will assume that the threshold for all classes is identical and <code>1</code>:</p>
<div class="cell">
<div class="sourceCode" id="cb159"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">probs</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.4</span>, <span class="fl">0.1</span>, <span class="fl">0.3</span><span class="op">)</span></span>
<span><span class="va">thresholds</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>A <span class="op">=</span> <span class="fl">1</span>, B <span class="op">=</span> <span class="fl">1</span>, C <span class="op">=</span> <span class="fl">1</span>, D <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">probs</span><span class="op">/</span><span class="va">thresholds</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  A   B   C   D 
0.2 0.4 0.1 0.3 </code></pre>
</div>
</div>
<p>We would therefore predict our observation is of class B as this is the highest ratio. However, we could change our thresholds so that D has the lowest threshold and is most likely to be predicted, A has the highest threshold, and B and C have equal thresholds:</p>
<div class="cell">
<div class="sourceCode" id="cb161"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">thresholds</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>A <span class="op">=</span> <span class="fl">0.5</span>, B <span class="op">=</span> <span class="fl">0.25</span>, C <span class="op">=</span> <span class="fl">0.25</span>, D <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="va">probs</span><span class="op">/</span><span class="va">thresholds</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  A   B   C   D 
0.4 1.6 0.4 3.0 </code></pre>
</div>
</div>
<p>Now our observation will be predicted to be in class D.</p>
<p>In <code>mlr3</code>, this is achieved by passing a named list to <code>$set_threshold()</code>. This is demonstrated below with <code>tsk("zoo")</code>. Before changing the thresholds, some classes are never predicted and some are predicted more often than they occur.</p>
<div class="cell">
<div class="sourceCode" id="cb163"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com">patchwork</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">tsk_zoo</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">tsk</a></span><span class="op">(</span><span class="st">"zoo"</span><span class="op">)</span></span>
<span><span class="va">splits</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/partition.html">partition</a></span><span class="op">(</span><span class="va">tsk_zoo</span><span class="op">)</span></span>
<span><span class="va">lrn_rpart</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">lrn</a></span><span class="op">(</span><span class="st">"classif.rpart"</span>, predict_type <span class="op">=</span> <span class="st">"prob"</span><span class="op">)</span></span>
<span><span class="va">lrn_rpart</span><span class="op">$</span><span class="fu">train</span><span class="op">(</span><span class="va">tsk_zoo</span>, <span class="va">splits</span><span class="op">$</span><span class="va">train</span><span class="op">)</span></span>
<span><span class="va">prediction</span> <span class="op">=</span> <span class="va">lrn_rpart</span><span class="op">$</span><span class="fu">predict</span><span class="op">(</span><span class="va">tsk_zoo</span>, <span class="va">splits</span><span class="op">$</span><span class="va">test</span><span class="op">)</span></span>
<span><span class="va">before</span> <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">prediction</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Default thresholds"</span><span class="op">)</span></span>
<span><span class="va">new_thresh</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/proportions.html">proportions</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">tsk_zoo</span><span class="op">$</span><span class="fu">truth</span><span class="op">(</span><span class="va">splits</span><span class="op">$</span><span class="va">train</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">new_thresh</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
       mammal          bird       reptile          fish     amphibian 
      0.40299       0.19403       0.04478       0.13433       0.04478 
       insect mollusc.et.al 
      0.07463       0.10448 </code></pre>
</div>
<div class="sourceCode" id="cb165"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">prediction</span><span class="op">$</span><span class="fu">set_threshold</span><span class="op">(</span><span class="va">new_thresh</span><span class="op">)</span></span>
<span><span class="va">after</span> <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html">autoplot</a></span><span class="op">(</span><span class="va">prediction</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"Inverse weighting thresholds"</span><span class="op">)</span></span>
<span><span class="va">before</span> <span class="op">+</span> <span class="va">after</span> <span class="op">+</span> <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_layout.html">plot_layout</a></span><span class="op">(</span>guides <span class="op">=</span> <span class="st">"collect"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-zoopreds" class="quarto-figure quarto-figure-center quarto-float anchored" alt="Four stacked barplots comparing predictions before and after thresholding. Before thresholding some classes are over-predicted and some are never predicted. After thresholding there is still some imbalance but less drastic.">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-zoopreds-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="data_and_basic_modeling_files/figure-html/fig-zoopreds-1.png" class="img-fluid figure-img" style="width:100.0%" alt="Four stacked barplots comparing predictions before and after thresholding. Before thresholding some classes are over-predicted and some are never predicted. After thresholding there is still some imbalance but less drastic.">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-zoopreds-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2.7: Comparing predicted and ground truth values for the zoo dataset.
</figcaption></figure>
</div>
</div>
</div>
<p>Again we see that the model better represents all classes after thresholding. In this example we set the new thresholds to be the proportions of each class in the training set. This is known as inverse weighting, as we divide the predicted probability by these class proportions before we select the label with the highest ratio.</p>
<p>In <a href="../chapter13/beyond_regression_and_classification.html#sec-cost-sens" class="quarto-xref"><span>Section 13.1</span></a> we will look at cost-sensitive classification where each cell in the confusion matrix has a different associated cost.</p>
</section></section></section><section id="sec-row-col-roles" class="level2" data-number="2.6"><h2 data-number="2.6" class="anchored" data-anchor-id="sec-row-col-roles">
<span class="header-section-number">2.6</span> Task Column Roles</h2>
<div class="callout callout-style-simple callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
This section covers advanced ML or technical details.
</div>
</div>
<div class="callout-body-container callout-body">

</div>
</div>
<p>Now that we have covered regression and classification, we will briefly return to tasks and in particular to column roles, which are used to customize tasks further. Column roles are used by <code>Task</code> objects to define important metadata that can be used by learners and other objects to interact with the task. True to their name, they assign particular roles to columns in the data, we have already seen some of these in action with targets and features. There are seven column roles:</p>
<ol type="1">
<li>
<code>"feature"</code>: Features used for prediction.</li>
<li>
<code>"target"</code>: Target variable to predict.</li>
<li>
<code>"name"</code>: Row names/observation labels, e.g., for <code>mtcars</code> this is the <code>"model"</code> column.</li>
<li>
<code>"order"</code>: Variable(s) used to order data returned by <code>$data()</code>; must be sortable with <code><a href="https://rdrr.io/r/base/order.html">order()</a></code>.</li>
<li>
<code>"group"</code>: Variable used to keep observations together during resampling.</li>
<li>
<code>"stratum"</code>: Variable(s) to stratify during resampling.</li>
<li>
<code>"weight"</code>: Observation weights. Only one numeric column may have this role.</li>
</ol>
<p>We have already seen how features and targets work in <a href="#sec-tasks" class="quarto-xref"><span>Section 2.1</span></a>, which are the only column roles that each task must have. In <a href="../chapter3/evaluation_and_benchmarking.html#sec-strat-group" class="quarto-xref"><span>Section 3.2.5</span></a> we will have a look at the <code>stratum</code> and <code>group</code> column roles. So, for now, we will only look at <code>order</code>, and <code>weight</code>. We will not go into detail about <code>name</code>, which is primarily used in plotting and will almost always be the <code><a href="https://rdrr.io/r/base/colnames.html">rownames()</a></code> of the underlying data.</p>
<p>Column roles are updated using <code>$set_col_roles()</code>. When we set the <code>"order"</code> column role, the data is ordered according to that column(s). In the following example, we set the <code>"order"</code> column role and then order data by this column by including <code>ordered = TRUE</code>:</p>
<div class="cell">
<div class="sourceCode" id="cb166"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">df</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">mtcars</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, <span class="op">]</span>, idx <span class="op">=</span> <span class="fl">2</span><span class="op">:</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">tsk_mtcars_order</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/as_task_regr.html">as_task_regr</a></span><span class="op">(</span><span class="va">df</span>, target <span class="op">=</span> <span class="st">"mpg"</span><span class="op">)</span></span>
<span><span class="co"># original order</span></span>
<span><span class="va">tsk_mtcars_order</span><span class="op">$</span><span class="fu">data</span><span class="op">(</span>ordered <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   mpg am carb cyl disp drat gear  hp idx  qsec vs    wt
1:  21  1    4   6  160  3.9    4 110   2 16.46  0 2.620
2:  21  1    4   6  160  3.9    4 110   1 17.02  0 2.875</code></pre>
</div>
<div class="sourceCode" id="cb168"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># order by "idx" column</span></span>
<span><span class="va">tsk_mtcars_order</span><span class="op">$</span><span class="fu">set_col_roles</span><span class="op">(</span><span class="st">"idx"</span>, roles <span class="op">=</span> <span class="st">"order"</span><span class="op">)</span></span>
<span><span class="va">tsk_mtcars_order</span><span class="op">$</span><span class="fu">data</span><span class="op">(</span>ordered <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   mpg am carb cyl disp drat gear  hp  qsec vs    wt
1:  21  1    4   6  160  3.9    4 110 17.02  0 2.875
2:  21  1    4   6  160  3.9    4 110 16.46  0 2.620</code></pre>
</div>
</div>
<p>In this example we can see that by setting <code>"idx"</code> to have the <code>"order"</code> column role, it is no longer used as a feature when we run <code>$data()</code> but instead is used to order the observations according to its value. This metadata is not passed to a learner.</p>
<p>The <code>weights</code> column role is used to weight data points differently. One example of why we would do this is in classification tasks with severe class imbalance, where weighting the minority class more heavily may improve the model’s predictive performance for that class. For example in the <code>breast_cancer</code> dataset, there are more instances of benign tumors than malignant tumors, so if we want to better predict malignant tumors we could weight the data in favor of this class:</p>
<div class="cell">
<div class="sourceCode" id="cb170"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">cancer_unweighted</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">tsk</a></span><span class="op">(</span><span class="st">"breast_cancer"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">cancer_unweighted</span><span class="op">$</span><span class="fu">data</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">class</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>malignant    benign 
      239       444 </code></pre>
</div>
<div class="sourceCode" id="cb172"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># add column where weight is 2 if class "malignant", and 1 otherwise</span></span>
<span><span class="va">df</span> <span class="op">=</span> <span class="va">cancer_unweighted</span><span class="op">$</span><span class="fu">data</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">df</span><span class="op">$</span><span class="va">weights</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">class</span> <span class="op">==</span> <span class="st">"malignant"</span>, <span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create new task and role</span></span>
<span><span class="va">cancer_weighted</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/as_task_classif.html">as_task_classif</a></span><span class="op">(</span><span class="va">df</span>, target <span class="op">=</span> <span class="st">"class"</span><span class="op">)</span></span>
<span><span class="va">cancer_weighted</span><span class="op">$</span><span class="fu">set_col_roles</span><span class="op">(</span><span class="st">"weights"</span>, roles <span class="op">=</span> <span class="st">"weight"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># compare weighted and unweighted predictions</span></span>
<span><span class="va">split</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/partition.html">partition</a></span><span class="op">(</span><span class="va">cancer_unweighted</span><span class="op">)</span></span>
<span><span class="va">lrn_rf</span> <span class="op">=</span> <span class="fu"><a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html">lrn</a></span><span class="op">(</span><span class="st">"classif.ranger"</span><span class="op">)</span></span>
<span><span class="va">lrn_rf</span><span class="op">$</span><span class="fu">train</span><span class="op">(</span><span class="va">cancer_unweighted</span>, <span class="va">split</span><span class="op">$</span><span class="va">train</span><span class="op">)</span><span class="op">$</span></span>
<span>  <span class="fu">predict</span><span class="op">(</span><span class="va">cancer_unweighted</span>, <span class="va">split</span><span class="op">$</span><span class="va">test</span><span class="op">)</span><span class="op">$</span><span class="fu">score</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>classif.ce 
    0.0177 </code></pre>
</div>
<div class="sourceCode" id="cb174"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">lrn_rf</span><span class="op">$</span><span class="fu">train</span><span class="op">(</span><span class="va">cancer_weighted</span>, <span class="va">split</span><span class="op">$</span><span class="va">train</span><span class="op">)</span><span class="op">$</span></span>
<span>  <span class="fu">predict</span><span class="op">(</span><span class="va">cancer_weighted</span>, <span class="va">split</span><span class="op">$</span><span class="va">test</span><span class="op">)</span><span class="op">$</span><span class="fu">score</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>classif.ce 
   0.00885 </code></pre>
</div>
</div>
<p>In this example, weighting improves the overall model performance (but see <a href="../chapter3/evaluation_and_benchmarking.html" class="quarto-xref"><span>Chapter 3</span></a> for more thorough comparison methods). Not all models can handle weights in tasks so check a learner’s properties to make sure this column role is being used as expected.</p>
</section><section id="sec-lrns-add" class="level2" data-number="2.7"><h2 data-number="2.7" class="anchored" data-anchor-id="sec-lrns-add">
<span class="header-section-number">2.7</span> Supported Learning Algorithms</h2>
<p><code>mlr3</code> supports many learning algorithms (some with multiple implementations) as <code>Learner</code>s. These are primarily provided by the <a href="https://mlr3.mlr-org.com"><code>mlr3</code></a>, <a href="https://mlr3learners.mlr-org.com"><code>mlr3learners</code></a> and <a href="https://mlr3extralearners.mlr-org.com"><code>mlr3extralearners</code></a> packages. However, all packages that implement new tasks (<a href="../chapter13/beyond_regression_and_classification.html" class="quarto-xref"><span>Chapter 13</span></a>) also include a handful of simple algorithms.</p>
<p>The list of learners included in <code>mlr3</code> is deliberately small to avoid large sets of dependencies:</p>
<ul>
<li>Featureless learners (<code>"regr.featureless"</code>/<code>"classif.featureless"</code>), which are baseline learners (<a href="#sec-basics-featureless" class="quarto-xref"><span>Section 2.2.4</span></a>).</li>
<li>Debug learners (<code>"regr.debug"</code>/<code>"classif.debug"</code>), which are used to debug code (<a href="../chapter10/advanced_technical_aspects_of_mlr3.html#sec-error-handling" class="quarto-xref"><span>Section 10.2</span></a>).</li>
<li>Classification and regression trees (also known as CART: <code>"regr.rpart"</code>/<code>"classif.rpart"</code>).</li>
</ul>
<p>The <a href="https://mlr3learners.mlr-org.com"><code>mlr3learners</code></a> package contains a selection of algorithms (and select implementations) chosen by the mlr team that we recommend as a good starting point for most experiments:</p>
<ul>
<li>Linear (<code>"regr.lm"</code>) and logistic (<code>"classif.log_reg"</code>) regression.</li>
<li>Penalized generalized linear models, where the penalization is either exposed as a hyperparameter (<code>"regr.glmnet"</code>/<code>"classif.glmnet"</code>) or where it is optimized automatically (<code>"regr.cv_glmnet"</code>/<code>"classif.cv_glmnet"</code>).</li>
<li>Weighted <span class="math inline">\(k\)</span>-Nearest Neighbors (<code>"regr.kknn"</code>/<code>"classif.kknn"</code>).</li>
<li>Kriging / Gaussian process regression (<code>"regr.km"</code>).</li>
<li>Linear (<code>"classif.lda"</code>) and quadratic (<code>"classif.qda"</code>) discriminant analysis.</li>
<li>Naïve Bayes classification (<code>"classif.naive_bayes"</code>).</li>
<li>Support-vector machines (<code>"regr.svm"</code>/<code>"classif.svm"</code>).</li>
<li>Gradient boosting (<code>"regr.xgboost"</code>/<code>"classif.xgboost"</code>).</li>
<li>Random forests for regression and classification (<code>"regr.ranger"</code>/<code>"classif.ranger"</code>).</li>
</ul>
<p>The majority of other supported learners are in <a href="https://mlr3extralearners.mlr-org.com"><code>mlr3extralearners</code></a>. You can find an up-to-date list of learners at <a href="https://mlr-org.com/learners.html">https://mlr-org.com/learners.html</a>.</p>
<p>The dictionary <a href="https://mlr3.mlr-org.com/reference/mlr_learners.html"><code>mlr_learners</code></a> contains learners that are supported in loaded packages:</p>
<div class="cell">
<div class="sourceCode" id="cb176"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">learners_dt</span> <span class="op">=</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/as.data.table.html">as.data.table</a></span><span class="op">(</span><span class="va">mlr_learners</span><span class="op">)</span></span>
<span><span class="va">learners_dt</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                     key                       label task_type
  1:  classif.AdaBoostM1           Adaptive Boosting   classif
  2:         classif.C50            Tree-based Model   classif
  3:         classif.IBk           Nearest Neighbour   classif
  4:         classif.J48            Tree-based Model   classif
  5:        classif.JRip Propositional Rule Learner.   classif
 ---                                                          
134: surv.priority_lasso              Priority Lasso      surv
135:         surv.ranger               Random Forest      surv
136:          surv.rfsrc               Random Forest      surv
137:            surv.svm      Support Vector Machine      surv
138:        surv.xgboost           Gradient Boosting      surv
4 variables not shown: [feature_types, packages, properties, predict_types]</code></pre>
</div>
</div>
<p>The resulting <code>data.table</code> contains a lot of metadata that is useful for identifying learners with particular properties. For example, we can list all learners that support classification problems:</p>
<div class="cell">
<div class="sourceCode" id="cb178"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">learners_dt</span><span class="op">[</span><span class="va">task_type</span> <span class="op">==</span> <span class="st">"classif"</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   key                       label task_type
 1: classif.AdaBoostM1           Adaptive Boosting   classif
 2:        classif.C50            Tree-based Model   classif
 3:        classif.IBk           Nearest Neighbour   classif
 4:        classif.J48            Tree-based Model   classif
 5:       classif.JRip Propositional Rule Learner.   classif
---                                                         
40:     classif.ranger                        &lt;NA&gt;   classif
41:      classif.rfsrc               Random Forest   classif
42:      classif.rpart         Classification Tree   classif
43:        classif.svm                        &lt;NA&gt;   classif
44:    classif.xgboost                        &lt;NA&gt;   classif
4 variables not shown: [feature_types, packages, properties, predict_types]</code></pre>
</div>
</div>
<p>We can filter by multiple conditions, for example to list all regression learners that can predict standard errors:</p>
<div class="cell">
<div class="sourceCode" id="cb180"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">learners_dt</span><span class="op">[</span><span class="va">task_type</span> <span class="op">==</span> <span class="st">"regr"</span> <span class="op">&amp;</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">predict_types</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="st">"se"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">x</span><span class="op">)</span><span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                key                                    label task_type
1:       regr.debug             Debug Learner for Regression      regr
2:       regr.earth Multivariate Adaptive Regression Splines      regr
3: regr.featureless           Featureless Regression Learner      regr
4:         regr.gam    Generalized Additive Regression Model      regr
5:         regr.glm            Generalized Linear Regression      regr
6:          regr.km                                     &lt;NA&gt;      regr
7:          regr.lm                                     &lt;NA&gt;      regr
8:         regr.mob       Model-based Recursive Partitioning      regr
9:      regr.ranger                                     &lt;NA&gt;      regr
4 variables not shown: [feature_types, packages, properties, predict_types]</code></pre>
</div>
</div>
</section><section id="conclusion" class="level2" data-number="2.8"><h2 data-number="2.8" class="anchored" data-anchor-id="conclusion">
<span class="header-section-number">2.8</span> Conclusion</h2>
<p>In this chapter, we covered the building blocks of <a href="https://mlr3.mlr-org.com"><code>mlr3</code></a>. We first introduced basic ML methodology and then showed how this is implemented in <code>mlr3</code>. We began by looking at the <a href="https://mlr3.mlr-org.com/reference/Task.html"><code>Task</code></a> class, which is used to define machine learning tasks or problems to solve. We then looked at the <a href="https://mlr3.mlr-org.com/reference/Learner.html"><code>Learner</code></a> class, which encapsulates machine learning algorithms, hyperparameters, and other meta-information. Finally, we considered how to evaluate machine learning models with objects from the <a href="https://mlr3.mlr-org.com/reference/Measure.html"><code>Measure</code></a> class. After looking at regression implementations, we extended all the above to the classification setting, before finally looking at some extra details about tasks and the learning algorithms that are implemented across <code>mlr3</code>. The rest of this book will build on the basic elements seen in this chapter, starting with more advanced model comparison methods in <a href="../chapter3/evaluation_and_benchmarking.html" class="quarto-xref"><span>Chapter 3</span></a> before moving on to improve model performance with automated hyperparameter tuning in <a href="../chapter4/hyperparameter_optimization.html" class="quarto-xref"><span>Chapter 4</span></a>.</p>
<div id="tbl-basics-api" class="quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure"><figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-basics-api-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2.2: Important classes and functions covered in this chapter with underlying class (if applicable), class constructor or function, and important class fields and methods (if applicable).
</figcaption><div aria-describedby="tbl-basics-api-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="table">
<thead><tr class="header">
<th>Class</th>
<th>Constructor/Function</th>
<th>Fields/Methods</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><a href="https://mlr3.mlr-org.com/reference/Task.html"><code>Task</code></a></td>
<td>
<a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html"><code>tsk()</code></a>/<a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html"><code>tsks()</code></a>/<code>as_task_X</code>
</td>
<td>
<code>$filter()</code>; <code>$select()</code>; <code>$data()</code>
</td>
</tr>
<tr class="even">
<td><a href="https://mlr3.mlr-org.com/reference/Learner.html"><code>Learner</code></a></td>
<td>
<a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html"><code>lrn()</code></a>/<a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html"><code>lrns()</code></a>
</td>
<td>
<code>$train()</code>; <code>$predict()</code>; <code>$predict_newdata()</code>; <code>$model()</code>
</td>
</tr>
<tr class="odd">
<td><a href="https://mlr3.mlr-org.com/reference/Prediction.html"><code>Prediction</code></a></td>
<td><code>some_learner$predict()</code></td>
<td>
<code>$score()</code>; <code>$set_threshold()</code>; <code>$confusion</code>
</td>
</tr>
<tr class="even">
<td><a href="https://mlr3.mlr-org.com/reference/Measure.html"><code>Measure</code></a></td>
<td>
<a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html"><code>msr()</code></a>/<a href="https://mlr3.mlr-org.com/reference/mlr_sugar.html"><code>msrs()</code></a>
</td>
<td>-</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</section><section id="exercises" class="level2" data-number="2.9"><h2 data-number="2.9" class="anchored" data-anchor-id="exercises">
<span class="header-section-number">2.9</span> Exercises</h2>
<ol type="1">
<li>Train a classification model with the <code>classif.rpart</code> learner on the “Pima Indians Diabetes” dataset. Do this without using <code>tsk("pima")</code>, and instead by constructing a task from the dataset in the <code>mlbench</code>-package: <code>data(PimaIndiansDiabetes2, package = "mlbench")</code>. Make sure to define the <code>pos</code> outcome as positive class. Train the model on a random 80% subset of the given data and evaluate its performance with the classification error measure on the remaining data. (Note that the data set has NAs in its features. You can either rely on <code>rpart</code>‘s capability to handle them internally (’surrogate splits’) or remove them from the initial <code>data.frame</code> by using <code>na.omit</code>.</li>
<li>Calculate the true positive, false positive, true negative, and false negative rates of the predictions made by the model in Exercise 1. Try to solve this in two ways: (a) Using <code>mlr3measures</code>-predefined measure objects, and (b) without using <code>mlr3</code> tools by directly working on the ground truth and prediction vectors. Compare the results.</li>
<li>Change the threshold of the model from Exercise 1 such that the false positive rate is lower than the false negative rate. What is one reason you might do this in practice?</li>
</ol></section><section id="citation" class="level2" data-number="2.10"><h2 data-number="2.10" class="anchored" data-anchor-id="citation">
<span class="header-section-number">2.10</span> Citation</h2>
<p>Please cite this chapter as:</p>
<p>Foss N, Kotthoff L. (2024). Data and Basic Modeling. In Bischl B, Sonabend R, Kotthoff L, Lang M, (Eds.), <em>Applied Machine Learning Using mlr3 in R</em>. CRC Press. https://mlr3book.mlr-org.com/data_and_basic_modeling.html.</p>
<div class="sourceCode" id="cb182"><pre class="sourceCode bibtex code-with-copy"><code class="sourceCode bibtex"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a><span class="va">@incollection</span>{<span class="ot">citekey</span>, </span>
<span id="cb182-2"><a href="#cb182-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">author</span> = "<span class="st">Natalie Foss and Lars Kotthoff</span>", </span>
<span id="cb182-3"><a href="#cb182-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">title</span> = "<span class="st">Data and Basic Modeling</span>",</span>
<span id="cb182-4"><a href="#cb182-4" aria-hidden="true" tabindex="-1"></a>  <span class="dt">booktitle</span> = "<span class="st">Applied Machine Learning Using {m}lr3 in {R}</span>",</span>
<span id="cb182-5"><a href="#cb182-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">publisher</span> = "<span class="st">CRC Press</span>", <span class="st">year</span> = "<span class="st">2024</span>",</span>
<span id="cb182-6"><a href="#cb182-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">editor</span> = "<span class="st">Bernd Bischl and Raphael Sonabend and Lars Kotthoff and Michel Lang</span>", </span>
<span id="cb182-7"><a href="#cb182-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">url</span> = "<span class="st">https://mlr3book.mlr-org.com/data_and_basic_modeling.html</span>"</span>
<span id="cb182-8"><a href="#cb182-8" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>


<!-- -->

<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-bishop_2006" class="csl-entry" role="listitem">
Bishop, Christopher M. 2006. <em>Pattern Recognition and Machine Learning</em>. Springer.
</div>
<div id="ref-hastie2001" class="csl-entry" role="listitem">
Hastie, Trevor, Jerome Friedman, and Robert Tibshirani. 2001. <em>The Elements of Statistical Learning</em>. Springer New York. <a href="https://doi.org/10.1007/978-0-387-21606-5">https://doi.org/10.1007/978-0-387-21606-5</a>.
</div>
<div id="ref-james_introduction_2014" class="csl-entry" role="listitem">
James, Gareth, Daniela Witten, Trevor Hastie, and Robert Tibshirani. 2014. <em>An Introduction to Statistical Learning: With Applications in <span>R</span></em>. Springer Publishing Company, Incorporated. <a href="https://doi.org/10.1007/978-1-4614-7138-7">https://doi.org/10.1007/978-1-4614-7138-7</a>.
</div>
</div>
</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="../../chapters/chapter1/introduction_and_overview.html" class="pagination-link" aria-label="Introduction and Overview">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction and Overview</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../chapters/chapter3/evaluation_and_benchmarking.html" class="pagination-link" aria-label="Evaluation and Benchmarking">
        <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Evaluation and Benchmarking</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb183" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb183-2"><a href="#cb183-2" aria-hidden="true" tabindex="-1"></a><span class="an">aliases:</span></span>
<span id="cb183-3"><a href="#cb183-3" aria-hidden="true" tabindex="-1"></a><span class="co">  - "/data_and_basic_modeling.html"</span></span>
<span id="cb183-4"><a href="#cb183-4" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb183-5"><a href="#cb183-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-6"><a href="#cb183-6" aria-hidden="true" tabindex="-1"></a><span class="fu"># Data and Basic Modeling {#sec-basics}</span></span>
<span id="cb183-7"><a href="#cb183-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-8"><a href="#cb183-8" aria-hidden="true" tabindex="-1"></a>{{&lt; include ../../common/_setup.qmd &gt;}}</span>
<span id="cb183-9"><a href="#cb183-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-10"><a href="#cb183-10" aria-hidden="true" tabindex="-1"></a><span class="in">`r chapter = "Data and Basic Modeling"`</span></span>
<span id="cb183-11"><a href="#cb183-11" aria-hidden="true" tabindex="-1"></a><span class="in">`r authors(chapter)`</span></span>
<span id="cb183-12"><a href="#cb183-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-13"><a href="#cb183-13" aria-hidden="true" tabindex="-1"></a>In this chapter, we will introduce the <span class="in">`r mlr3`</span> objects and corresponding <span class="in">`r ref_pkg("R6")`</span> classes that implement the essential building blocks of machine learning.</span>
<span id="cb183-14"><a href="#cb183-14" aria-hidden="true" tabindex="-1"></a>These building blocks include the data (and the methods for creating training and test sets), the machine learning <span class="in">`r index('algorithm')`</span> (and its training and prediction process), the configuration of a machine learning algorithm through its <span class="in">`r index('hyperparameters')`</span>, and evaluation measures to assess the quality of predictions.</span>
<span id="cb183-15"><a href="#cb183-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-16"><a href="#cb183-16" aria-hidden="true" tabindex="-1"></a>In the simplest definition, <span class="in">`r index('machine learning')`</span> (ML) is the process of learning models of relationships from data.<span class="co">[</span><span class="ot">Machine Learning/Supervised Learning</span><span class="co">]</span>{.aside}</span>
<span id="cb183-17"><a href="#cb183-17" aria-hidden="true" tabindex="-1"></a><span class="in">`r index('Supervised learning')`</span> is a subfield of ML in which datasets consist of labeled observations, which means that each data point consists of <span class="in">`r index('features')`</span>, which are variables to make predictions from, and a <span class="in">`r index('target')`</span>, which is the quantity that we are trying to predict.</span>
<span id="cb183-18"><a href="#cb183-18" aria-hidden="true" tabindex="-1"></a>For example, predicting a car's miles per gallon (target) based on the car's properties (features) such as horsepower and the number of gears is a supervised learning problem, which we will return to several times in this book.</span>
<span id="cb183-19"><a href="#cb183-19" aria-hidden="true" tabindex="-1"></a>In <span class="in">`mlr3`</span>, we refer to datasets, and their associated metadata as <span class="in">`r index('tasks')`</span> (@sec-tasks).</span>
<span id="cb183-20"><a href="#cb183-20" aria-hidden="true" tabindex="-1"></a>The term 'task' is used to refer to the prediction problem that we are trying to solve.</span>
<span id="cb183-21"><a href="#cb183-21" aria-hidden="true" tabindex="-1"></a>Tasks are defined by the features used for prediction and the targets to predict, so there can be multiple tasks associated with any given dataset.</span>
<span id="cb183-22"><a href="#cb183-22" aria-hidden="true" tabindex="-1"></a>For example, predicting miles per gallon (mpg) from horsepower is one task, predicting horsepower from mpg is another task, and predicting the number of gears from the car's model is yet another task.</span>
<span id="cb183-23"><a href="#cb183-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-24"><a href="#cb183-24" aria-hidden="true" tabindex="-1"></a>Supervised learning can be further divided into <span class="in">`r index('regression', aside = TRUE)`</span> -- which is the prediction of numeric target values, e.g. predicting a car's mpg -- and <span class="in">`r index('classification', aside = TRUE)`</span> -- which is the prediction of categorical values/labels, e.g., predicting a car's model.</span>
<span id="cb183-25"><a href="#cb183-25" aria-hidden="true" tabindex="-1"></a>@sec-special also discusses other tasks, including <span class="in">`r index('cost-sensitive classification', "cost-sensitive", parent = "classification")`</span> and <span class="in">`r index('unsupervised learning')`</span>.</span>
<span id="cb183-26"><a href="#cb183-26" aria-hidden="true" tabindex="-1"></a>For any supervised learning task, the goal is to build a <span class="in">`r index('model')`</span> that captures the relationship between the features and target, often with the goal of <span class="in">`r index('training', "model training")`</span> the model to learn relationships about the data so it can make predictions for new and previously unseen data.</span>
<span id="cb183-27"><a href="#cb183-27" aria-hidden="true" tabindex="-1"></a>A <span class="in">`r index('model', aside = TRUE)`</span> is formally a mapping from a feature vector to a prediction.</span>
<span id="cb183-28"><a href="#cb183-28" aria-hidden="true" tabindex="-1"></a>A prediction can take many forms depending on the task; for example, in classification this can be a predicted label, or a set of predicted probabilities or scores.</span>
<span id="cb183-29"><a href="#cb183-29" aria-hidden="true" tabindex="-1"></a>Models are induced by passing <span class="in">`r index('training data')`</span> to machine learning algorithms, such as <span class="in">`r index('decision trees', "decision tree")`</span>, <span class="in">`r index('support vector machines', "support vector machine")`</span>, <span class="in">`r index('neural networks', "neural network")`</span>, and many more.</span>
<span id="cb183-30"><a href="#cb183-30" aria-hidden="true" tabindex="-1"></a>Machine learning algorithms are called learners<span class="co">[</span><span class="ot">Learners</span><span class="co">]</span>{.aside} in <span class="in">`mlr3`</span> (@sec-learners) as, given data, they learn models.</span>
<span id="cb183-31"><a href="#cb183-31" aria-hidden="true" tabindex="-1"></a>Each learner has a parameterized space that potential models are drawn from and during the training process, these parameters are fitted to best match the data.</span>
<span id="cb183-32"><a href="#cb183-32" aria-hidden="true" tabindex="-1"></a>For example, the parameters could be the coefficients used for individual features when training a linear regression model.</span>
<span id="cb183-33"><a href="#cb183-33" aria-hidden="true" tabindex="-1"></a>During training, most machine learning algorithms are 'fitted'/'trained'\index{model training}\index{fitting|see{model training}} by optimizing a loss-function that quantifies the mismatch between ground truth target values in the training data and the predictions of the model.</span>
<span id="cb183-34"><a href="#cb183-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-35"><a href="#cb183-35" aria-hidden="true" tabindex="-1"></a>For a model to be most useful, it should generalize beyond the training data to make 'good' predictions (@sec-predicting) on new and previously 'unseen' (by the model) data.</span>
<span id="cb183-36"><a href="#cb183-36" aria-hidden="true" tabindex="-1"></a>The simplest way to test this, is to split data into <span class="in">`r index('training data')`</span> and <span class="in">`r index('test data')`</span><span class="co">[</span><span class="ot">Train/Test Data</span><span class="co">]</span>{.aside} -- where the model is trained on the training data and then the separate test data is used to evaluate models in an unbiased way by assessing to what extent the model has learned the true relationships that underlie the data (@sec-performance).</span>
<span id="cb183-37"><a href="#cb183-37" aria-hidden="true" tabindex="-1"></a>This evaluation procedure estimates a model's <span class="in">`r index('generalization error', aside = TRUE)`</span>, i.e., how well we expect the model to perform in general.</span>
<span id="cb183-38"><a href="#cb183-38" aria-hidden="true" tabindex="-1"></a>There are many ways to evaluate models and to split data for estimating generalization error (@sec-resampling).</span>
<span id="cb183-39"><a href="#cb183-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-40"><a href="#cb183-40" aria-hidden="true" tabindex="-1"></a>This brief overview of ML provides the basic knowledge required to use <span class="in">`mlr3`</span> and is summarized in @fig-ml-abstraction-basics.</span>
<span id="cb183-41"><a href="#cb183-41" aria-hidden="true" tabindex="-1"></a>In the rest of this book, we will provide introductions to methodology when relevant.</span>
<span id="cb183-42"><a href="#cb183-42" aria-hidden="true" tabindex="-1"></a>For texts about ML, including detailed methodology and underpinnings of different algorithms, we recommend @hastie2001, @james_introduction_2014, and @bishop_2006.</span>
<span id="cb183-43"><a href="#cb183-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-44"><a href="#cb183-44" aria-hidden="true" tabindex="-1"></a>In the next few sections we will look at the building blocks of <span class="in">`mlr3`</span> using regression as an example, we will then consider how to extend this to classification in @sec-classif.</span>
<span id="cb183-45"><a href="#cb183-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-46"><a href="#cb183-46" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-fig-1, echo=FALSE}</span></span>
<span id="cb183-47"><a href="#cb183-47" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: fig-ml-abstraction-basics</span></span>
<span id="cb183-48"><a href="#cb183-48" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "General overview of the machine learning process."</span></span>
<span id="cb183-49"><a href="#cb183-49" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-alt: "A flowchart starting with the 'Data D' with two arrows to 'Dtrain' and 'Dtest'. 'Dtrain' has an arrow to 'Learner', which has an arrow to 'Model'. 'Dtest' has an arrow (labeled with 'Features') to 'Model' and an arrow (labeled with 'Labels') to 'Measure'. The 'Model' box has an arrow to 'Prediction', which has an arrow to 'Measure', which has an arrow to 'Performance'. The whole flowchart has curly brackets next to it that says 'Repeat = Resampling'."</span></span>
<span id="cb183-50"><a href="#cb183-50" aria-hidden="true" tabindex="-1"></a><span class="in">include_multi_graphics("mlr3book_figures-1")</span></span>
<span id="cb183-51"><a href="#cb183-51" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-52"><a href="#cb183-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-53"><a href="#cb183-53" aria-hidden="true" tabindex="-1"></a><span class="fu">## Tasks {#sec-tasks}</span></span>
<span id="cb183-54"><a href="#cb183-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-55"><a href="#cb183-55" aria-hidden="true" tabindex="-1"></a><span class="in">`r index('Tasks')`</span> are objects that contain the (usually tabular) data and additional metadata that define a machine learning problem.</span>
<span id="cb183-56"><a href="#cb183-56" aria-hidden="true" tabindex="-1"></a>The <span class="in">`r index('metadata')`</span> contain, for example, the name of the target feature for supervised machine learning problems.</span>
<span id="cb183-57"><a href="#cb183-57" aria-hidden="true" tabindex="-1"></a>This information is extracted automatically when required, so the user does not have to specify the prediction target every time a model is trained.</span>
<span id="cb183-58"><a href="#cb183-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-59"><a href="#cb183-59" aria-hidden="true" tabindex="-1"></a><span class="fu">### Constructing Tasks {#sec-tasks-built-in}</span></span>
<span id="cb183-60"><a href="#cb183-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-61"><a href="#cb183-61" aria-hidden="true" tabindex="-1"></a><span class="in">`mlr3`</span> includes a few predefined machine learning tasks in the <span class="in">`r ref("mlr_tasks", aside = TRUE)`</span> <span class="in">`Dictionary`</span>.</span>
<span id="cb183-62"><a href="#cb183-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-63"><a href="#cb183-63" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-001}</span></span>
<span id="cb183-64"><a href="#cb183-64" aria-hidden="true" tabindex="-1"></a><span class="in">mlr_tasks</span></span>
<span id="cb183-65"><a href="#cb183-65" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-66"><a href="#cb183-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-67"><a href="#cb183-67" aria-hidden="true" tabindex="-1"></a>To get a task from the dictionary, use the <span class="in">`r ref("tsk()", aside = TRUE)`</span> function and assign the return value to a new variable.</span>
<span id="cb183-68"><a href="#cb183-68" aria-hidden="true" tabindex="-1"></a>Below we retrieve <span class="in">`tsk("mtcars")`</span>, which uses the <span class="in">`r ref("datasets::mtcars")`</span> dataset:</span>
<span id="cb183-69"><a href="#cb183-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-70"><a href="#cb183-70" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-002}</span></span>
<span id="cb183-71"><a href="#cb183-71" aria-hidden="true" tabindex="-1"></a><span class="in">tsk_mtcars = tsk("mtcars")</span></span>
<span id="cb183-72"><a href="#cb183-72" aria-hidden="true" tabindex="-1"></a><span class="in">tsk_mtcars</span></span>
<span id="cb183-73"><a href="#cb183-73" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-74"><a href="#cb183-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-75"><a href="#cb183-75" aria-hidden="true" tabindex="-1"></a>Running <span class="in">`tsk()`</span> without any arguments will list all the tasks in the dictionary, this also works for all other sugar constructors that you will encounter throughout the book.</span>
<span id="cb183-76"><a href="#cb183-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-77"><a href="#cb183-77" aria-hidden="true" tabindex="-1"></a>:::{.callout-tip}</span>
<span id="cb183-78"><a href="#cb183-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-79"><a href="#cb183-79" aria-hidden="true" tabindex="-1"></a><span class="fu">## Help Pages</span></span>
<span id="cb183-80"><a href="#cb183-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-81"><a href="#cb183-81" aria-hidden="true" tabindex="-1"></a>Usually in R, the help pages of functions can be queried with <span class="in">`?`</span>.</span>
<span id="cb183-82"><a href="#cb183-82" aria-hidden="true" tabindex="-1"></a>The same is true of R6 classes, so if you want to find the help page of the <span class="in">`mtcars`</span> task you could use <span class="in">`?mlr_tasks_mtcars`</span>.</span>
<span id="cb183-83"><a href="#cb183-83" aria-hidden="true" tabindex="-1"></a>We have also added a <span class="in">`$help()`</span> method to many of our classes, which allows you to access the help page from any instance of that class, for example: <span class="in">`tsk("mtcars")$help()`</span>.</span>
<span id="cb183-84"><a href="#cb183-84" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb183-85"><a href="#cb183-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-86"><a href="#cb183-86" aria-hidden="true" tabindex="-1"></a>To create your own regression task, you will need to construct a new instance of <span class="in">`r ref("TaskRegr", aside = TRUE)`</span>.</span>
<span id="cb183-87"><a href="#cb183-87" aria-hidden="true" tabindex="-1"></a>The simplest way to do this is with the function <span class="in">`r ref("as_task_regr()", aside = TRUE)`</span> to convert a <span class="in">`data.frame`</span> type object to a regression task, specifying the target feature by passing this to the <span class="in">`target`</span> argument.</span>
<span id="cb183-88"><a href="#cb183-88" aria-hidden="true" tabindex="-1"></a>By example, we will ignore that <span class="in">`mtcars`</span> is already available as a predefined task in <span class="in">`mlr3`</span>.</span>
<span id="cb183-89"><a href="#cb183-89" aria-hidden="true" tabindex="-1"></a>In the code below we load the <span class="in">`datasets::mtcars`</span> dataset, subset the data to only include columns <span class="in">`"mpg"`</span>, <span class="in">`"cyl"`</span>, <span class="in">`"disp"`</span>, print the modified data's properties, and then set up a regression task called <span class="in">`"cars"`</span> (<span class="in">`id = "cars"`</span>) in which we will try to predict miles per gallon (<span class="in">`target = "mpg"`</span>) from the number of cylinders (<span class="in">`"cyl"`</span>) and displacement (<span class="in">`"disp"`</span>):</span>
<span id="cb183-90"><a href="#cb183-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-91"><a href="#cb183-91" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-006}</span></span>
<span id="cb183-92"><a href="#cb183-92" aria-hidden="true" tabindex="-1"></a><span class="in">data("mtcars", package = "datasets")</span></span>
<span id="cb183-93"><a href="#cb183-93" aria-hidden="true" tabindex="-1"></a><span class="in">mtcars_subset = subset(mtcars, select = c("mpg", "cyl", "disp"))</span></span>
<span id="cb183-94"><a href="#cb183-94" aria-hidden="true" tabindex="-1"></a><span class="in">str(mtcars_subset)</span></span>
<span id="cb183-95"><a href="#cb183-95" aria-hidden="true" tabindex="-1"></a><span class="in">tsk_mtcars = as_task_regr(mtcars_subset, target = "mpg", id = "cars")</span></span>
<span id="cb183-96"><a href="#cb183-96" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-97"><a href="#cb183-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-98"><a href="#cb183-98" aria-hidden="true" tabindex="-1"></a>The data can be in any tabular format, e.g. a <span class="in">`data.frame()`</span>, <span class="in">`data.table()`</span>, or <span class="in">`tibble()`</span>.</span>
<span id="cb183-99"><a href="#cb183-99" aria-hidden="true" tabindex="-1"></a>The <span class="in">`target`</span> argument specifies the prediction target column.</span>
<span id="cb183-100"><a href="#cb183-100" aria-hidden="true" tabindex="-1"></a>The <span class="in">`id`</span> argument is optional and specifies an identifier for the task that is used in plots and summaries; if omitted the variable name of the data will be used as the <span class="in">`id`</span>.</span>
<span id="cb183-101"><a href="#cb183-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-102"><a href="#cb183-102" aria-hidden="true" tabindex="-1"></a>:::{.callout-tip}</span>
<span id="cb183-103"><a href="#cb183-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-104"><a href="#cb183-104" aria-hidden="true" tabindex="-1"></a><span class="fu">## UTF8 Column Names</span></span>
<span id="cb183-105"><a href="#cb183-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-106"><a href="#cb183-106" aria-hidden="true" tabindex="-1"></a>As many machine learning models do not work properly with arbitrary UTF8 names, <span class="in">`mlr3`</span> defaults to throwing an error if any of the column names passed to <span class="in">`r ref("as_task_regr()")`</span> (and other task constructors) contain a non-ASCII character or do not comply with R's variable naming scheme.</span>
<span id="cb183-107"><a href="#cb183-107" aria-hidden="true" tabindex="-1"></a>Therefore, we recommend converting names with <span class="in">`r ref("make.names()")`</span> if possible.</span>
<span id="cb183-108"><a href="#cb183-108" aria-hidden="true" tabindex="-1"></a>You can bypass this check by setting <span class="in">`options(mlr3.allow_utf8_names = TRUE)`</span> (but do not be surprised if errors occur later, especially when passing objects to other packages).</span>
<span id="cb183-109"><a href="#cb183-109" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb183-110"><a href="#cb183-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-111"><a href="#cb183-111" aria-hidden="true" tabindex="-1"></a>Printing a task provides a summary and in this case, we can see the task has <span class="in">`r tsk_mtcars$nrow`</span> observations and <span class="in">`r tsk_mtcars$ncol`</span> columns (32 x 3), of which <span class="in">`mpg`</span> is the target, there are no special properties (<span class="in">`Properties: -`</span>), and there are <span class="in">`r length(tsk_mtcars$feature_names)`</span> features stored in double-precision floating point format.</span>
<span id="cb183-112"><a href="#cb183-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-115"><a href="#cb183-115" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-116"><a href="#cb183-116" aria-hidden="true" tabindex="-1"></a>tsk_mtcars</span>
<span id="cb183-117"><a href="#cb183-117" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-118"><a href="#cb183-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-119"><a href="#cb183-119" aria-hidden="true" tabindex="-1"></a>We can plot the task using the <span class="in">`r mlr3viz`</span> package, which gives a graphical summary of the distribution of the target and feature values:</span>
<span id="cb183-120"><a href="#cb183-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-121"><a href="#cb183-121" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-008, message=FALSE, output = FALSE}</span></span>
<span id="cb183-122"><a href="#cb183-122" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: fig-mtcars</span></span>
<span id="cb183-123"><a href="#cb183-123" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Overview of the mtcars dataset."</span></span>
<span id="cb183-124"><a href="#cb183-124" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-alt: Diagram shows six plots, three are line plots showing the relationship between continuous variables, and three are scatter plots showing relationships between other variables.</span></span>
<span id="cb183-125"><a href="#cb183-125" aria-hidden="true" tabindex="-1"></a><span class="in">library(mlr3viz)</span></span>
<span id="cb183-126"><a href="#cb183-126" aria-hidden="true" tabindex="-1"></a><span class="in">autoplot(tsk_mtcars, type = "pairs")</span></span>
<span id="cb183-127"><a href="#cb183-127" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-128"><a href="#cb183-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-129"><a href="#cb183-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-130"><a href="#cb183-130" aria-hidden="true" tabindex="-1"></a><span class="fu">### Retrieving Data {#sec-retrieve-data}</span></span>
<span id="cb183-131"><a href="#cb183-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-132"><a href="#cb183-132" aria-hidden="true" tabindex="-1"></a>We have looked at how to create tasks to store data and metadata, now we will look at how to retrieve the stored data.</span>
<span id="cb183-133"><a href="#cb183-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-134"><a href="#cb183-134" aria-hidden="true" tabindex="-1"></a>Various fields can be used to retrieve metadata about a task. The dimensions, for example, can be retrieved using <span class="in">`$nrow`</span> and <span class="in">`$ncol`</span>:</span>
<span id="cb183-135"><a href="#cb183-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-136"><a href="#cb183-136" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-009}</span></span>
<span id="cb183-137"><a href="#cb183-137" aria-hidden="true" tabindex="-1"></a><span class="in">c(tsk_mtcars$nrow, tsk_mtcars$ncol)</span></span>
<span id="cb183-138"><a href="#cb183-138" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-139"><a href="#cb183-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-140"><a href="#cb183-140" aria-hidden="true" tabindex="-1"></a>The names of the feature and target columns are stored in the <span class="in">`$feature_names`</span> and <span class="in">`$target_names`</span> slots, respectively.</span>
<span id="cb183-141"><a href="#cb183-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-142"><a href="#cb183-142" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-010}</span></span>
<span id="cb183-143"><a href="#cb183-143" aria-hidden="true" tabindex="-1"></a><span class="in">c(Features = tsk_mtcars$feature_names,</span></span>
<span id="cb183-144"><a href="#cb183-144" aria-hidden="true" tabindex="-1"></a><span class="in">  Target = tsk_mtcars$target_names)</span></span>
<span id="cb183-145"><a href="#cb183-145" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-146"><a href="#cb183-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-147"><a href="#cb183-147" aria-hidden="true" tabindex="-1"></a>The columns of a task have unique <span class="in">`character`</span>-valued names and the rows are identified by unique natural numbers, called row IDs.</span>
<span id="cb183-148"><a href="#cb183-148" aria-hidden="true" tabindex="-1"></a>They can be accessed through the <span class="in">`$row_ids`</span> field:</span>
<span id="cb183-149"><a href="#cb183-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-150"><a href="#cb183-150" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-011}</span></span>
<span id="cb183-151"><a href="#cb183-151" aria-hidden="true" tabindex="-1"></a><span class="in">head(tsk_mtcars$row_ids)</span></span>
<span id="cb183-152"><a href="#cb183-152" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-153"><a href="#cb183-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-154"><a href="#cb183-154" aria-hidden="true" tabindex="-1"></a>Row IDs are not used as features when training or predicting but are metadata that allow access to individual observations.</span>
<span id="cb183-155"><a href="#cb183-155" aria-hidden="true" tabindex="-1"></a>Note that row IDs are not the same as row numbers.</span>
<span id="cb183-156"><a href="#cb183-156" aria-hidden="true" tabindex="-1"></a>This is best demonstrated by example, below we create a regression task from random data, print the original row IDs, which correspond to row numbers 1-5, then we filter three rows (we will return to this method just below) and print the new row IDs, which no longer correspond to the row numbers.</span>
<span id="cb183-157"><a href="#cb183-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-160"><a href="#cb183-160" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-161"><a href="#cb183-161" aria-hidden="true" tabindex="-1"></a>task <span class="ot">=</span> <span class="fu">as_task_regr</span>(<span class="fu">data.frame</span>(<span class="at">x =</span> <span class="fu">runif</span>(<span class="dv">5</span>), <span class="at">y =</span> <span class="fu">runif</span>(<span class="dv">5</span>)),</span>
<span id="cb183-162"><a href="#cb183-162" aria-hidden="true" tabindex="-1"></a>  <span class="at">target =</span> <span class="st">"y"</span>)</span>
<span id="cb183-163"><a href="#cb183-163" aria-hidden="true" tabindex="-1"></a>task<span class="sc">$</span>row_ids</span>
<span id="cb183-164"><a href="#cb183-164" aria-hidden="true" tabindex="-1"></a>task<span class="sc">$</span><span class="fu">filter</span>(<span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">3</span>))</span>
<span id="cb183-165"><a href="#cb183-165" aria-hidden="true" tabindex="-1"></a>task<span class="sc">$</span>row_ids</span>
<span id="cb183-166"><a href="#cb183-166" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-167"><a href="#cb183-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-168"><a href="#cb183-168" aria-hidden="true" tabindex="-1"></a>This design decision allows tasks and learners to transparently operate on real database management systems, where primary keys are required to be unique, but not necessarily consecutive.</span>
<span id="cb183-169"><a href="#cb183-169" aria-hidden="true" tabindex="-1"></a>See @sec-backends for more information on using databases as data backends for tasks</span>
<span id="cb183-170"><a href="#cb183-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-171"><a href="#cb183-171" aria-hidden="true" tabindex="-1"></a>The data contained in a task can be accessed through <span class="in">`$data()`</span>, which returns a <span class="in">`r ref("data.table")`</span> object.</span>
<span id="cb183-172"><a href="#cb183-172" aria-hidden="true" tabindex="-1"></a>This method has optional <span class="in">`rows`</span> and <span class="in">`cols`</span> arguments to specify subsets of the data to retrieve.</span>
<span id="cb183-173"><a href="#cb183-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-174"><a href="#cb183-174" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-012}</span></span>
<span id="cb183-175"><a href="#cb183-175" aria-hidden="true" tabindex="-1"></a><span class="in"># retrieve all data</span></span>
<span id="cb183-176"><a href="#cb183-176" aria-hidden="true" tabindex="-1"></a><span class="in">tsk_mtcars$data()</span></span>
<span id="cb183-177"><a href="#cb183-177" aria-hidden="true" tabindex="-1"></a><span class="in"># retrieve data for rows with IDs 1, 5, and 10 and all feature columns</span></span>
<span id="cb183-178"><a href="#cb183-178" aria-hidden="true" tabindex="-1"></a><span class="in">tsk_mtcars$data(rows = c(1, 5, 10), cols = tsk_mtcars$feature_names)</span></span>
<span id="cb183-179"><a href="#cb183-179" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-180"><a href="#cb183-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-181"><a href="#cb183-181" aria-hidden="true" tabindex="-1"></a>:::{.callout-tip}</span>
<span id="cb183-182"><a href="#cb183-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-183"><a href="#cb183-183" aria-hidden="true" tabindex="-1"></a><span class="fu">## Accessing Rows by Number</span></span>
<span id="cb183-184"><a href="#cb183-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-185"><a href="#cb183-185" aria-hidden="true" tabindex="-1"></a>You can work with row numbers instead of row IDs by using the <span class="in">`$row_ids`</span> field to extract the row ID corresponding to a given row number:</span>
<span id="cb183-186"><a href="#cb183-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-187"><a href="#cb183-187" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-016, eval = FALSE}</span></span>
<span id="cb183-188"><a href="#cb183-188" aria-hidden="true" tabindex="-1"></a><span class="in"># select the 2nd row of the task by extracting the second row_id:</span></span>
<span id="cb183-189"><a href="#cb183-189" aria-hidden="true" tabindex="-1"></a><span class="in">tsk_mtcars$data(rows = task$row_ids[2])</span></span>
<span id="cb183-190"><a href="#cb183-190" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-191"><a href="#cb183-191" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb183-192"><a href="#cb183-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-193"><a href="#cb183-193" aria-hidden="true" tabindex="-1"></a>You can always use 'standard' R methods to extract summary data from a task, for example, to summarize the underlying data:</span>
<span id="cb183-194"><a href="#cb183-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-195"><a href="#cb183-195" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-013}</span></span>
<span id="cb183-196"><a href="#cb183-196" aria-hidden="true" tabindex="-1"></a><span class="in">summary(as.data.table(tsk_mtcars))</span></span>
<span id="cb183-197"><a href="#cb183-197" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-198"><a href="#cb183-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-199"><a href="#cb183-199" aria-hidden="true" tabindex="-1"></a><span class="fu">### Task Mutators {#sec-tasks-mutators}</span></span>
<span id="cb183-200"><a href="#cb183-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-201"><a href="#cb183-201" aria-hidden="true" tabindex="-1"></a>After a task has been created, you may want to perform operations on the task such as filtering down to subsets of rows and columns, which is often useful for manually creating train and test splits or to fit models on a subset of given features.</span>
<span id="cb183-202"><a href="#cb183-202" aria-hidden="true" tabindex="-1"></a>Above we saw how to access subsets of the underlying dataset using <span class="in">`$data()`</span>, however, this will not change the underlying task.</span>
<span id="cb183-203"><a href="#cb183-203" aria-hidden="true" tabindex="-1"></a>Therefore, we provide <span class="in">`r index('mutators', aside = TRUE)`</span>, which modify the given <span class="in">`Task`</span> in place, which can be seen in the examples below.</span>
<span id="cb183-204"><a href="#cb183-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-205"><a href="#cb183-205" aria-hidden="true" tabindex="-1"></a>Subsetting by features (columns) is possible with <span class="in">`$select()`</span> with the desired feature names passed as a character vector and subsetting by observations (rows) is performed with <span class="in">`$filter()`</span> by passing the row IDs as a numeric vector. <span class="in">`r index(NULL, "$select()", parent = "Task", code = TRUE)`</span> <span class="in">`r index(NULL, "$filter()", parent = "Task", code = TRUE)`</span></span>
<span id="cb183-206"><a href="#cb183-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-209"><a href="#cb183-209" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-210"><a href="#cb183-210" aria-hidden="true" tabindex="-1"></a>tsk_mtcars_small <span class="ot">=</span> <span class="fu">tsk</span>(<span class="st">"mtcars"</span>) <span class="co"># initialize with the full task</span></span>
<span id="cb183-211"><a href="#cb183-211" aria-hidden="true" tabindex="-1"></a>tsk_mtcars_small<span class="sc">$</span><span class="fu">select</span>(<span class="st">"cyl"</span>) <span class="co"># keep only one feature</span></span>
<span id="cb183-212"><a href="#cb183-212" aria-hidden="true" tabindex="-1"></a>tsk_mtcars_small<span class="sc">$</span><span class="fu">filter</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>) <span class="co"># keep only these rows</span></span>
<span id="cb183-213"><a href="#cb183-213" aria-hidden="true" tabindex="-1"></a>tsk_mtcars_small<span class="sc">$</span><span class="fu">data</span>()</span>
<span id="cb183-214"><a href="#cb183-214" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-215"><a href="#cb183-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-216"><a href="#cb183-216" aria-hidden="true" tabindex="-1"></a>As <span class="in">`R6`</span> uses reference semantics (@sec-r6), you need to use <span class="in">`$clone()`</span> if you want to modify a task while keeping the original object intact.</span>
<span id="cb183-217"><a href="#cb183-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-218"><a href="#cb183-218" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-015}</span></span>
<span id="cb183-219"><a href="#cb183-219" aria-hidden="true" tabindex="-1"></a><span class="in"># the wrong way</span></span>
<span id="cb183-220"><a href="#cb183-220" aria-hidden="true" tabindex="-1"></a><span class="in">tsk_mtcars = tsk("mtcars")</span></span>
<span id="cb183-221"><a href="#cb183-221" aria-hidden="true" tabindex="-1"></a><span class="in">tsk_mtcars_wrong = tsk_mtcars</span></span>
<span id="cb183-222"><a href="#cb183-222" aria-hidden="true" tabindex="-1"></a><span class="in">tsk_mtcars_wrong$filter(1:2)</span></span>
<span id="cb183-223"><a href="#cb183-223" aria-hidden="true" tabindex="-1"></a><span class="in"># original data affected</span></span>
<span id="cb183-224"><a href="#cb183-224" aria-hidden="true" tabindex="-1"></a><span class="in">tsk_mtcars$head()</span></span>
<span id="cb183-225"><a href="#cb183-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-226"><a href="#cb183-226" aria-hidden="true" tabindex="-1"></a><span class="in"># the right way</span></span>
<span id="cb183-227"><a href="#cb183-227" aria-hidden="true" tabindex="-1"></a><span class="in">tsk_mtcars = tsk("mtcars")</span></span>
<span id="cb183-228"><a href="#cb183-228" aria-hidden="true" tabindex="-1"></a><span class="in">tsk_mtcars_right = tsk_mtcars$clone()</span></span>
<span id="cb183-229"><a href="#cb183-229" aria-hidden="true" tabindex="-1"></a><span class="in">tsk_mtcars_right$filter(1:2)</span></span>
<span id="cb183-230"><a href="#cb183-230" aria-hidden="true" tabindex="-1"></a><span class="in"># original data unaffected</span></span>
<span id="cb183-231"><a href="#cb183-231" aria-hidden="true" tabindex="-1"></a><span class="in">tsk_mtcars$head()</span></span>
<span id="cb183-232"><a href="#cb183-232" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-233"><a href="#cb183-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-234"><a href="#cb183-234" aria-hidden="true" tabindex="-1"></a>To add extra rows and columns to a task, you can use <span class="in">`$rbind()`</span> and <span class="in">`$cbind()`</span> respectively: <span class="in">`r index(NULL, "$cbind()", parent = "Task", code = TRUE)`</span> <span class="in">`r index(NULL, "$rbind()", parent = "Task", code = TRUE)`</span></span>
<span id="cb183-235"><a href="#cb183-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-236"><a href="#cb183-236" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-017}</span></span>
<span id="cb183-237"><a href="#cb183-237" aria-hidden="true" tabindex="-1"></a><span class="in">tsk_mtcars_small$cbind( # add another column</span></span>
<span id="cb183-238"><a href="#cb183-238" aria-hidden="true" tabindex="-1"></a><span class="in">  data.frame(disp = c(150, 160))</span></span>
<span id="cb183-239"><a href="#cb183-239" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb183-240"><a href="#cb183-240" aria-hidden="true" tabindex="-1"></a><span class="in">tsk_mtcars_small$rbind( # add another row</span></span>
<span id="cb183-241"><a href="#cb183-241" aria-hidden="true" tabindex="-1"></a><span class="in">  data.frame(mpg = 23, cyl = 5, disp = 170)</span></span>
<span id="cb183-242"><a href="#cb183-242" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb183-243"><a href="#cb183-243" aria-hidden="true" tabindex="-1"></a><span class="in">tsk_mtcars_small$data()</span></span>
<span id="cb183-244"><a href="#cb183-244" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-245"><a href="#cb183-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-246"><a href="#cb183-246" aria-hidden="true" tabindex="-1"></a><span class="fu">## Learners {#sec-learners}</span></span>
<span id="cb183-247"><a href="#cb183-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-248"><a href="#cb183-248" aria-hidden="true" tabindex="-1"></a>Objects of class <span class="in">`r ref("Learner", aside = TRUE)`</span> provide a unified interface to many popular machine learning algorithms in R.</span>
<span id="cb183-249"><a href="#cb183-249" aria-hidden="true" tabindex="-1"></a>The <span class="in">`r ref("mlr_learners", aside = TRUE)`</span> dictionary contains all the learners available in <span class="in">`mlr3`</span>.</span>
<span id="cb183-250"><a href="#cb183-250" aria-hidden="true" tabindex="-1"></a>We will discuss the available learners in @sec-lrns-add; for now, we will just use a regression tree learner as an example to discuss the <span class="in">`Learner`</span> interface.</span>
<span id="cb183-251"><a href="#cb183-251" aria-hidden="true" tabindex="-1"></a>As with tasks, you can access learners from the dictionary with a single sugar function, in this case, <span class="in">`r ref("lrn()", aside = TRUE)`</span>.</span>
<span id="cb183-252"><a href="#cb183-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-253"><a href="#cb183-253" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-023}</span></span>
<span id="cb183-254"><a href="#cb183-254" aria-hidden="true" tabindex="-1"></a><span class="in">lrn("regr.rpart")</span></span>
<span id="cb183-255"><a href="#cb183-255" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-256"><a href="#cb183-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-257"><a href="#cb183-257" aria-hidden="true" tabindex="-1"></a>All <span class="in">`Learner`</span> objects include the following metadata, which can be seen in the output above:</span>
<span id="cb183-258"><a href="#cb183-258" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-259"><a href="#cb183-259" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">`$feature_types`</span>: the type of features the learner can handle.</span>
<span id="cb183-260"><a href="#cb183-260" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">`$packages`</span>: the packages required to be installed to use the learner.</span>
<span id="cb183-261"><a href="#cb183-261" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">`$properties`</span>: the properties of the learner. For example, the "missings" properties means a model can handle missing data, and "importance" means it can compute the relative importance of each feature.</span>
<span id="cb183-262"><a href="#cb183-262" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">`$predict_types`</span>: the types of prediction that the model can make (@sec-predicting).</span>
<span id="cb183-263"><a href="#cb183-263" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">`$param_set`</span>: the set of available hyperparameters (@sec-param-set).</span>
<span id="cb183-264"><a href="#cb183-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-265"><a href="#cb183-265" aria-hidden="true" tabindex="-1"></a>To run a machine learning experiment, learners pass through two stages (@fig-basics-learner):</span>
<span id="cb183-266"><a href="#cb183-266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-267"><a href="#cb183-267" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">`r index('Training', "model training", aside = TRUE)`</span>: A training <span class="in">`Task`</span> is passed to the learner's <span class="in">`r index("$train()", parent = "Learner", code = TRUE)`</span>  function which trains and stores a <span class="in">`r index('model')`</span>, i.e., the learned relationship of the features to the target.</span>
<span id="cb183-268"><a href="#cb183-268" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">`r index('Predicting', "model predicting", aside = TRUE)`</span>: New data, potentially a different partition of the original dataset, is passed to the <span class="in">`r index("$predict()", parent = "Learner", code = TRUE)`</span> method of the trained learner to predict the target values.</span>
<span id="cb183-269"><a href="#cb183-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-270"><a href="#cb183-270" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-022, echo=FALSE, out.width = "70%"}</span></span>
<span id="cb183-271"><a href="#cb183-271" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: fig-basics-learner</span></span>
<span id="cb183-272"><a href="#cb183-272" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: Overview of the different stages of a learner. Top -- data (features and a target) are passed to an (untrained) learner. Bottom -- new data are passed to the trained model which makes predictions for the 'missing' target column.</span></span>
<span id="cb183-273"><a href="#cb183-273" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-alt: Diagram shows two boxes, the first is labeled "$train() on Training Data" and shows data pointing at the Learner. The second is labeled "$predict() on New Data to Get Predictions" and shows different data pointing at a learner which now includes a "$model". An arrow then shows predictions being made from the "Learner" in the second box.</span></span>
<span id="cb183-274"><a href="#cb183-274" aria-hidden="true" tabindex="-1"></a><span class="in">include_multi_graphics("mlr3book_figures-2")</span></span>
<span id="cb183-275"><a href="#cb183-275" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-276"><a href="#cb183-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-277"><a href="#cb183-277" aria-hidden="true" tabindex="-1"></a><span class="fu">### Training {#sec-training}</span></span>
<span id="cb183-278"><a href="#cb183-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-279"><a href="#cb183-279" aria-hidden="true" tabindex="-1"></a>In the simplest use case, models are trained by passing a task to a learner with the <span class="in">`r index("$train()", parent = "Learner", aside = TRUE, code = TRUE)`</span> method:</span>
<span id="cb183-280"><a href="#cb183-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-283"><a href="#cb183-283" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-284"><a href="#cb183-284" aria-hidden="true" tabindex="-1"></a><span class="co"># load mtcars task</span></span>
<span id="cb183-285"><a href="#cb183-285" aria-hidden="true" tabindex="-1"></a>tsk_mtcars <span class="ot">=</span> <span class="fu">tsk</span>(<span class="st">"mtcars"</span>)</span>
<span id="cb183-286"><a href="#cb183-286" aria-hidden="true" tabindex="-1"></a><span class="co"># load a regression tree</span></span>
<span id="cb183-287"><a href="#cb183-287" aria-hidden="true" tabindex="-1"></a>lrn_rpart <span class="ot">=</span> <span class="fu">lrn</span>(<span class="st">"regr.rpart"</span>)</span>
<span id="cb183-288"><a href="#cb183-288" aria-hidden="true" tabindex="-1"></a><span class="co"># pass the task to the learner via $train()</span></span>
<span id="cb183-289"><a href="#cb183-289" aria-hidden="true" tabindex="-1"></a>lrn_rpart<span class="sc">$</span><span class="fu">train</span>(tsk_mtcars)</span>
<span id="cb183-290"><a href="#cb183-290" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-291"><a href="#cb183-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-292"><a href="#cb183-292" aria-hidden="true" tabindex="-1"></a>After training, the fitted model is stored in the <span class="in">`r index("$model", parent = "Learner", aside = TRUE, code = TRUE)`</span> field for future inspection and prediction:</span>
<span id="cb183-293"><a href="#cb183-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-296"><a href="#cb183-296" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-297"><a href="#cb183-297" aria-hidden="true" tabindex="-1"></a><span class="co"># inspect the trained model</span></span>
<span id="cb183-298"><a href="#cb183-298" aria-hidden="true" tabindex="-1"></a>lrn_rpart<span class="sc">$</span>model</span>
<span id="cb183-299"><a href="#cb183-299" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-300"><a href="#cb183-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-301"><a href="#cb183-301" aria-hidden="true" tabindex="-1"></a>We see that the regression tree has identified features in the task that are predictive of the target (<span class="in">`mpg`</span>) and used them to partition observations.</span>
<span id="cb183-302"><a href="#cb183-302" aria-hidden="true" tabindex="-1"></a>The textual representation of the model depends on the type of learner.</span>
<span id="cb183-303"><a href="#cb183-303" aria-hidden="true" tabindex="-1"></a>For more information on any model see the learner help page, which can be accessed in the same way as tasks with the <span class="in">`help()`</span> field, e.g., <span class="in">`lrn_rpart$help()`</span>.</span>
<span id="cb183-304"><a href="#cb183-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-305"><a href="#cb183-305" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Partitioning Data {#sec-basics-partition}</span></span>
<span id="cb183-306"><a href="#cb183-306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-307"><a href="#cb183-307" aria-hidden="true" tabindex="-1"></a>When assessing the quality of a model's predictions, you will likely want to partition your dataset to get a fair and unbiased estimate of a model's generalization error.</span>
<span id="cb183-308"><a href="#cb183-308" aria-hidden="true" tabindex="-1"></a>In @sec-performance we will look at resampling and benchmark experiments, which will go into more detail about performance estimation but for now, we will just discuss the simplest method of splitting data using the <span class="in">`r ref("partition()", aside = TRUE)`</span> function.</span>
<span id="cb183-309"><a href="#cb183-309" aria-hidden="true" tabindex="-1"></a>This function creates index sets that randomly split the given task into two disjoint sets: a training set\index{training data} (67% of the total data by default) and a test set\index{test data} (the remaining 33% of the total data not in the training set).</span>
<span id="cb183-310"><a href="#cb183-310" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-311"><a href="#cb183-311" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-025}</span></span>
<span id="cb183-312"><a href="#cb183-312" aria-hidden="true" tabindex="-1"></a><span class="in">splits = partition(tsk_mtcars)</span></span>
<span id="cb183-313"><a href="#cb183-313" aria-hidden="true" tabindex="-1"></a><span class="in">splits</span></span>
<span id="cb183-314"><a href="#cb183-314" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-315"><a href="#cb183-315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-316"><a href="#cb183-316" aria-hidden="true" tabindex="-1"></a>When training we will tell the model to only use the training data by passing the row IDs from <span class="in">`partition`</span> to the <span class="in">`row_ids`</span> argument of <span class="in">`$train()`</span>:</span>
<span id="cb183-317"><a href="#cb183-317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-318"><a href="#cb183-318" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-025-1}</span></span>
<span id="cb183-319"><a href="#cb183-319" aria-hidden="true" tabindex="-1"></a><span class="in">lrn_rpart$train(tsk_mtcars, row_ids = splits$train)</span></span>
<span id="cb183-320"><a href="#cb183-320" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-321"><a href="#cb183-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-322"><a href="#cb183-322" aria-hidden="true" tabindex="-1"></a>Now we can use our trained learner to make predictions on new data.</span>
<span id="cb183-323"><a href="#cb183-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-324"><a href="#cb183-324" aria-hidden="true" tabindex="-1"></a><span class="fu">### Predicting {#sec-predicting}</span></span>
<span id="cb183-325"><a href="#cb183-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-326"><a href="#cb183-326" aria-hidden="true" tabindex="-1"></a>Predicting from trained models is as simple as passing your data as a <span class="in">`Task`</span> to the <span class="in">`r index("$predict()", parent = "Learner", aside = TRUE, code = TRUE)`</span> method of the trained <span class="in">`Learner`</span>.</span>
<span id="cb183-327"><a href="#cb183-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-328"><a href="#cb183-328" aria-hidden="true" tabindex="-1"></a>Carrying straight on from our last example, we will call the <span class="in">`$predict()`</span> method of our trained learner and again will use the <span class="in">`row_ids`</span> argument, but this time to pass the IDs of our <span class="in">`r index("test set", "test data")`</span>:</span>
<span id="cb183-329"><a href="#cb183-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-330"><a href="#cb183-330" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-030}</span></span>
<span id="cb183-331"><a href="#cb183-331" aria-hidden="true" tabindex="-1"></a><span class="in">prediction = lrn_rpart$predict(tsk_mtcars, row_ids = splits$test)</span></span>
<span id="cb183-332"><a href="#cb183-332" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-333"><a href="#cb183-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-334"><a href="#cb183-334" aria-hidden="true" tabindex="-1"></a>The <span class="in">`$predict()`</span> method returns an object inheriting from <span class="in">`r ref("Prediction", aside = TRUE)`</span>, in this case <span class="in">`r ref("PredictionRegr", aside = TRUE)`</span> as this is a regression task.</span>
<span id="cb183-335"><a href="#cb183-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-338"><a href="#cb183-338" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-339"><a href="#cb183-339" aria-hidden="true" tabindex="-1"></a>prediction</span>
<span id="cb183-340"><a href="#cb183-340" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-341"><a href="#cb183-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-342"><a href="#cb183-342" aria-hidden="true" tabindex="-1"></a>The <span class="in">`row_ids`</span> column corresponds to the row IDs of the predicted observations.</span>
<span id="cb183-343"><a href="#cb183-343" aria-hidden="true" tabindex="-1"></a>The <span class="in">`truth`</span> column contains the ground truth data if available, which the object extracts from the task, in this case: <span class="in">`tsk_mtcars$truth(splits$test)`</span>.</span>
<span id="cb183-344"><a href="#cb183-344" aria-hidden="true" tabindex="-1"></a>Finally, the <span class="in">`response`</span> column contains the values predicted by the model.</span>
<span id="cb183-345"><a href="#cb183-345" aria-hidden="true" tabindex="-1"></a>The <span class="in">`Prediction`</span> object can easily be converted into a <span class="in">`data.table`</span> or <span class="in">`data.frame`</span> using <span class="in">`as.data.table()`</span>/<span class="in">`as.data.frame()`</span> respectively.</span>
<span id="cb183-346"><a href="#cb183-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-347"><a href="#cb183-347" aria-hidden="true" tabindex="-1"></a>All data in the above columns can be accessed directly, for example, to get the first two predicted responses:</span>
<span id="cb183-348"><a href="#cb183-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-349"><a href="#cb183-349" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-access-pred}</span></span>
<span id="cb183-350"><a href="#cb183-350" aria-hidden="true" tabindex="-1"></a><span class="in">prediction$response[1:2]</span></span>
<span id="cb183-351"><a href="#cb183-351" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-352"><a href="#cb183-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-353"><a href="#cb183-353" aria-hidden="true" tabindex="-1"></a>Similarly to plotting <span class="in">`Task`</span>s, <span class="in">`r mlr3viz`</span> provides an <span class="in">`r ref("ggplot2::autoplot()")`</span> method for <span class="in">`Prediction`</span> objects.</span>
<span id="cb183-354"><a href="#cb183-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-355"><a href="#cb183-355" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-035, message = FALSE, warning = FALSE, out.width = "70%"}</span></span>
<span id="cb183-356"><a href="#cb183-356" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: fig-basics-truthresponse</span></span>
<span id="cb183-357"><a href="#cb183-357" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Comparing predicted and ground truth values for the mtcars dataset."</span></span>
<span id="cb183-358"><a href="#cb183-358" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-alt: "A scatter plot with predicted values on one axis and ground truth values on the other. A trend line is fit to show that in general there is good agreement between predicted and ground truth values."</span></span>
<span id="cb183-359"><a href="#cb183-359" aria-hidden="true" tabindex="-1"></a><span class="in">library(mlr3viz)</span></span>
<span id="cb183-360"><a href="#cb183-360" aria-hidden="true" tabindex="-1"></a><span class="in">prediction = lrn_rpart$predict(tsk_mtcars, splits$test)</span></span>
<span id="cb183-361"><a href="#cb183-361" aria-hidden="true" tabindex="-1"></a><span class="in">autoplot(prediction)</span></span>
<span id="cb183-362"><a href="#cb183-362" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-363"><a href="#cb183-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-364"><a href="#cb183-364" aria-hidden="true" tabindex="-1"></a>In the examples above we made predictions by passing a task to <span class="in">`$predict()`</span>.</span>
<span id="cb183-365"><a href="#cb183-365" aria-hidden="true" tabindex="-1"></a>However, if you would rather pass a <span class="in">`data.frame`</span> type object directly, then you can use <span class="in">`r index("$predict_newdata()", parent = "Learner", code = TRUE)`</span>.</span>
<span id="cb183-366"><a href="#cb183-366" aria-hidden="true" tabindex="-1"></a>Note, the <span class="in">`truth`</span> column values are all <span class="in">`NA`</span>, as we did not include a target column in the generated data.</span>
<span id="cb183-367"><a href="#cb183-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-368"><a href="#cb183-368" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-032}</span></span>
<span id="cb183-369"><a href="#cb183-369" aria-hidden="true" tabindex="-1"></a><span class="in">mtcars_new = data.table(cyl = c(5, 6), disp = c(100, 120),</span></span>
<span id="cb183-370"><a href="#cb183-370" aria-hidden="true" tabindex="-1"></a><span class="in">  hp = c(100, 150), drat = c(4, 3.9), wt = c(3.8, 4.1),</span></span>
<span id="cb183-371"><a href="#cb183-371" aria-hidden="true" tabindex="-1"></a><span class="in">  qsec = c(18, 19.5), vs = c(1, 0), am = c(1, 1),</span></span>
<span id="cb183-372"><a href="#cb183-372" aria-hidden="true" tabindex="-1"></a><span class="in">  gear = c(6, 4), carb = c(3, 5))</span></span>
<span id="cb183-373"><a href="#cb183-373" aria-hidden="true" tabindex="-1"></a><span class="in">prediction = lrn_rpart$predict_newdata(mtcars_new)</span></span>
<span id="cb183-374"><a href="#cb183-374" aria-hidden="true" tabindex="-1"></a><span class="in">prediction</span></span>
<span id="cb183-375"><a href="#cb183-375" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-376"><a href="#cb183-376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-377"><a href="#cb183-377" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Changing the Prediction Type {.unnumbered .unlisted}</span></span>
<span id="cb183-378"><a href="#cb183-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-379"><a href="#cb183-379" aria-hidden="true" tabindex="-1"></a>While predicting a single numeric quantity is the most common prediction type in regression, it is not the only prediction type.</span>
<span id="cb183-380"><a href="#cb183-380" aria-hidden="true" tabindex="-1"></a>Several regression models can also predict standard errors.</span>
<span id="cb183-381"><a href="#cb183-381" aria-hidden="true" tabindex="-1"></a>To predict this, the <span class="in">`r index('$predict_type', parent = "Learner", code = TRUE)`</span> field of a <span class="in">`r ref("LearnerRegr")`</span> must be changed from "response" (the default) to <span class="in">`"se"`</span> before training.</span>
<span id="cb183-382"><a href="#cb183-382" aria-hidden="true" tabindex="-1"></a>The <span class="in">`"rpart"`</span> learner we used above does not support predicting standard errors, so in the example below we will use a linear regression model (<span class="in">`lrn("regr.lm")`</span>).</span>
<span id="cb183-383"><a href="#cb183-383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-384"><a href="#cb183-384" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-033}</span></span>
<span id="cb183-385"><a href="#cb183-385" aria-hidden="true" tabindex="-1"></a><span class="in">library(mlr3learners)</span></span>
<span id="cb183-386"><a href="#cb183-386" aria-hidden="true" tabindex="-1"></a><span class="in">lrn_lm = lrn("regr.lm", predict_type = "se")</span></span>
<span id="cb183-387"><a href="#cb183-387" aria-hidden="true" tabindex="-1"></a><span class="in">lrn_lm$train(tsk_mtcars, splits$train)</span></span>
<span id="cb183-388"><a href="#cb183-388" aria-hidden="true" tabindex="-1"></a><span class="in">lrn_lm$predict(tsk_mtcars, splits$test)</span></span>
<span id="cb183-389"><a href="#cb183-389" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-390"><a href="#cb183-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-391"><a href="#cb183-391" aria-hidden="true" tabindex="-1"></a>Now the output includes an <span class="in">`se`</span> column as desired.</span>
<span id="cb183-392"><a href="#cb183-392" aria-hidden="true" tabindex="-1"></a>In @sec-basics-classif-learner we will see prediction types playing an even bigger role in the context of classification.</span>
<span id="cb183-393"><a href="#cb183-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-394"><a href="#cb183-394" aria-hidden="true" tabindex="-1"></a>Having covered the unified train/predict interface, we can now look at how to use hyperparameters to configure these methods for individual algorithms.</span>
<span id="cb183-395"><a href="#cb183-395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-396"><a href="#cb183-396" aria-hidden="true" tabindex="-1"></a><span class="fu">### Hyperparameters {#sec-param-set}</span></span>
<span id="cb183-397"><a href="#cb183-397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-398"><a href="#cb183-398" aria-hidden="true" tabindex="-1"></a><span class="in">`Learner`</span>s encapsulate a machine learning algorithm and its <span class="in">`r index('hyperparameters')`</span>, which affect *how* the algorithm is run and can be set by the user.</span>
<span id="cb183-399"><a href="#cb183-399" aria-hidden="true" tabindex="-1"></a>Hyperparameters may affect how a model is trained or how it makes predictions and deciding how to set hyperparameters can require expert knowledge.</span>
<span id="cb183-400"><a href="#cb183-400" aria-hidden="true" tabindex="-1"></a>Hyperparameters can be optimized automatically (@sec-optimization), but in this chapter we will focus on how to set them manually.</span>
<span id="cb183-401"><a href="#cb183-401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-402"><a href="#cb183-402" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Paradox and Parameter Sets</span></span>
<span id="cb183-403"><a href="#cb183-403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-404"><a href="#cb183-404" aria-hidden="true" tabindex="-1"></a>We will continue our running example with a regression tree learner.</span>
<span id="cb183-405"><a href="#cb183-405" aria-hidden="true" tabindex="-1"></a>To access the hyperparameters in the decision tree, we use <span class="in">`r index("$param_set", parent = "Learner", aside = TRUE, code = TRUE)`</span>:</span>
<span id="cb183-406"><a href="#cb183-406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-407"><a href="#cb183-407" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics}</span></span>
<span id="cb183-408"><a href="#cb183-408" aria-hidden="true" tabindex="-1"></a><span class="in">lrn_rpart$param_set</span></span>
<span id="cb183-409"><a href="#cb183-409" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-410"><a href="#cb183-410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-411"><a href="#cb183-411" aria-hidden="true" tabindex="-1"></a>The output above is a <span class="in">`r ref("ParamSet", aside = TRUE)`</span> object, supplied by the <span class="in">`r ref_pkg("paradox")`</span> package.</span>
<span id="cb183-412"><a href="#cb183-412" aria-hidden="true" tabindex="-1"></a>These objects provide information on hyperparameters including their name (<span class="in">`id`</span>), data type (<span class="in">`class`</span>), technically valid ranges for hyperparameter values (<span class="in">`lower`</span>, <span class="in">`upper`</span>), the number of levels possible if the data type is categorical (<span class="in">`nlevels`</span>), the default value from the underlying package (<span class="in">`default`</span>), and finally the set value (<span class="in">`value`</span>).</span>
<span id="cb183-413"><a href="#cb183-413" aria-hidden="true" tabindex="-1"></a>The second column references classes defined in <span class="in">`r ref_pkg("paradox")`</span> that determine the class of the parameter and the possible values it can take.</span>
<span id="cb183-414"><a href="#cb183-414" aria-hidden="true" tabindex="-1"></a>@tbl-parameters-classes lists the possible hyperparameter types, all of which inherit from <span class="in">`r ref("Param")`</span>.</span>
<span id="cb183-415"><a href="#cb183-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-416"><a href="#cb183-416" aria-hidden="true" tabindex="-1"></a>| Hyperparameter Class | Hyperparameter Type                          |</span>
<span id="cb183-417"><a href="#cb183-417" aria-hidden="true" tabindex="-1"></a>| -----------------  | ---------------------------------- |</span>
<span id="cb183-418"><a href="#cb183-418" aria-hidden="true" tabindex="-1"></a>| <span class="in">`r ref("ParamDbl", index = TRUE)`</span>  | Real-valued (numeric)     |</span>
<span id="cb183-419"><a href="#cb183-419" aria-hidden="true" tabindex="-1"></a>| <span class="in">`r ref("ParamInt", index = TRUE)`</span>  | Integer                   |</span>
<span id="cb183-420"><a href="#cb183-420" aria-hidden="true" tabindex="-1"></a>| <span class="in">`r ref("ParamFct", index = TRUE)`</span>  | Categorical (factor)      |</span>
<span id="cb183-421"><a href="#cb183-421" aria-hidden="true" tabindex="-1"></a>| <span class="in">`r ref("ParamLgl", index = TRUE)`</span>  | Logical / Boolean         |</span>
<span id="cb183-422"><a href="#cb183-422" aria-hidden="true" tabindex="-1"></a>| <span class="in">`r ref("ParamUty", index = TRUE)`</span>  | Untyped                   |</span>
<span id="cb183-423"><a href="#cb183-423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-424"><a href="#cb183-424" aria-hidden="true" tabindex="-1"></a>: Hyperparameter classes and the type of hyperparameter they represent. {#tbl-parameters-classes}</span>
<span id="cb183-425"><a href="#cb183-425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-426"><a href="#cb183-426" aria-hidden="true" tabindex="-1"></a>In our decision tree example, we can infer from the <span class="in">`ParamSet`</span> output that:</span>
<span id="cb183-427"><a href="#cb183-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-428"><a href="#cb183-428" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">`cp`</span> must be a "double" (<span class="in">`ParamDbl`</span>) taking values between <span class="in">`0`</span> (<span class="in">`lower`</span>) and <span class="in">`1`</span> (<span class="in">`upper`</span>) with a default of 0.01 (<span class="in">`default`</span>).</span>
<span id="cb183-429"><a href="#cb183-429" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">`keep_model`</span> must be a "logical" (<span class="in">`ParamLgl`</span>) taking values <span class="in">`TRUE`</span> or <span class="in">`FALSE`</span> with default <span class="in">`FALSE`</span></span>
<span id="cb183-430"><a href="#cb183-430" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">`xval`</span> must be an "integer" (<span class="in">`ParamInt`</span>) taking values between <span class="in">`0`</span> and <span class="in">`Inf`</span> with a default of <span class="in">`10`</span> and has a set value of <span class="in">`0`</span>.</span>
<span id="cb183-431"><a href="#cb183-431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-432"><a href="#cb183-432" aria-hidden="true" tabindex="-1"></a>In rare cases (we try to minimize it as much as possible), hyperparameters are initialized to values which deviate from the default in the underlying package.</span>
<span id="cb183-433"><a href="#cb183-433" aria-hidden="true" tabindex="-1"></a>When this happens, the reason will always be given in the learner help page.</span>
<span id="cb183-434"><a href="#cb183-434" aria-hidden="true" tabindex="-1"></a>In the case of <span class="in">`lrn("regr.rpart")`</span>, the <span class="in">`xval`</span> hyperparameter is initialized to <span class="in">`0`</span> because <span class="in">`xval`</span> controls internal cross-validations and if a user accidentally leaves this at the default <span class="in">`10`</span>, model training can take an unnecessarily long time.</span>
<span id="cb183-435"><a href="#cb183-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-436"><a href="#cb183-436" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Getting and Setting Hyperparameter Values</span></span>
<span id="cb183-437"><a href="#cb183-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-438"><a href="#cb183-438" aria-hidden="true" tabindex="-1"></a>Now we have looked at how hyperparameter sets are stored, we can think about getting and setting them.</span>
<span id="cb183-439"><a href="#cb183-439" aria-hidden="true" tabindex="-1"></a>Returning to our decision tree, say we are interested in growing a tree with depth <span class="in">`1`</span>, also known as a "decision stump", where data is split only once into two terminal nodes.</span>
<span id="cb183-440"><a href="#cb183-440" aria-hidden="true" tabindex="-1"></a>From the parameter set output, we know that the <span class="in">`maxdepth`</span> parameter has a default of <span class="in">`30`</span> and that it takes integer values.</span>
<span id="cb183-441"><a href="#cb183-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-442"><a href="#cb183-442" aria-hidden="true" tabindex="-1"></a>There are a few different ways we could change this hyperparameter.</span>
<span id="cb183-443"><a href="#cb183-443" aria-hidden="true" tabindex="-1"></a>The simplest way is during construction of the learner by passing the hyperparameter name and new value to <span class="in">`lrn()`</span>:</span>
<span id="cb183-444"><a href="#cb183-444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-447"><a href="#cb183-447" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-448"><a href="#cb183-448" aria-hidden="true" tabindex="-1"></a>lrn_rpart <span class="ot">=</span> <span class="fu">lrn</span>(<span class="st">"regr.rpart"</span>, <span class="at">maxdepth =</span> <span class="dv">1</span>)</span>
<span id="cb183-449"><a href="#cb183-449" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-450"><a href="#cb183-450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-451"><a href="#cb183-451" aria-hidden="true" tabindex="-1"></a>We can get a list of non-default hyperparameters (i.e., those that have been set) by using <span class="in">`$param_set$values`</span>:</span>
<span id="cb183-452"><a href="#cb183-452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-453"><a href="#cb183-453" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-027}</span></span>
<span id="cb183-454"><a href="#cb183-454" aria-hidden="true" tabindex="-1"></a><span class="in">lrn_rpart$param_set$values</span></span>
<span id="cb183-455"><a href="#cb183-455" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-456"><a href="#cb183-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-457"><a href="#cb183-457" aria-hidden="true" tabindex="-1"></a>Now we can see that <span class="in">`maxdepth = 1`</span> (as we discussed above <span class="in">`xval = 0`</span> is changed during construction) and the learned regression tree reflects this:</span>
<span id="cb183-458"><a href="#cb183-458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-461"><a href="#cb183-461" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-462"><a href="#cb183-462" aria-hidden="true" tabindex="-1"></a>lrn_rpart<span class="sc">$</span><span class="fu">train</span>(<span class="fu">tsk</span>(<span class="st">"mtcars"</span>))<span class="sc">$</span>model</span>
<span id="cb183-463"><a href="#cb183-463" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-464"><a href="#cb183-464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-465"><a href="#cb183-465" aria-hidden="true" tabindex="-1"></a>The <span class="in">`$values`</span> field simply returns a <span class="in">`list`</span> of set hyperparameters, so another way to update hyperparameters is by updating an element in the list:</span>
<span id="cb183-466"><a href="#cb183-466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-469"><a href="#cb183-469" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-470"><a href="#cb183-470" aria-hidden="true" tabindex="-1"></a>lrn_rpart<span class="sc">$</span>param_set<span class="sc">$</span>values<span class="sc">$</span>maxdepth <span class="ot">=</span> <span class="dv">2</span></span>
<span id="cb183-471"><a href="#cb183-471" aria-hidden="true" tabindex="-1"></a>lrn_rpart<span class="sc">$</span>param_set<span class="sc">$</span>values</span>
<span id="cb183-472"><a href="#cb183-472" aria-hidden="true" tabindex="-1"></a><span class="co"># now with depth 2</span></span>
<span id="cb183-473"><a href="#cb183-473" aria-hidden="true" tabindex="-1"></a>lrn_rpart<span class="sc">$</span><span class="fu">train</span>(<span class="fu">tsk</span>(<span class="st">"mtcars"</span>))<span class="sc">$</span>model</span>
<span id="cb183-474"><a href="#cb183-474" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-475"><a href="#cb183-475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-476"><a href="#cb183-476" aria-hidden="true" tabindex="-1"></a>To set multiple values at once we recommend either setting these during construction or using <span class="in">`r index("$set_values()", parent = "Learner", aside = TRUE, code = TRUE)`</span>, which updates the given hyperparameters (argument names) with the respective values.</span>
<span id="cb183-477"><a href="#cb183-477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-480"><a href="#cb183-480" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-481"><a href="#cb183-481" aria-hidden="true" tabindex="-1"></a>lrn_rpart <span class="ot">=</span> <span class="fu">lrn</span>(<span class="st">"regr.rpart"</span>, <span class="at">maxdepth =</span> <span class="dv">3</span>, <span class="at">xval =</span> <span class="dv">1</span>)</span>
<span id="cb183-482"><a href="#cb183-482" aria-hidden="true" tabindex="-1"></a>lrn_rpart<span class="sc">$</span>param_set<span class="sc">$</span>values</span>
<span id="cb183-483"><a href="#cb183-483" aria-hidden="true" tabindex="-1"></a><span class="co"># or with set_values</span></span>
<span id="cb183-484"><a href="#cb183-484" aria-hidden="true" tabindex="-1"></a>lrn_rpart<span class="sc">$</span>param_set<span class="sc">$</span><span class="fu">set_values</span>(<span class="at">xval =</span> <span class="dv">2</span>, <span class="at">cp =</span> <span class="fl">0.5</span>)</span>
<span id="cb183-485"><a href="#cb183-485" aria-hidden="true" tabindex="-1"></a>lrn_rpart<span class="sc">$</span>param_set<span class="sc">$</span>values</span>
<span id="cb183-486"><a href="#cb183-486" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-487"><a href="#cb183-487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-488"><a href="#cb183-488" aria-hidden="true" tabindex="-1"></a>:::{.callout-warning}</span>
<span id="cb183-489"><a href="#cb183-489" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-490"><a href="#cb183-490" aria-hidden="true" tabindex="-1"></a><span class="fu">## Setting Hyperparameters Using a `list`</span></span>
<span id="cb183-491"><a href="#cb183-491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-492"><a href="#cb183-492" aria-hidden="true" tabindex="-1"></a>As <span class="in">`lrn_rpart$param_set$values`</span> returns a <span class="in">`list`</span>, some users may be tempted to set hyperparameters by passing a new <span class="in">`list`</span> to <span class="in">`$values`</span> -- this would work but **we do not recommend it**.</span>
<span id="cb183-493"><a href="#cb183-493" aria-hidden="true" tabindex="-1"></a>This is because passing a <span class="in">`list`</span> will wipe any existing hyperparameter values if they are not included in the list.</span>
<span id="cb183-494"><a href="#cb183-494" aria-hidden="true" tabindex="-1"></a>For example:</span>
<span id="cb183-497"><a href="#cb183-497" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-498"><a href="#cb183-498" aria-hidden="true" tabindex="-1"></a><span class="co"># set xval and cp</span></span>
<span id="cb183-499"><a href="#cb183-499" aria-hidden="true" tabindex="-1"></a>lrn_rpart_params <span class="ot">=</span> <span class="fu">lrn</span>(<span class="st">"regr.rpart"</span>, <span class="at">xval =</span> <span class="dv">0</span>, <span class="at">cp =</span> <span class="dv">1</span>)</span>
<span id="cb183-500"><a href="#cb183-500" aria-hidden="true" tabindex="-1"></a><span class="co"># passing maxdepth through a list, removing all other values</span></span>
<span id="cb183-501"><a href="#cb183-501" aria-hidden="true" tabindex="-1"></a>lrn_rpart_params<span class="sc">$</span>param_set<span class="sc">$</span>values <span class="ot">=</span> <span class="fu">list</span>(<span class="at">maxdepth =</span> <span class="dv">1</span>)</span>
<span id="cb183-502"><a href="#cb183-502" aria-hidden="true" tabindex="-1"></a><span class="co"># we have removed xval and cp by mistake</span></span>
<span id="cb183-503"><a href="#cb183-503" aria-hidden="true" tabindex="-1"></a>lrn_rpart_params<span class="sc">$</span>param_set<span class="sc">$</span>values</span>
<span id="cb183-504"><a href="#cb183-504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-505"><a href="#cb183-505" aria-hidden="true" tabindex="-1"></a><span class="co"># now with set_values</span></span>
<span id="cb183-506"><a href="#cb183-506" aria-hidden="true" tabindex="-1"></a>lrn_rpart_params <span class="ot">=</span> <span class="fu">lrn</span>(<span class="st">"regr.rpart"</span>, <span class="at">xval =</span> <span class="dv">0</span>, <span class="at">cp =</span> <span class="dv">1</span>)</span>
<span id="cb183-507"><a href="#cb183-507" aria-hidden="true" tabindex="-1"></a>lrn_rpart_params<span class="sc">$</span>param_set<span class="sc">$</span><span class="fu">set_values</span>(<span class="at">maxdepth =</span> <span class="dv">1</span>)</span>
<span id="cb183-508"><a href="#cb183-508" aria-hidden="true" tabindex="-1"></a>lrn_rpart_params<span class="sc">$</span>param_set<span class="sc">$</span>values</span>
<span id="cb183-509"><a href="#cb183-509" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-510"><a href="#cb183-510" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb183-511"><a href="#cb183-511" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-512"><a href="#cb183-512" aria-hidden="true" tabindex="-1"></a>Whichever method you choose, all have safety checks to ensure your new values fall within the allowed parameter range:</span>
<span id="cb183-513"><a href="#cb183-513" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-514"><a href="#cb183-514" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, error=TRUE}</span></span>
<span id="cb183-515"><a href="#cb183-515" aria-hidden="true" tabindex="-1"></a><span class="in">lrn("regr.rpart", cp = 2, maxdepth = 2)</span></span>
<span id="cb183-516"><a href="#cb183-516" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-517"><a href="#cb183-517" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-518"><a href="#cb183-518" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Hyperparameter Dependencies</span></span>
<span id="cb183-519"><a href="#cb183-519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-520"><a href="#cb183-520" aria-hidden="true" tabindex="-1"></a>{{&lt; include ../../common/_optional.qmd &gt;}}</span>
<span id="cb183-521"><a href="#cb183-521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-522"><a href="#cb183-522" aria-hidden="true" tabindex="-1"></a>More complex hyperparameter spaces may include dependencies, which occur when setting a hyperparameter is conditional on the value of another hyperparameter; this is most important in the context of model tuning (@sec-optimization).</span>
<span id="cb183-523"><a href="#cb183-523" aria-hidden="true" tabindex="-1"></a>One such example is a <span class="in">`r index('support vector machine')`</span> (<span class="in">`lrn("regr.svm")`</span>).</span>
<span id="cb183-524"><a href="#cb183-524" aria-hidden="true" tabindex="-1"></a>The field <span class="in">`r index("$deps", parent = "ParamSet", code = TRUE)`</span> returns a <span class="in">`data.table`</span>, which lists the hyperparameter dependencies in the <span class="in">`Learner`</span>.</span>
<span id="cb183-525"><a href="#cb183-525" aria-hidden="true" tabindex="-1"></a>For example we can see that the <span class="in">`cost`</span> (<span class="in">`id`</span>-column) parameter is dependent on the <span class="in">`type`</span> (<span class="in">`on`</span>-column) parameter.</span>
<span id="cb183-526"><a href="#cb183-526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-529"><a href="#cb183-529" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-530"><a href="#cb183-530" aria-hidden="true" tabindex="-1"></a><span class="fu">lrn</span>(<span class="st">"regr.svm"</span>)<span class="sc">$</span>param_set<span class="sc">$</span>deps</span>
<span id="cb183-531"><a href="#cb183-531" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-532"><a href="#cb183-532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-533"><a href="#cb183-533" aria-hidden="true" tabindex="-1"></a>The <span class="in">`cond`</span> column tells us what the condition is, which will either mean that <span class="in">`id`</span> can be set if <span class="in">`on`</span> equals a single value (<span class="in">`r ref("CondEqual")`</span>) or any value in the listed set (<span class="in">`r ref("CondAnyOf")`</span>).</span>
<span id="cb183-534"><a href="#cb183-534" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-537"><a href="#cb183-537" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-538"><a href="#cb183-538" aria-hidden="true" tabindex="-1"></a><span class="fu">lrn</span>(<span class="st">"regr.svm"</span>)<span class="sc">$</span>param_set<span class="sc">$</span>deps[[<span class="dv">1</span>, <span class="st">"cond"</span>]]</span>
<span id="cb183-539"><a href="#cb183-539" aria-hidden="true" tabindex="-1"></a><span class="fu">lrn</span>(<span class="st">"regr.svm"</span>)<span class="sc">$</span>param_set<span class="sc">$</span>deps[[<span class="dv">3</span>, <span class="st">"cond"</span>]]</span>
<span id="cb183-540"><a href="#cb183-540" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-541"><a href="#cb183-541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-542"><a href="#cb183-542" aria-hidden="true" tabindex="-1"></a>This tells us that the parameter <span class="in">`cost`</span> should only be set if the <span class="in">`type`</span> parameter is one of <span class="in">`"eps-regression"`</span> or <span class="in">`"nu-regression"`</span>, and <span class="in">`degree`</span> should only be set if <span class="in">`kernel`</span> is equal to <span class="in">`"polynomial"`</span>.</span>
<span id="cb183-543"><a href="#cb183-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-544"><a href="#cb183-544" aria-hidden="true" tabindex="-1"></a>The <span class="in">`Learner`</span> will error if dependent hyperparameters are set when their conditions are not met:</span>
<span id="cb183-545"><a href="#cb183-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-546"><a href="#cb183-546" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, error=TRUE}</span></span>
<span id="cb183-547"><a href="#cb183-547" aria-hidden="true" tabindex="-1"></a><span class="in"># error as kernel is not polynomial</span></span>
<span id="cb183-548"><a href="#cb183-548" aria-hidden="true" tabindex="-1"></a><span class="in">lrn("regr.svm", kernel = "linear", degree = 1)</span></span>
<span id="cb183-549"><a href="#cb183-549" aria-hidden="true" tabindex="-1"></a><span class="in"># works because kernel is polynomial</span></span>
<span id="cb183-550"><a href="#cb183-550" aria-hidden="true" tabindex="-1"></a><span class="in">lrn("regr.svm", kernel = "polynomial", degree = 1)</span></span>
<span id="cb183-551"><a href="#cb183-551" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-552"><a href="#cb183-552" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-553"><a href="#cb183-553" aria-hidden="true" tabindex="-1"></a><span class="fu">### Baseline Learners {#sec-basics-featureless}</span></span>
<span id="cb183-554"><a href="#cb183-554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-555"><a href="#cb183-555" aria-hidden="true" tabindex="-1"></a>Before we move on to learner evaluation, we will highlight an important class of learners.</span>
<span id="cb183-556"><a href="#cb183-556" aria-hidden="true" tabindex="-1"></a>These are extremely simple or 'weak' learners known as <span class="in">`r index('baselines', aside = TRUE)`</span>.</span>
<span id="cb183-557"><a href="#cb183-557" aria-hidden="true" tabindex="-1"></a>Baselines are useful in model comparison (@sec-performance) and as fallback learners (@sec-encapsulation-fallback, @sec-fallback).</span>
<span id="cb183-558"><a href="#cb183-558" aria-hidden="true" tabindex="-1"></a>For regression, we have implemented the baseline <span class="in">`lrn("regr.featureless")`</span>, which always predicts new values to be the mean (or median, if the <span class="in">`robust`</span> hyperparameter is set to <span class="in">`TRUE`</span>) of the target in the training data:</span>
<span id="cb183-559"><a href="#cb183-559" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-562"><a href="#cb183-562" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-563"><a href="#cb183-563" aria-hidden="true" tabindex="-1"></a><span class="co"># generate data</span></span>
<span id="cb183-564"><a href="#cb183-564" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> <span class="fu">as_task_regr</span>(<span class="fu">data.frame</span>(<span class="at">x =</span> <span class="fu">runif</span>(<span class="dv">1000</span>), <span class="at">y =</span> <span class="fu">rnorm</span>(<span class="dv">1000</span>, <span class="dv">2</span>, <span class="dv">1</span>)),</span>
<span id="cb183-565"><a href="#cb183-565" aria-hidden="true" tabindex="-1"></a>  <span class="at">target =</span> <span class="st">"y"</span>)</span>
<span id="cb183-566"><a href="#cb183-566" aria-hidden="true" tabindex="-1"></a><span class="fu">lrn</span>(<span class="st">"regr.featureless"</span>)<span class="sc">$</span><span class="fu">train</span>(df, <span class="dv">1</span><span class="sc">:</span><span class="dv">995</span>)<span class="sc">$</span><span class="fu">predict</span>(df, <span class="dv">996</span><span class="sc">:</span><span class="dv">1000</span>)</span>
<span id="cb183-567"><a href="#cb183-567" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-568"><a href="#cb183-568" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-569"><a href="#cb183-569" aria-hidden="true" tabindex="-1"></a>It is good practice to test all new models against a baseline, and also to include baselines in experiments with multiple other models.</span>
<span id="cb183-570"><a href="#cb183-570" aria-hidden="true" tabindex="-1"></a>In general, a model that does not outperform a baseline is a 'bad' model, on the other hand, a model is not necessarily 'good' if it outperforms the baseline.</span>
<span id="cb183-571"><a href="#cb183-571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-572"><a href="#cb183-572" aria-hidden="true" tabindex="-1"></a><span class="fu">## Evaluation {#sec-eval}</span></span>
<span id="cb183-573"><a href="#cb183-573" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-574"><a href="#cb183-574" aria-hidden="true" tabindex="-1"></a>Perhaps *the most* important step of the applied machine learning workflow is evaluating model performance.</span>
<span id="cb183-575"><a href="#cb183-575" aria-hidden="true" tabindex="-1"></a>Without this, we would have no way to know if our trained model makes very accurate predictions, is worse than randomly guessing, or somewhere in between.</span>
<span id="cb183-576"><a href="#cb183-576" aria-hidden="true" tabindex="-1"></a>We will continue with our decision tree example to establish if the quality of our predictions is 'good', first we will rerun the above code so it is easier to follow along.</span>
<span id="cb183-577"><a href="#cb183-577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-580"><a href="#cb183-580" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-581"><a href="#cb183-581" aria-hidden="true" tabindex="-1"></a>lrn_rpart <span class="ot">=</span> <span class="fu">lrn</span>(<span class="st">"regr.rpart"</span>)</span>
<span id="cb183-582"><a href="#cb183-582" aria-hidden="true" tabindex="-1"></a>tsk_mtcars <span class="ot">=</span> <span class="fu">tsk</span>(<span class="st">"mtcars"</span>)</span>
<span id="cb183-583"><a href="#cb183-583" aria-hidden="true" tabindex="-1"></a>splits <span class="ot">=</span> <span class="fu">partition</span>(tsk_mtcars)</span>
<span id="cb183-584"><a href="#cb183-584" aria-hidden="true" tabindex="-1"></a>lrn_rpart<span class="sc">$</span><span class="fu">train</span>(tsk_mtcars, splits<span class="sc">$</span>train)</span>
<span id="cb183-585"><a href="#cb183-585" aria-hidden="true" tabindex="-1"></a>prediction <span class="ot">=</span> lrn_rpart<span class="sc">$</span><span class="fu">predict</span>(tsk_mtcars, splits<span class="sc">$</span>test)</span>
<span id="cb183-586"><a href="#cb183-586" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-587"><a href="#cb183-587" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-588"><a href="#cb183-588" aria-hidden="true" tabindex="-1"></a><span class="fu">### Measures</span></span>
<span id="cb183-589"><a href="#cb183-589" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-590"><a href="#cb183-590" aria-hidden="true" tabindex="-1"></a>The quality of predictions is evaluated using measures that compare them to the ground truth data for supervised learning tasks.</span>
<span id="cb183-591"><a href="#cb183-591" aria-hidden="true" tabindex="-1"></a>Similarly to <span class="in">`Task`</span>s and <span class="in">`Learner`</span>s, the available measures in <span class="in">`mlr3`</span> are stored in a dictionary called <span class="in">`r ref("mlr_measures", aside = TRUE)`</span> and can be accessed with <span class="in">`r index("msr()", "msr()/msrs()", aside = TRUE, code = TRUE)`</span>:</span>
<span id="cb183-592"><a href="#cb183-592" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-595"><a href="#cb183-595" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-596"><a href="#cb183-596" aria-hidden="true" tabindex="-1"></a><span class="fu">as.data.table</span>(<span class="fu">msr</span>())</span>
<span id="cb183-597"><a href="#cb183-597" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-598"><a href="#cb183-598" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-599"><a href="#cb183-599" aria-hidden="true" tabindex="-1"></a>All measures implemented in <span class="in">`mlr3`</span> are defined primarily by three components: 1) the function that defines the measure; 2) whether a lower or higher value is considered 'good'; and 3) the range of possible values the measure can take.</span>
<span id="cb183-600"><a href="#cb183-600" aria-hidden="true" tabindex="-1"></a>As well as these defining elements, other metadata are important to consider when selecting and using a <span class="in">`Measure`</span>, including if the measure has any special properties (e.g., requires training data), the type of predictions the measure can evaluate, and whether the measure has any 'control parameters'.</span>
<span id="cb183-601"><a href="#cb183-601" aria-hidden="true" tabindex="-1"></a>All this information is encapsulated in the <span class="in">`r ref("Measure", aside = TRUE)`</span> object.</span>
<span id="cb183-602"><a href="#cb183-602" aria-hidden="true" tabindex="-1"></a>By example, let us consider the <span class="in">`r index('mean absolute error')`</span> (MAE):</span>
<span id="cb183-603"><a href="#cb183-603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-606"><a href="#cb183-606" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-607"><a href="#cb183-607" aria-hidden="true" tabindex="-1"></a>measure <span class="ot">=</span> <span class="fu">msr</span>(<span class="st">"regr.mae"</span>)</span>
<span id="cb183-608"><a href="#cb183-608" aria-hidden="true" tabindex="-1"></a>measure</span>
<span id="cb183-609"><a href="#cb183-609" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-610"><a href="#cb183-610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-611"><a href="#cb183-611" aria-hidden="true" tabindex="-1"></a>This measure compares the absolute difference ('error') between true and predicted values: $f(y, \hat{y}) = | y - \hat{y} |$.</span>
<span id="cb183-612"><a href="#cb183-612" aria-hidden="true" tabindex="-1"></a>Lower values are considered better (<span class="in">`Minimize: TRUE`</span>), which is intuitive as we would like the true values, $y$, to be identical (or as close as possible) in value to the predicted values, $\hat{y}$.</span>
<span id="cb183-613"><a href="#cb183-613" aria-hidden="true" tabindex="-1"></a>We can see that the range of possible values the learner can take is from $0$ to $\infty$ (<span class="in">`Range: [0, Inf]`</span>), it has no special properties (<span class="in">`Properties: -`</span>), it evaluates <span class="in">`response`</span> type predictions for regression models (<span class="in">`Predict type: response`</span>), and it has no control parameters (<span class="in">`Parameters: list()`</span>).</span>
<span id="cb183-614"><a href="#cb183-614" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-615"><a href="#cb183-615" aria-hidden="true" tabindex="-1"></a>Now let us see how to use this measure for scoring our predictions.</span>
<span id="cb183-616"><a href="#cb183-616" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-617"><a href="#cb183-617" aria-hidden="true" tabindex="-1"></a><span class="fu">### Scoring Predictions</span></span>
<span id="cb183-618"><a href="#cb183-618" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-619"><a href="#cb183-619" aria-hidden="true" tabindex="-1"></a>Usually, supervised learning measures compare the difference between predicted values and the ground truth.</span>
<span id="cb183-620"><a href="#cb183-620" aria-hidden="true" tabindex="-1"></a><span class="in">`mlr3`</span> simplifies the process of bringing these quantities together by storing the predictions and true outcomes in the <span class="in">`r ref("Prediction", index = TRUE)`</span> object as we have already seen.</span>
<span id="cb183-621"><a href="#cb183-621" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-624"><a href="#cb183-624" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-625"><a href="#cb183-625" aria-hidden="true" tabindex="-1"></a>prediction</span>
<span id="cb183-626"><a href="#cb183-626" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-627"><a href="#cb183-627" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-628"><a href="#cb183-628" aria-hidden="true" tabindex="-1"></a>To calculate model performance, we simply call the <span class="in">`r index("$score()", parent = "Prediction", aside = TRUE, code = TRUE)`</span> method of a <span class="in">`Prediction`</span> object and pass as a single argument the measure that we want to compute:</span>
<span id="cb183-629"><a href="#cb183-629" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-632"><a href="#cb183-632" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-633"><a href="#cb183-633" aria-hidden="true" tabindex="-1"></a>prediction<span class="sc">$</span><span class="fu">score</span>(measure)</span>
<span id="cb183-634"><a href="#cb183-634" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-635"><a href="#cb183-635" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-636"><a href="#cb183-636" aria-hidden="true" tabindex="-1"></a>Note that all task types have default measures that are used if the argument to <span class="in">`$score()`</span> is omitted, for regression this is the mean squared error (<span class="in">`msr("regr.mse")`</span>), which is the squared difference between true and predicted values: $f(y, \hat{y}) = (y - \hat{y})^2$, averaged over the test set.</span>
<span id="cb183-637"><a href="#cb183-637" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-638"><a href="#cb183-638" aria-hidden="true" tabindex="-1"></a>It is possible to calculate multiple measures at the same time by passing multiple measures to <span class="in">`$score()`</span>.</span>
<span id="cb183-639"><a href="#cb183-639" aria-hidden="true" tabindex="-1"></a>For example, below we compute performance for mean squared error (<span class="in">`"regr.mse"`</span>) and mean absolute error (<span class="in">`"regr.mae"`</span>) -- note we use <span class="in">`r index("msrs()", "msr()/msrs()", aside = TRUE, code = TRUE)`</span> to load multiple measures at once.</span>
<span id="cb183-640"><a href="#cb183-640" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-641"><a href="#cb183-641" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-039}</span></span>
<span id="cb183-642"><a href="#cb183-642" aria-hidden="true" tabindex="-1"></a><span class="in">measures = msrs(c("regr.mse", "regr.mae"))</span></span>
<span id="cb183-643"><a href="#cb183-643" aria-hidden="true" tabindex="-1"></a><span class="in">prediction$score(measures)</span></span>
<span id="cb183-644"><a href="#cb183-644" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-645"><a href="#cb183-645" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-646"><a href="#cb183-646" aria-hidden="true" tabindex="-1"></a><span class="fu">### Technical Measures {#sec-basics-measures-tech}</span></span>
<span id="cb183-647"><a href="#cb183-647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-648"><a href="#cb183-648" aria-hidden="true" tabindex="-1"></a>{{&lt; include ../../common/_optional.qmd &gt;}}</span>
<span id="cb183-649"><a href="#cb183-649" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-650"><a href="#cb183-650" aria-hidden="true" tabindex="-1"></a><span class="in">`mlr3`</span> also provides measures that do not quantify the quality of the predictions of a model, but instead provide 'meta'-information about the model.</span>
<span id="cb183-651"><a href="#cb183-651" aria-hidden="true" tabindex="-1"></a>These include:</span>
<span id="cb183-652"><a href="#cb183-652" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-653"><a href="#cb183-653" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">`msr("time_train")`</span> -- The time taken to train a model.</span>
<span id="cb183-654"><a href="#cb183-654" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">`msr("time_predict")`</span> -- The time taken for the model to make predictions.</span>
<span id="cb183-655"><a href="#cb183-655" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">`msr("time_both")`</span> -- The total time taken to train the model and then make predictions.</span>
<span id="cb183-656"><a href="#cb183-656" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span><span class="in">`msr("selected_features")`</span> -- The number of features selected by a model, which can only be used if the model has the "selected_features" property.</span>
<span id="cb183-657"><a href="#cb183-657" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-658"><a href="#cb183-658" aria-hidden="true" tabindex="-1"></a>For example, we could score our decision tree to see how many seconds it took to train the model and make predictions:</span>
<span id="cb183-659"><a href="#cb183-659" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-662"><a href="#cb183-662" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-663"><a href="#cb183-663" aria-hidden="true" tabindex="-1"></a>measures <span class="ot">=</span> <span class="fu">msrs</span>(<span class="fu">c</span>(<span class="st">"time_train"</span>, <span class="st">"time_predict"</span>, <span class="st">"time_both"</span>))</span>
<span id="cb183-664"><a href="#cb183-664" aria-hidden="true" tabindex="-1"></a>prediction<span class="sc">$</span><span class="fu">score</span>(measures, <span class="at">learner =</span> lrn_rpart)</span>
<span id="cb183-665"><a href="#cb183-665" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-666"><a href="#cb183-666" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-667"><a href="#cb183-667" aria-hidden="true" tabindex="-1"></a>Notice a few key properties of these measures:</span>
<span id="cb183-668"><a href="#cb183-668" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-669"><a href="#cb183-669" aria-hidden="true" tabindex="-1"></a>1) <span class="in">`time_both`</span> is simply the sum of <span class="in">`time_train`</span> and <span class="in">`time_predict`</span>.</span>
<span id="cb183-670"><a href="#cb183-670" aria-hidden="true" tabindex="-1"></a>2) We had to pass <span class="in">`learner = lrn_rpart`</span> to <span class="in">`$score()`</span> as these measures have the <span class="in">`requires_learner`</span> property:</span>
<span id="cb183-671"><a href="#cb183-671" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-674"><a href="#cb183-674" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-675"><a href="#cb183-675" aria-hidden="true" tabindex="-1"></a><span class="fu">msr</span>(<span class="st">"time_train"</span>)<span class="sc">$</span>properties</span>
<span id="cb183-676"><a href="#cb183-676" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-677"><a href="#cb183-677" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-678"><a href="#cb183-678" aria-hidden="true" tabindex="-1"></a>3) These can be used after model training and predicting because we automatically store model run times whenever <span class="in">`$train()`</span> and <span class="in">`$predict()`</span> are called, so the measures above are equivalent to:</span>
<span id="cb183-679"><a href="#cb183-679" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-682"><a href="#cb183-682" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-683"><a href="#cb183-683" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(lrn_rpart<span class="sc">$</span>timings, <span class="at">both =</span> <span class="fu">sum</span>(lrn_rpart<span class="sc">$</span>timings))</span>
<span id="cb183-684"><a href="#cb183-684" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-685"><a href="#cb183-685" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-686"><a href="#cb183-686" aria-hidden="true" tabindex="-1"></a>The <span class="in">`selected_features`</span> measure calculates how many features were used in the fitted model.</span>
<span id="cb183-687"><a href="#cb183-687" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-690"><a href="#cb183-690" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-691"><a href="#cb183-691" aria-hidden="true" tabindex="-1"></a>msr_sf <span class="ot">=</span> <span class="fu">msr</span>(<span class="st">"selected_features"</span>)</span>
<span id="cb183-692"><a href="#cb183-692" aria-hidden="true" tabindex="-1"></a>msr_sf</span>
<span id="cb183-693"><a href="#cb183-693" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-694"><a href="#cb183-694" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-695"><a href="#cb183-695" aria-hidden="true" tabindex="-1"></a>We can see that this measure contains <span class="in">`r index('control parameters', aside = TRUE)`</span> (<span class="in">`Parameters: normalize=FALSE`</span>), which control how the measure is computed.</span>
<span id="cb183-696"><a href="#cb183-696" aria-hidden="true" tabindex="-1"></a>As with hyperparameters these can be accessed with <span class="in">`r index("$param_set", parent = "Measure", code = TRUE)`</span>:</span>
<span id="cb183-697"><a href="#cb183-697" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-700"><a href="#cb183-700" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-701"><a href="#cb183-701" aria-hidden="true" tabindex="-1"></a>msr_sf <span class="ot">=</span> <span class="fu">msr</span>(<span class="st">"selected_features"</span>)</span>
<span id="cb183-702"><a href="#cb183-702" aria-hidden="true" tabindex="-1"></a>msr_sf<span class="sc">$</span>param_set</span>
<span id="cb183-703"><a href="#cb183-703" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-704"><a href="#cb183-704" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-705"><a href="#cb183-705" aria-hidden="true" tabindex="-1"></a>The <span class="in">`normalize`</span> hyperparameter specifies whether the returned number of selected features should be normalized by the total number of features, this is useful if you are comparing this value across tasks with differing numbers of features.</span>
<span id="cb183-706"><a href="#cb183-706" aria-hidden="true" tabindex="-1"></a>We would change this parameter in the exact same way as we did with the learner above:</span>
<span id="cb183-707"><a href="#cb183-707" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-708"><a href="#cb183-708" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-measures-hp}</span></span>
<span id="cb183-709"><a href="#cb183-709" aria-hidden="true" tabindex="-1"></a><span class="in">msr_sf$param_set$values$normalize = TRUE</span></span>
<span id="cb183-710"><a href="#cb183-710" aria-hidden="true" tabindex="-1"></a><span class="in">prediction$score(msr_sf, task = tsk_mtcars, learner = lrn_rpart)</span></span>
<span id="cb183-711"><a href="#cb183-711" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-712"><a href="#cb183-712" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-713"><a href="#cb183-713" aria-hidden="true" tabindex="-1"></a>Note that we passed the task and learner as the measure has the <span class="in">`requires_task`</span> and <span class="in">`requires_learner`</span> properties.</span>
<span id="cb183-714"><a href="#cb183-714" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-715"><a href="#cb183-715" aria-hidden="true" tabindex="-1"></a><span class="fu">## Our First Regression Experiment {#sec-basics-regr-experiment}</span></span>
<span id="cb183-716"><a href="#cb183-716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-717"><a href="#cb183-717" aria-hidden="true" tabindex="-1"></a>We have now seen how to train a model, make predictions and score them.</span>
<span id="cb183-718"><a href="#cb183-718" aria-hidden="true" tabindex="-1"></a>What we have not yet attempted is to ascertain if our predictions are any 'good'.</span>
<span id="cb183-719"><a href="#cb183-719" aria-hidden="true" tabindex="-1"></a>So before look at how the building blocks of <span class="in">`mlr3`</span> extend to classification, we will take a brief pause to put together everything above in a short experiment to assess the quality of our predictions.</span>
<span id="cb183-720"><a href="#cb183-720" aria-hidden="true" tabindex="-1"></a>We will do this by comparing the performance of a featureless regression learner to a decision tree with changed hyperparameters.</span>
<span id="cb183-721"><a href="#cb183-721" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-724"><a href="#cb183-724" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-725"><a href="#cb183-725" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mlr3)</span>
<span id="cb183-726"><a href="#cb183-726" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">349</span>)</span>
<span id="cb183-727"><a href="#cb183-727" aria-hidden="true" tabindex="-1"></a><span class="co"># load and partition our task</span></span>
<span id="cb183-728"><a href="#cb183-728" aria-hidden="true" tabindex="-1"></a>tsk_mtcars <span class="ot">=</span> <span class="fu">tsk</span>(<span class="st">"mtcars"</span>)</span>
<span id="cb183-729"><a href="#cb183-729" aria-hidden="true" tabindex="-1"></a>splits <span class="ot">=</span> <span class="fu">partition</span>(tsk_mtcars)</span>
<span id="cb183-730"><a href="#cb183-730" aria-hidden="true" tabindex="-1"></a><span class="co"># load featureless learner</span></span>
<span id="cb183-731"><a href="#cb183-731" aria-hidden="true" tabindex="-1"></a>lrn_featureless <span class="ot">=</span> <span class="fu">lrn</span>(<span class="st">"regr.featureless"</span>)</span>
<span id="cb183-732"><a href="#cb183-732" aria-hidden="true" tabindex="-1"></a><span class="co"># load decision tree and set hyperparameters</span></span>
<span id="cb183-733"><a href="#cb183-733" aria-hidden="true" tabindex="-1"></a>lrn_rpart <span class="ot">=</span> <span class="fu">lrn</span>(<span class="st">"regr.rpart"</span>, <span class="at">cp =</span> <span class="fl">0.2</span>, <span class="at">maxdepth =</span> <span class="dv">5</span>)</span>
<span id="cb183-734"><a href="#cb183-734" aria-hidden="true" tabindex="-1"></a><span class="co"># load MSE and MAE measures</span></span>
<span id="cb183-735"><a href="#cb183-735" aria-hidden="true" tabindex="-1"></a>measures <span class="ot">=</span> <span class="fu">msrs</span>(<span class="fu">c</span>(<span class="st">"regr.mse"</span>, <span class="st">"regr.mae"</span>))</span>
<span id="cb183-736"><a href="#cb183-736" aria-hidden="true" tabindex="-1"></a><span class="co"># train learners</span></span>
<span id="cb183-737"><a href="#cb183-737" aria-hidden="true" tabindex="-1"></a>lrn_featureless<span class="sc">$</span><span class="fu">train</span>(tsk_mtcars, splits<span class="sc">$</span>train)</span>
<span id="cb183-738"><a href="#cb183-738" aria-hidden="true" tabindex="-1"></a>lrn_rpart<span class="sc">$</span><span class="fu">train</span>(tsk_mtcars, splits<span class="sc">$</span>train)</span>
<span id="cb183-739"><a href="#cb183-739" aria-hidden="true" tabindex="-1"></a><span class="co"># make and score predictions</span></span>
<span id="cb183-740"><a href="#cb183-740" aria-hidden="true" tabindex="-1"></a>lrn_featureless<span class="sc">$</span><span class="fu">predict</span>(tsk_mtcars, splits<span class="sc">$</span>test)<span class="sc">$</span><span class="fu">score</span>(measures)</span>
<span id="cb183-741"><a href="#cb183-741" aria-hidden="true" tabindex="-1"></a>lrn_rpart<span class="sc">$</span><span class="fu">predict</span>(tsk_mtcars, splits<span class="sc">$</span>test)<span class="sc">$</span><span class="fu">score</span>(measures)</span>
<span id="cb183-742"><a href="#cb183-742" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-743"><a href="#cb183-743" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-744"><a href="#cb183-744" aria-hidden="true" tabindex="-1"></a>Before starting the experiment we load the <span class="in">`mlr3`</span> library and set a seed.</span>
<span id="cb183-745"><a href="#cb183-745" aria-hidden="true" tabindex="-1"></a>We loaded the <span class="in">`mtcars`</span> task using <span class="in">`tsk()`</span> and then split this using <span class="in">`partition`</span> with the default 2/3 split.</span>
<span id="cb183-746"><a href="#cb183-746" aria-hidden="true" tabindex="-1"></a>Next, we loaded a featureless baseline learner (<span class="in">`"regr.featureless"`</span>) with the <span class="in">`lrn()`</span> function.</span>
<span id="cb183-747"><a href="#cb183-747" aria-hidden="true" tabindex="-1"></a>Then loaded a decision tree (<span class="in">`lrn("regr.rpart")`</span>) but changed the complexity parameter and max tree depth from their defaults.</span>
<span id="cb183-748"><a href="#cb183-748" aria-hidden="true" tabindex="-1"></a>We then used <span class="in">`msrs()`</span> to load multiple measures at once, the mean squared error (MSE: <span class="in">`regr.mse`</span>) and the mean absolute error (MAE: <span class="in">`regr.mae`</span>).</span>
<span id="cb183-749"><a href="#cb183-749" aria-hidden="true" tabindex="-1"></a>With all objects loaded, we trained our models, ensuring we passed the same training data to both.</span>
<span id="cb183-750"><a href="#cb183-750" aria-hidden="true" tabindex="-1"></a>Finally, we made predictions from our trained models and scored these.</span>
<span id="cb183-751"><a href="#cb183-751" aria-hidden="true" tabindex="-1"></a>For both MSE and MAE, lower values are 'better' (<span class="in">`Minimize: TRUE`</span>) and we can therefore conclude that our decision tree performs better than the featureless baseline.</span>
<span id="cb183-752"><a href="#cb183-752" aria-hidden="true" tabindex="-1"></a>In @sec-benchmarking we will see how to formalize comparison between models in a more efficient way using <span class="in">`r ref("benchmark()", index = TRUE)`</span>.</span>
<span id="cb183-753"><a href="#cb183-753" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-754"><a href="#cb183-754" aria-hidden="true" tabindex="-1"></a>Now we have put everything together you may notice that our learners and measures both have the <span class="in">`"regr."`</span> prefix, which is a handy way of reminding us that we are working with a regression task and therefore must make use of learners and measures built for regression.</span>
<span id="cb183-755"><a href="#cb183-755" aria-hidden="true" tabindex="-1"></a>In the next section, we will extend the building blocks of <span class="in">`mlr3`</span> to consider classification tasks, which make use of learners and measures with the <span class="in">`"classif."`</span> prefix.</span>
<span id="cb183-756"><a href="#cb183-756" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-757"><a href="#cb183-757" aria-hidden="true" tabindex="-1"></a><span class="fu">## Classification {#sec-classif}</span></span>
<span id="cb183-758"><a href="#cb183-758" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-759"><a href="#cb183-759" aria-hidden="true" tabindex="-1"></a><span class="in">`r index('Classification')`</span> problems are ones in which a model predicts a discrete, categorical target, as opposed to a continuous, numeric quantity.</span>
<span id="cb183-760"><a href="#cb183-760" aria-hidden="true" tabindex="-1"></a>For example, predicting the species of penguin from its physical characteristics would be a classification problem as there is a defined set of species.</span>
<span id="cb183-761"><a href="#cb183-761" aria-hidden="true" tabindex="-1"></a><span class="in">`mlr3`</span> ensures that the interface for all tasks is as similar as possible (if not identical) and therefore we will not repeat any content from the previous section but will just focus on differences that make classification a unique machine learning problem.</span>
<span id="cb183-762"><a href="#cb183-762" aria-hidden="true" tabindex="-1"></a>We will first demonstrate the similarities between regression and classification by performing an experiment very similar to the one in @sec-basics-regr-experiment, using code that will now be familiar to you.</span>
<span id="cb183-763"><a href="#cb183-763" aria-hidden="true" tabindex="-1"></a>We will then move to differences in tasks, learners and predictions, before looking at <span class="in">`r index('thresholding')`</span>, which is a method specific to classification.</span>
<span id="cb183-764"><a href="#cb183-764" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-765"><a href="#cb183-765" aria-hidden="true" tabindex="-1"></a><span class="fu">### Our First Classification Experiment {#sec-basics-classif-experiment}</span></span>
<span id="cb183-766"><a href="#cb183-766" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-767"><a href="#cb183-767" aria-hidden="true" tabindex="-1"></a>The interface for classification tasks, learners, and measures, is identical to the regression setting, except the underlying objects inherit from <span class="in">`r ref("TaskClassif", index = TRUE)`</span>, <span class="in">`r ref("LearnerClassif", index = TRUE)`</span>, and <span class="in">`r ref("MeasureClassif", index = TRUE)`</span>, respectively.</span>
<span id="cb183-768"><a href="#cb183-768" aria-hidden="true" tabindex="-1"></a>We can therefore run a very similar experiment to the one above.</span>
<span id="cb183-769"><a href="#cb183-769" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-772"><a href="#cb183-772" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-773"><a href="#cb183-773" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mlr3)</span>
<span id="cb183-774"><a href="#cb183-774" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">349</span>)</span>
<span id="cb183-775"><a href="#cb183-775" aria-hidden="true" tabindex="-1"></a><span class="co"># load and partition our task</span></span>
<span id="cb183-776"><a href="#cb183-776" aria-hidden="true" tabindex="-1"></a>tsk_penguins <span class="ot">=</span> <span class="fu">tsk</span>(<span class="st">"penguins"</span>)</span>
<span id="cb183-777"><a href="#cb183-777" aria-hidden="true" tabindex="-1"></a>splits <span class="ot">=</span> <span class="fu">partition</span>(tsk_penguins)</span>
<span id="cb183-778"><a href="#cb183-778" aria-hidden="true" tabindex="-1"></a><span class="co"># load featureless learner</span></span>
<span id="cb183-779"><a href="#cb183-779" aria-hidden="true" tabindex="-1"></a>lrn_featureless <span class="ot">=</span> <span class="fu">lrn</span>(<span class="st">"classif.featureless"</span>)</span>
<span id="cb183-780"><a href="#cb183-780" aria-hidden="true" tabindex="-1"></a><span class="co"># load decision tree and set hyperparameters</span></span>
<span id="cb183-781"><a href="#cb183-781" aria-hidden="true" tabindex="-1"></a>lrn_rpart <span class="ot">=</span> <span class="fu">lrn</span>(<span class="st">"classif.rpart"</span>, <span class="at">cp =</span> <span class="fl">0.2</span>, <span class="at">maxdepth =</span> <span class="dv">5</span>)</span>
<span id="cb183-782"><a href="#cb183-782" aria-hidden="true" tabindex="-1"></a><span class="co"># load accuracy measure</span></span>
<span id="cb183-783"><a href="#cb183-783" aria-hidden="true" tabindex="-1"></a>measure <span class="ot">=</span> <span class="fu">msr</span>(<span class="st">"classif.acc"</span>)</span>
<span id="cb183-784"><a href="#cb183-784" aria-hidden="true" tabindex="-1"></a><span class="co"># train learners</span></span>
<span id="cb183-785"><a href="#cb183-785" aria-hidden="true" tabindex="-1"></a>lrn_featureless<span class="sc">$</span><span class="fu">train</span>(tsk_penguins, splits<span class="sc">$</span>train)</span>
<span id="cb183-786"><a href="#cb183-786" aria-hidden="true" tabindex="-1"></a>lrn_rpart<span class="sc">$</span><span class="fu">train</span>(tsk_penguins, splits<span class="sc">$</span>train)</span>
<span id="cb183-787"><a href="#cb183-787" aria-hidden="true" tabindex="-1"></a><span class="co"># make and score predictions</span></span>
<span id="cb183-788"><a href="#cb183-788" aria-hidden="true" tabindex="-1"></a>lrn_featureless<span class="sc">$</span><span class="fu">predict</span>(tsk_penguins, splits<span class="sc">$</span>test)<span class="sc">$</span><span class="fu">score</span>(measure)</span>
<span id="cb183-789"><a href="#cb183-789" aria-hidden="true" tabindex="-1"></a>lrn_rpart<span class="sc">$</span><span class="fu">predict</span>(tsk_penguins, splits<span class="sc">$</span>test)<span class="sc">$</span><span class="fu">score</span>(measure)</span>
<span id="cb183-790"><a href="#cb183-790" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-791"><a href="#cb183-791" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-792"><a href="#cb183-792" aria-hidden="true" tabindex="-1"></a>In this experiment, we loaded the predefined task <span class="in">`penguins`</span>, which is based on the <span class="in">`r ref("palmerpenguins::penguins")`</span> dataset, then partitioned the data into training and test splits.</span>
<span id="cb183-793"><a href="#cb183-793" aria-hidden="true" tabindex="-1"></a>We loaded the featureless classification baseline (using the default which always predicts the most common class in the training data, but which also has the option of predicting (uniformly or weighted) random response values) and a classification decision tree, then the accuracy measure (number of correct predictions divided by total number of predictions), trained our models and finally made and scored predictions.</span>
<span id="cb183-794"><a href="#cb183-794" aria-hidden="true" tabindex="-1"></a>Once again we can be happy with our predictions, which are vastly more accurate than the baseline.</span>
<span id="cb183-795"><a href="#cb183-795" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-796"><a href="#cb183-796" aria-hidden="true" tabindex="-1"></a>Now that we have seen the similarities between classification and regression, we can turn to some key differences.</span>
<span id="cb183-797"><a href="#cb183-797" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-798"><a href="#cb183-798" aria-hidden="true" tabindex="-1"></a><span class="fu">### TaskClassif</span></span>
<span id="cb183-799"><a href="#cb183-799" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-800"><a href="#cb183-800" aria-hidden="true" tabindex="-1"></a>Classification tasks, objects inheriting from <span class="in">`r ref("TaskClassif", aside = TRUE)`</span>, are very similar to regression tasks, except that the target variable is of type factor and will have a limited number of possible classes/categories that observations can fall into.</span>
<span id="cb183-801"><a href="#cb183-801" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-802"><a href="#cb183-802" aria-hidden="true" tabindex="-1"></a>You can view the predefined classification tasks in <span class="in">`mlr3`</span> by filtering the <span class="in">`mlr_tasks`</span> dictionary:</span>
<span id="cb183-803"><a href="#cb183-803" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-806"><a href="#cb183-806" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-807"><a href="#cb183-807" aria-hidden="true" tabindex="-1"></a><span class="fu">as.data.table</span>(mlr_tasks)[task_type <span class="sc">==</span> <span class="st">"classif"</span>]</span>
<span id="cb183-808"><a href="#cb183-808" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-809"><a href="#cb183-809" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-810"><a href="#cb183-810" aria-hidden="true" tabindex="-1"></a>You can create your own task with <span class="in">`r ref("as_task_classif", aside = TRUE)`</span>.</span>
<span id="cb183-811"><a href="#cb183-811" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-814"><a href="#cb183-814" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-815"><a href="#cb183-815" aria-hidden="true" tabindex="-1"></a><span class="fu">as_task_classif</span>(palmerpenguins<span class="sc">::</span>penguins, <span class="at">target =</span> <span class="st">"species"</span>)</span>
<span id="cb183-816"><a href="#cb183-816" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-817"><a href="#cb183-817" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-818"><a href="#cb183-818" aria-hidden="true" tabindex="-1"></a>There are two types of classification tasks supported in <span class="in">`mlr3`</span>: binary classification\index{classification!binary}, in which the outcome can be one of two categories, and multiclass classification\index{classification!multiclass}, where the outcome can be one of three or more categories.</span>
<span id="cb183-819"><a href="#cb183-819" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-820"><a href="#cb183-820" aria-hidden="true" tabindex="-1"></a>The <span class="in">`sonar`</span> task is an example of a binary classification problem, as the target can only take two different values, in <span class="in">`mlr3`</span> terminology it has the "twoclass" property:</span>
<span id="cb183-821"><a href="#cb183-821" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-824"><a href="#cb183-824" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-825"><a href="#cb183-825" aria-hidden="true" tabindex="-1"></a>tsk_sonar <span class="ot">=</span> <span class="fu">tsk</span>(<span class="st">"sonar"</span>)</span>
<span id="cb183-826"><a href="#cb183-826" aria-hidden="true" tabindex="-1"></a>tsk_sonar</span>
<span id="cb183-827"><a href="#cb183-827" aria-hidden="true" tabindex="-1"></a>tsk_sonar<span class="sc">$</span>class_names</span>
<span id="cb183-828"><a href="#cb183-828" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-829"><a href="#cb183-829" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-830"><a href="#cb183-830" aria-hidden="true" tabindex="-1"></a>In contrast, <span class="in">`tsk("penguins")`</span> is a multiclass problem as there are more than two species of penguins; it has the "multiclass" property:</span>
<span id="cb183-831"><a href="#cb183-831" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-832"><a href="#cb183-832" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-041}</span></span>
<span id="cb183-833"><a href="#cb183-833" aria-hidden="true" tabindex="-1"></a><span class="in">tsk_penguins = tsk("penguins")</span></span>
<span id="cb183-834"><a href="#cb183-834" aria-hidden="true" tabindex="-1"></a><span class="in">tsk_penguins$properties</span></span>
<span id="cb183-835"><a href="#cb183-835" aria-hidden="true" tabindex="-1"></a><span class="in">tsk_penguins$class_names</span></span>
<span id="cb183-836"><a href="#cb183-836" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-837"><a href="#cb183-837" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-838"><a href="#cb183-838" aria-hidden="true" tabindex="-1"></a>A further difference between these tasks is that binary classification tasks have an extra field called <span class="in">`r index('$positive', parent = "TaskClassif", aside = TRUE, code = TRUE)`</span>, which defines the 'positive' class.</span>
<span id="cb183-839"><a href="#cb183-839" aria-hidden="true" tabindex="-1"></a>In binary classification, as there are only two possible class types, by convention one of these is known as the 'positive' class, and the other as the 'negative' class.</span>
<span id="cb183-840"><a href="#cb183-840" aria-hidden="true" tabindex="-1"></a>It is arbitrary which is which, though often the more 'important' (and often smaller) class is set as the positive class.</span>
<span id="cb183-841"><a href="#cb183-841" aria-hidden="true" tabindex="-1"></a>You can set the positive class during or after construction.</span>
<span id="cb183-842"><a href="#cb183-842" aria-hidden="true" tabindex="-1"></a>If no positive class is specified then <span class="in">`mlr3`</span> assumes the first level in the <span class="in">`target`</span> column is the positive class, which can lead to misleading results.</span>
<span id="cb183-843"><a href="#cb183-843" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-846"><a href="#cb183-846" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-847"><a href="#cb183-847" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the "Sonar" dataset from the "mlbench" package as an example</span></span>
<span id="cb183-848"><a href="#cb183-848" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Sonar, <span class="at">package =</span> <span class="st">"mlbench"</span>)</span>
<span id="cb183-849"><a href="#cb183-849" aria-hidden="true" tabindex="-1"></a><span class="co"># specifying the positive class:</span></span>
<span id="cb183-850"><a href="#cb183-850" aria-hidden="true" tabindex="-1"></a>tsk_classif <span class="ot">=</span> <span class="fu">as_task_classif</span>(Sonar, <span class="at">target =</span> <span class="st">"Class"</span>, <span class="at">positive =</span> <span class="st">"R"</span>)</span>
<span id="cb183-851"><a href="#cb183-851" aria-hidden="true" tabindex="-1"></a>tsk_classif<span class="sc">$</span>positive</span>
<span id="cb183-852"><a href="#cb183-852" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-853"><a href="#cb183-853" aria-hidden="true" tabindex="-1"></a><span class="co"># changing after construction</span></span>
<span id="cb183-854"><a href="#cb183-854" aria-hidden="true" tabindex="-1"></a>tsk_classif<span class="sc">$</span>positive <span class="ot">=</span> <span class="st">"M"</span></span>
<span id="cb183-855"><a href="#cb183-855" aria-hidden="true" tabindex="-1"></a>tsk_classif<span class="sc">$</span>positive</span>
<span id="cb183-856"><a href="#cb183-856" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-857"><a href="#cb183-857" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-858"><a href="#cb183-858" aria-hidden="true" tabindex="-1"></a>While the choice of positive and negative class is arbitrary, they are essential to ensuring results from models and performance measures are interpreted as expected -- this is best demonstrated when we discuss thresholding (@sec-classif-prediction) and ROC metrics (@sec-roc).</span>
<span id="cb183-859"><a href="#cb183-859" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-860"><a href="#cb183-860" aria-hidden="true" tabindex="-1"></a>Finally, plotting is possible with <span class="in">`r ref("autoplot.TaskClassif")`</span>, below we plot a comparison between the target column and features.</span>
<span id="cb183-861"><a href="#cb183-861" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-862"><a href="#cb183-862" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-043, warning = FALSE, message = FALSE, fig.height = 5}</span></span>
<span id="cb183-863"><a href="#cb183-863" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: fig-penguins-overview</span></span>
<span id="cb183-864"><a href="#cb183-864" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: Overview of part of the penguins dataset.</span></span>
<span id="cb183-865"><a href="#cb183-865" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-alt: Diagram showing the distribution of target and feature values for a subset of the penguins data. The 'Adelie' species has an even split between male/female, short bill length and average bill depth. The 'Chinstrap' species only come from the island 'Dream' and have a lower body mass. The 'Gentoo' species only come from the island 'Biscoe', and have a longer flipper length and higher body mass.</span></span>
<span id="cb183-866"><a href="#cb183-866" aria-hidden="true" tabindex="-1"></a><span class="in">library(ggplot2)</span></span>
<span id="cb183-867"><a href="#cb183-867" aria-hidden="true" tabindex="-1"></a><span class="in">autoplot(tsk("penguins"), type = "duo") +</span></span>
<span id="cb183-868"><a href="#cb183-868" aria-hidden="true" tabindex="-1"></a><span class="in">  theme(strip.text.y = element_text(angle = -45, size = 8))</span></span>
<span id="cb183-869"><a href="#cb183-869" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-870"><a href="#cb183-870" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-871"><a href="#cb183-871" aria-hidden="true" tabindex="-1"></a><span class="fu">### LearnerClassif and MeasureClassif {#sec-basics-classif-learner}</span></span>
<span id="cb183-872"><a href="#cb183-872" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-873"><a href="#cb183-873" aria-hidden="true" tabindex="-1"></a>Classification learners, which inherit from <span class="in">`r ref("LearnerClassif", aside = TRUE)`</span>, have nearly the same interface as regression learners.</span>
<span id="cb183-874"><a href="#cb183-874" aria-hidden="true" tabindex="-1"></a>However, a key difference is that the possible predictions in classification are either <span class="in">`"response"`</span> -- predicting an observation's class (a penguin's species in our example, this is sometimes called "hard labeling") -- or <span class="in">`"prob"`</span> -- predicting a vector of probabilities, also called "posterior probabilities", of an observation belonging to each class.</span>
<span id="cb183-875"><a href="#cb183-875" aria-hidden="true" tabindex="-1"></a>In classification, the latter can be more useful as it provides information about the confidence of the predictions:</span>
<span id="cb183-876"><a href="#cb183-876" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-877"><a href="#cb183-877" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-044}</span></span>
<span id="cb183-878"><a href="#cb183-878" aria-hidden="true" tabindex="-1"></a><span class="in">lrn_rpart = lrn("classif.rpart", predict_type = "prob")</span></span>
<span id="cb183-879"><a href="#cb183-879" aria-hidden="true" tabindex="-1"></a><span class="in">lrn_rpart$train(tsk_penguins, splits$train)</span></span>
<span id="cb183-880"><a href="#cb183-880" aria-hidden="true" tabindex="-1"></a><span class="in">prediction = lrn_rpart$predict(tsk_penguins, splits$test)</span></span>
<span id="cb183-881"><a href="#cb183-881" aria-hidden="true" tabindex="-1"></a><span class="in">prediction</span></span>
<span id="cb183-882"><a href="#cb183-882" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-883"><a href="#cb183-883" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-884"><a href="#cb183-884" aria-hidden="true" tabindex="-1"></a>Notice how the predictions include the predicted probabilities for all three classes, as well as the <span class="in">`response`</span>, which (by default) is the class with the highest predicted probability.</span>
<span id="cb183-885"><a href="#cb183-885" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-886"><a href="#cb183-886" aria-hidden="true" tabindex="-1"></a>Also, the interface for classification measures, which are of class <span class="in">`r ref('MeasureClassif', aside = TRUE)`</span>, is identical to regression measures.</span>
<span id="cb183-887"><a href="#cb183-887" aria-hidden="true" tabindex="-1"></a>The key difference in usage is that you will need to ensure your selected measure evaluates the prediction type of interest.<span class="in">`r index(NULL, "$predict_type", parent = "Measure", code = TRUE)`</span></span>
<span id="cb183-888"><a href="#cb183-888" aria-hidden="true" tabindex="-1"></a>To evaluate <span class="in">`"response"`</span> predictions, you will need measures with <span class="in">`predict_type = "response"`</span>, or to evaluate probability predictions you will need <span class="in">`predict_type = "prob"`</span>.</span>
<span id="cb183-889"><a href="#cb183-889" aria-hidden="true" tabindex="-1"></a>The easiest way to find these measures is by filtering the <span class="in">`r ref("mlr_measures")`</span> dictionary:</span>
<span id="cb183-890"><a href="#cb183-890" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-893"><a href="#cb183-893" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-894"><a href="#cb183-894" aria-hidden="true" tabindex="-1"></a><span class="fu">as.data.table</span>(<span class="fu">msr</span>())[</span>
<span id="cb183-895"><a href="#cb183-895" aria-hidden="true" tabindex="-1"></a>    task_type <span class="sc">==</span> <span class="st">"classif"</span> <span class="sc">&amp;</span> predict_type <span class="sc">==</span> <span class="st">"prob"</span> <span class="sc">&amp;</span></span>
<span id="cb183-896"><a href="#cb183-896" aria-hidden="true" tabindex="-1"></a>    <span class="sc">!</span><span class="fu">sapply</span>(task_properties, <span class="cf">function</span>(x) <span class="st">"twoclass"</span> <span class="sc">%in%</span> x)]</span>
<span id="cb183-897"><a href="#cb183-897" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-898"><a href="#cb183-898" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-899"><a href="#cb183-899" aria-hidden="true" tabindex="-1"></a>We also filtered to remove any measures that have the <span class="in">`"twoclass"`</span> property as this would conflict with our <span class="in">`"multiclass"`</span> task.</span>
<span id="cb183-900"><a href="#cb183-900" aria-hidden="true" tabindex="-1"></a>We need to use <span class="in">`sapply`</span> for this, the <span class="in">`task_properties`</span> column is a list column.</span>
<span id="cb183-901"><a href="#cb183-901" aria-hidden="true" tabindex="-1"></a>We can evaluate the quality of our probability predictions and response predictions simultaneously by providing multiple measures:</span>
<span id="cb183-902"><a href="#cb183-902" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-905"><a href="#cb183-905" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-906"><a href="#cb183-906" aria-hidden="true" tabindex="-1"></a>measures <span class="ot">=</span> <span class="fu">msrs</span>(<span class="fu">c</span>(<span class="st">"classif.mbrier"</span>, <span class="st">"classif.logloss"</span>, <span class="st">"classif.acc"</span>))</span>
<span id="cb183-907"><a href="#cb183-907" aria-hidden="true" tabindex="-1"></a>prediction<span class="sc">$</span><span class="fu">score</span>(measures)</span>
<span id="cb183-908"><a href="#cb183-908" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-909"><a href="#cb183-909" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-910"><a href="#cb183-910" aria-hidden="true" tabindex="-1"></a>The <span class="in">`r index('accuracy')`</span> measure evaluates the <span class="in">`"response"`</span> predictions whereas the <span class="in">`r index('Brier score', lower = FALSE)`</span> (<span class="in">`"classif.mbrier"`</span>, squared difference between predicted probabilities and the truth) and <span class="in">`r index('logloss')`</span> (<span class="in">`"classif.logloss"`</span>, negative logarithm of the predicted probability for the true class) are evaluating the probability predictions.</span>
<span id="cb183-911"><a href="#cb183-911" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-912"><a href="#cb183-912" aria-hidden="true" tabindex="-1"></a>If no measure is passed to <span class="in">`r index("$score()", parent = "Prediction", code = TRUE)`</span>, the default is the <span class="in">`r index('classification error')`</span> (<span class="in">`msr("classif.ce")`</span>), which is the number of misclassifications divided by the number of predictions, i.e., $1 -$ <span class="in">`msr("classif.acc")`</span>.</span>
<span id="cb183-913"><a href="#cb183-913" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-914"><a href="#cb183-914" aria-hidden="true" tabindex="-1"></a><span class="fu">### `PredictionClassif`, Confusion Matrix, and Thresholding {#sec-classif-prediction}</span></span>
<span id="cb183-915"><a href="#cb183-915" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-916"><a href="#cb183-916" aria-hidden="true" tabindex="-1"></a><span class="in">`r ref("PredictionClassif", aside = TRUE)`</span> objects have two important differences from their regression analog.</span>
<span id="cb183-917"><a href="#cb183-917" aria-hidden="true" tabindex="-1"></a>Firstly, the added field <span class="in">`$confusion`</span>, and secondly the added method <span class="in">`r index('$set_threshold()', parent = "PredictionClassif", code = TRUE)`</span>.</span>
<span id="cb183-918"><a href="#cb183-918" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-919"><a href="#cb183-919" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Confusion matrix {.unnumbered .unlisted}</span></span>
<span id="cb183-920"><a href="#cb183-920" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-921"><a href="#cb183-921" aria-hidden="true" tabindex="-1"></a>A <span class="in">`r index('confusion matrix', aside = TRUE)`</span> is a popular way to show the quality of classification (response) predictions in a more detailed fashion by seeing if a model is good at (mis)classifying observations in a particular class.</span>
<span id="cb183-922"><a href="#cb183-922" aria-hidden="true" tabindex="-1"></a>For binary and multiclass classification, the confusion matrix is stored in the <span class="in">`r index('$confusion', parent = "PredictionClassif", code = TRUE, aside = TRUE)`</span> field of the <span class="in">`r ref("PredictionClassif")`</span> object:</span>
<span id="cb183-923"><a href="#cb183-923" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-924"><a href="#cb183-924" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-049}</span></span>
<span id="cb183-925"><a href="#cb183-925" aria-hidden="true" tabindex="-1"></a><span class="in">prediction$confusion</span></span>
<span id="cb183-926"><a href="#cb183-926" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-927"><a href="#cb183-927" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-928"><a href="#cb183-928" aria-hidden="true" tabindex="-1"></a>The rows in a confusion matrix are the predicted class and the columns are the true class.</span>
<span id="cb183-929"><a href="#cb183-929" aria-hidden="true" tabindex="-1"></a>All off-diagonal entries are incorrectly classified observations, and all diagonal entries are correctly classified.</span>
<span id="cb183-930"><a href="#cb183-930" aria-hidden="true" tabindex="-1"></a>In this case, the classifier does fairly well classifying all penguins, but we could have found that it only classifies the Adelie species well but often conflates Chinstrap and Gentoo, for example.</span>
<span id="cb183-931"><a href="#cb183-931" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-932"><a href="#cb183-932" aria-hidden="true" tabindex="-1"></a>You can visualize the predicted class labels with <span class="in">`autoplot.PredictionClassif()`</span>.</span>
<span id="cb183-933"><a href="#cb183-933" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-936"><a href="#cb183-936" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-937"><a href="#cb183-937" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: false</span></span>
<span id="cb183-938"><a href="#cb183-938" aria-hidden="true" tabindex="-1"></a><span class="co">#| cache: false</span></span>
<span id="cb183-939"><a href="#cb183-939" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(prediction)</span>
<span id="cb183-940"><a href="#cb183-940" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-941"><a href="#cb183-941" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, out.width = "70%"}</span></span>
<span id="cb183-942"><a href="#cb183-942" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Counts of each class label in the ground truth data (left) and predictions (right)."</span></span>
<span id="cb183-943"><a href="#cb183-943" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-alt: "Two stacked bar plots. Bottom left corresponds to true number of Gentoo species (41), middle left is true Chinstrap (22) and top left is true Adelie (50). Bottom right is predicted number of Gentoo species (41), middle right is Chinstrap (20), and top right is Adelie (52)."</span></span>
<span id="cb183-944"><a href="#cb183-944" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: fig-basics-classlabels</span></span>
<span id="cb183-945"><a href="#cb183-945" aria-hidden="true" tabindex="-1"></a><span class="in">#| warning: false</span></span>
<span id="cb183-946"><a href="#cb183-946" aria-hidden="true" tabindex="-1"></a><span class="in">#| message: false</span></span>
<span id="cb183-947"><a href="#cb183-947" aria-hidden="true" tabindex="-1"></a><span class="in">#| echo: false</span></span>
<span id="cb183-948"><a href="#cb183-948" aria-hidden="true" tabindex="-1"></a><span class="in">plt = ggplot2::last_plot()</span></span>
<span id="cb183-949"><a href="#cb183-949" aria-hidden="true" tabindex="-1"></a><span class="in">plt = plt + ggplot2::scale_fill_manual(values = c("grey30", "grey50", "grey70"))</span></span>
<span id="cb183-950"><a href="#cb183-950" aria-hidden="true" tabindex="-1"></a><span class="in">print(plt)</span></span>
<span id="cb183-951"><a href="#cb183-951" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-952"><a href="#cb183-952" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-953"><a href="#cb183-953" aria-hidden="true" tabindex="-1"></a>In the binary classification case, the top left entry corresponds to <span class="in">`r index('true positives')`</span>, the top right to <span class="in">`r index('false positives')`</span>, the bottom left to <span class="in">`r index('false negatives')`</span> and the bottom right to <span class="in">`r index('true negatives')`</span>.</span>
<span id="cb183-954"><a href="#cb183-954" aria-hidden="true" tabindex="-1"></a>Taking <span class="in">`tsk_sonar`</span> as an example with ``r tsk_sonar$positive`` as the positive class:</span>
<span id="cb183-955"><a href="#cb183-955" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-958"><a href="#cb183-958" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-959"><a href="#cb183-959" aria-hidden="true" tabindex="-1"></a>splits <span class="ot">=</span> <span class="fu">partition</span>(tsk_sonar)</span>
<span id="cb183-960"><a href="#cb183-960" aria-hidden="true" tabindex="-1"></a>lrn_rpart<span class="sc">$</span></span>
<span id="cb183-961"><a href="#cb183-961" aria-hidden="true" tabindex="-1"></a>  <span class="fu">train</span>(tsk_sonar, splits<span class="sc">$</span>train)<span class="sc">$</span></span>
<span id="cb183-962"><a href="#cb183-962" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(tsk_sonar, splits<span class="sc">$</span>test)<span class="sc">$</span></span>
<span id="cb183-963"><a href="#cb183-963" aria-hidden="true" tabindex="-1"></a>  confusion</span>
<span id="cb183-964"><a href="#cb183-964" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-965"><a href="#cb183-965" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-966"><a href="#cb183-966" aria-hidden="true" tabindex="-1"></a>We will return to the concept of binary (mis)classification in greater detail in @sec-roc.</span>
<span id="cb183-967"><a href="#cb183-967" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-968"><a href="#cb183-968" aria-hidden="true" tabindex="-1"></a><span class="fu">#### Thresholding {.unnumbered .unlisted}</span></span>
<span id="cb183-969"><a href="#cb183-969" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-970"><a href="#cb183-970" aria-hidden="true" tabindex="-1"></a>The final big difference compared to regression we will discuss is <span class="in">`r index('thresholding', aside = TRUE)`</span>.</span>
<span id="cb183-971"><a href="#cb183-971" aria-hidden="true" tabindex="-1"></a>We saw previously that the default <span class="in">`response`</span> prediction type is the class with the highest predicted probability.</span>
<span id="cb183-972"><a href="#cb183-972" aria-hidden="true" tabindex="-1"></a>For <span class="in">`k`</span> classes with predicted probabilities $p_1,\dots,p_k$, this is the same as saying <span class="in">`response`</span> = argmax$<span class="sc">\{</span>p_1,\dots,p_k<span class="sc">\}</span>$.</span>
<span id="cb183-973"><a href="#cb183-973" aria-hidden="true" tabindex="-1"></a>If the maximum probability is not unique, i.e., multiple classes are predicted to have the highest probability, then the response is chosen randomly from these.</span>
<span id="cb183-974"><a href="#cb183-974" aria-hidden="true" tabindex="-1"></a>In binary classification, this means that the positive class will be selected if the predicted class is greater than 50%, and the negative class otherwise.</span>
<span id="cb183-975"><a href="#cb183-975" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-976"><a href="#cb183-976" aria-hidden="true" tabindex="-1"></a>This 50% value is known as the threshold and it can be useful to change this threshold if there is class imbalance (when one class is over- or under-represented in a dataset), or if there are different costs associated with classes, or simply if there is a preference to 'over'-predict one class.</span>
<span id="cb183-977"><a href="#cb183-977" aria-hidden="true" tabindex="-1"></a>As an example, let us take <span class="in">`tsk("german_credit")`</span> in which 700 customers have good credit and 300 have bad.</span>
<span id="cb183-978"><a href="#cb183-978" aria-hidden="true" tabindex="-1"></a>Now we could easily build a model with around "70%" accuracy simply by always predicting a customer will have good credit:</span>
<span id="cb183-979"><a href="#cb183-979" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-982"><a href="#cb183-982" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-983"><a href="#cb183-983" aria-hidden="true" tabindex="-1"></a>task_credit <span class="ot">=</span> <span class="fu">tsk</span>(<span class="st">"german_credit"</span>)</span>
<span id="cb183-984"><a href="#cb183-984" aria-hidden="true" tabindex="-1"></a>lrn_featureless <span class="ot">=</span> <span class="fu">lrn</span>(<span class="st">"classif.featureless"</span>, <span class="at">predict_type =</span> <span class="st">"prob"</span>)</span>
<span id="cb183-985"><a href="#cb183-985" aria-hidden="true" tabindex="-1"></a>split <span class="ot">=</span> <span class="fu">partition</span>(task_credit)</span>
<span id="cb183-986"><a href="#cb183-986" aria-hidden="true" tabindex="-1"></a>lrn_featureless<span class="sc">$</span><span class="fu">train</span>(task_credit, split<span class="sc">$</span>train)</span>
<span id="cb183-987"><a href="#cb183-987" aria-hidden="true" tabindex="-1"></a>prediction <span class="ot">=</span> lrn_featureless<span class="sc">$</span><span class="fu">predict</span>(task_credit, split<span class="sc">$</span>test)</span>
<span id="cb183-988"><a href="#cb183-988" aria-hidden="true" tabindex="-1"></a>prediction<span class="sc">$</span><span class="fu">score</span>(<span class="fu">msr</span>(<span class="st">"classif.acc"</span>))</span>
<span id="cb183-989"><a href="#cb183-989" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-990"><a href="#cb183-990" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-993"><a href="#cb183-993" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-994"><a href="#cb183-994" aria-hidden="true" tabindex="-1"></a><span class="co">#| output: false</span></span>
<span id="cb183-995"><a href="#cb183-995" aria-hidden="true" tabindex="-1"></a><span class="co">#| cache: false</span></span>
<span id="cb183-996"><a href="#cb183-996" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(prediction)</span>
<span id="cb183-997"><a href="#cb183-997" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-998"><a href="#cb183-998" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-999"><a href="#cb183-999" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, out.width = "70%"}</span></span>
<span id="cb183-1000"><a href="#cb183-1000" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Class labels ground truth (left) and predictions (right). The learner completely ignores the 'bad' class."</span></span>
<span id="cb183-1001"><a href="#cb183-1001" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-alt: "Two stacked bar plots. Bottom left corresponds to true number of 'good' customers (231) and top left is 'bad' customers (99). Right is a single bar corresponding to 330 'good' predictions, 'bad' is never predicted."</span></span>
<span id="cb183-1002"><a href="#cb183-1002" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: fig-basics-classlabels-german</span></span>
<span id="cb183-1003"><a href="#cb183-1003" aria-hidden="true" tabindex="-1"></a><span class="in">#| echo: false</span></span>
<span id="cb183-1004"><a href="#cb183-1004" aria-hidden="true" tabindex="-1"></a><span class="in">#| warning: false</span></span>
<span id="cb183-1005"><a href="#cb183-1005" aria-hidden="true" tabindex="-1"></a><span class="in">#| message: false</span></span>
<span id="cb183-1006"><a href="#cb183-1006" aria-hidden="true" tabindex="-1"></a><span class="in">plt = ggplot2::last_plot()</span></span>
<span id="cb183-1007"><a href="#cb183-1007" aria-hidden="true" tabindex="-1"></a><span class="in">plt = plt + ggplot2::scale_fill_manual(values = c("grey30", "grey50"))</span></span>
<span id="cb183-1008"><a href="#cb183-1008" aria-hidden="true" tabindex="-1"></a><span class="in">print(plt)</span></span>
<span id="cb183-1009"><a href="#cb183-1009" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-1010"><a href="#cb183-1010" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1011"><a href="#cb183-1011" aria-hidden="true" tabindex="-1"></a>While this model may appear to have good performance on the surface, in fact, it just ignores all 'bad' customers -- this can create big problems in this finance example, as well as in healthcare tasks and other settings where <span class="in">`r index('false positives')`</span> cost more than <span class="in">`r index('false negatives')`</span> (see @sec-cost-sens for cost-sensitive classification).</span>
<span id="cb183-1012"><a href="#cb183-1012" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1013"><a href="#cb183-1013" aria-hidden="true" tabindex="-1"></a>Thresholding allows classes to be selected with a different probability threshold, so instead of predicting that a customer has bad credit if P(good) &lt; 50%, we might predict bad credit if P(good) &lt; 70% -- notice how we write this in terms of the positive class, which in this task is 'good'.</span>
<span id="cb183-1014"><a href="#cb183-1014" aria-hidden="true" tabindex="-1"></a>Let us see this in practice:</span>
<span id="cb183-1015"><a href="#cb183-1015" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1018"><a href="#cb183-1018" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-1019"><a href="#cb183-1019" aria-hidden="true" tabindex="-1"></a>prediction<span class="sc">$</span><span class="fu">set_threshold</span>(<span class="fl">0.7</span>)</span>
<span id="cb183-1020"><a href="#cb183-1020" aria-hidden="true" tabindex="-1"></a>prediction<span class="sc">$</span><span class="fu">score</span>(<span class="fu">msr</span>(<span class="st">"classif.acc"</span>))</span>
<span id="cb183-1021"><a href="#cb183-1021" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-1022"><a href="#cb183-1022" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1025"><a href="#cb183-1025" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-1026"><a href="#cb183-1026" aria-hidden="true" tabindex="-1"></a>lrn_rpart <span class="ot">=</span> <span class="fu">lrn</span>(<span class="st">"classif.rpart"</span>, <span class="at">predict_type =</span> <span class="st">"prob"</span>)</span>
<span id="cb183-1027"><a href="#cb183-1027" aria-hidden="true" tabindex="-1"></a>lrn_rpart<span class="sc">$</span><span class="fu">train</span>(task_credit, split<span class="sc">$</span>train)</span>
<span id="cb183-1028"><a href="#cb183-1028" aria-hidden="true" tabindex="-1"></a>prediction <span class="ot">=</span> lrn_rpart<span class="sc">$</span><span class="fu">predict</span>(task_credit, split<span class="sc">$</span>test)</span>
<span id="cb183-1029"><a href="#cb183-1029" aria-hidden="true" tabindex="-1"></a>prediction<span class="sc">$</span><span class="fu">score</span>(<span class="fu">msr</span>(<span class="st">"classif.acc"</span>))</span>
<span id="cb183-1030"><a href="#cb183-1030" aria-hidden="true" tabindex="-1"></a>prediction<span class="sc">$</span>confusion</span>
<span id="cb183-1031"><a href="#cb183-1031" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1032"><a href="#cb183-1032" aria-hidden="true" tabindex="-1"></a>prediction<span class="sc">$</span><span class="fu">set_threshold</span>(<span class="fl">0.7</span>)</span>
<span id="cb183-1033"><a href="#cb183-1033" aria-hidden="true" tabindex="-1"></a>prediction<span class="sc">$</span><span class="fu">score</span>(<span class="fu">msr</span>(<span class="st">"classif.acc"</span>))</span>
<span id="cb183-1034"><a href="#cb183-1034" aria-hidden="true" tabindex="-1"></a>prediction<span class="sc">$</span>confusion</span>
<span id="cb183-1035"><a href="#cb183-1035" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-1036"><a href="#cb183-1036" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1037"><a href="#cb183-1037" aria-hidden="true" tabindex="-1"></a>While our model performs 'worse' overall, i.e. with lower accuracy, it is still a 'better' model as it more accurately captures the relationship between classes.</span>
<span id="cb183-1038"><a href="#cb183-1038" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1039"><a href="#cb183-1039" aria-hidden="true" tabindex="-1"></a>In the binary classification setting, <span class="in">`$set_threshold()`</span> only requires one numeric argument, which corresponds with the threshold for the positive class -- hence it is essential to ensure the positive class is correctly set in your task.</span>
<span id="cb183-1040"><a href="#cb183-1040" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1041"><a href="#cb183-1041" aria-hidden="true" tabindex="-1"></a>In multiclass classification, thresholding works by first assigning a threshold to each of the <span class="in">`n`</span> classes, dividing the predicted probabilities for each class by these thresholds to return <span class="in">`n`</span> ratios, and then the class with the highest ratio is selected.</span>
<span id="cb183-1042"><a href="#cb183-1042" aria-hidden="true" tabindex="-1"></a>For example, say we are predicting if a new observation will be of class A, B, C, or D and we have predicted $P(A = 0.2), P(B = 0.4), P(C = 0.1), P(D = 0.3)$.</span>
<span id="cb183-1043"><a href="#cb183-1043" aria-hidden="true" tabindex="-1"></a>We will assume that the threshold for all classes is identical and <span class="in">`1`</span>:</span>
<span id="cb183-1044"><a href="#cb183-1044" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1047"><a href="#cb183-1047" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-1048"><a href="#cb183-1048" aria-hidden="true" tabindex="-1"></a>probs <span class="ot">=</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.4</span>, <span class="fl">0.1</span>, <span class="fl">0.3</span>)</span>
<span id="cb183-1049"><a href="#cb183-1049" aria-hidden="true" tabindex="-1"></a>thresholds <span class="ot">=</span> <span class="fu">c</span>(<span class="at">A =</span> <span class="dv">1</span>, <span class="at">B =</span> <span class="dv">1</span>, <span class="at">C =</span> <span class="dv">1</span>, <span class="at">D =</span> <span class="dv">1</span>)</span>
<span id="cb183-1050"><a href="#cb183-1050" aria-hidden="true" tabindex="-1"></a>probs<span class="sc">/</span>thresholds</span>
<span id="cb183-1051"><a href="#cb183-1051" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-1052"><a href="#cb183-1052" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1053"><a href="#cb183-1053" aria-hidden="true" tabindex="-1"></a>We would therefore predict our observation is of class B as this is the highest ratio.</span>
<span id="cb183-1054"><a href="#cb183-1054" aria-hidden="true" tabindex="-1"></a>However, we could change our thresholds so that D has the lowest threshold and is most likely to be predicted, A has the highest threshold, and B and C have equal thresholds:</span>
<span id="cb183-1055"><a href="#cb183-1055" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1058"><a href="#cb183-1058" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-1059"><a href="#cb183-1059" aria-hidden="true" tabindex="-1"></a>thresholds <span class="ot">=</span> <span class="fu">c</span>(<span class="at">A =</span> <span class="fl">0.5</span>, <span class="at">B =</span> <span class="fl">0.25</span>, <span class="at">C =</span> <span class="fl">0.25</span>, <span class="at">D =</span> <span class="fl">0.1</span>)</span>
<span id="cb183-1060"><a href="#cb183-1060" aria-hidden="true" tabindex="-1"></a>probs<span class="sc">/</span>thresholds</span>
<span id="cb183-1061"><a href="#cb183-1061" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-1062"><a href="#cb183-1062" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1063"><a href="#cb183-1063" aria-hidden="true" tabindex="-1"></a>Now our observation will be predicted to be in class D.</span>
<span id="cb183-1064"><a href="#cb183-1064" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1065"><a href="#cb183-1065" aria-hidden="true" tabindex="-1"></a>In <span class="in">`mlr3`</span>, this is achieved by passing a named list to <span class="in">`$set_threshold()`</span>.</span>
<span id="cb183-1066"><a href="#cb183-1066" aria-hidden="true" tabindex="-1"></a>This is demonstrated below with <span class="in">`tsk("zoo")`</span>.</span>
<span id="cb183-1067"><a href="#cb183-1067" aria-hidden="true" tabindex="-1"></a>Before changing the thresholds, some classes are never predicted and some are predicted more often than they occur.</span>
<span id="cb183-1068"><a href="#cb183-1068" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1069"><a href="#cb183-1069" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-thresholding-3}</span></span>
<span id="cb183-1070"><a href="#cb183-1070" aria-hidden="true" tabindex="-1"></a><span class="in">#| label: fig-zoopreds</span></span>
<span id="cb183-1071"><a href="#cb183-1071" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-cap: "Comparing predicted and ground truth values for the zoo dataset."</span></span>
<span id="cb183-1072"><a href="#cb183-1072" aria-hidden="true" tabindex="-1"></a><span class="in">#| fig-alt: "Four stacked barplots comparing predictions before and after thresholding. Before thresholding some classes are over-predicted and some are never predicted. After thresholding there is still some imbalance but less drastic."</span></span>
<span id="cb183-1073"><a href="#cb183-1073" aria-hidden="true" tabindex="-1"></a><span class="in">library(ggplot2)</span></span>
<span id="cb183-1074"><a href="#cb183-1074" aria-hidden="true" tabindex="-1"></a><span class="in">library(patchwork)</span></span>
<span id="cb183-1075"><a href="#cb183-1075" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1076"><a href="#cb183-1076" aria-hidden="true" tabindex="-1"></a><span class="in">tsk_zoo = tsk("zoo")</span></span>
<span id="cb183-1077"><a href="#cb183-1077" aria-hidden="true" tabindex="-1"></a><span class="in">splits = partition(tsk_zoo)</span></span>
<span id="cb183-1078"><a href="#cb183-1078" aria-hidden="true" tabindex="-1"></a><span class="in">lrn_rpart = lrn("classif.rpart", predict_type = "prob")</span></span>
<span id="cb183-1079"><a href="#cb183-1079" aria-hidden="true" tabindex="-1"></a><span class="in">lrn_rpart$train(tsk_zoo, splits$train)</span></span>
<span id="cb183-1080"><a href="#cb183-1080" aria-hidden="true" tabindex="-1"></a><span class="in">prediction = lrn_rpart$predict(tsk_zoo, splits$test)</span></span>
<span id="cb183-1081"><a href="#cb183-1081" aria-hidden="true" tabindex="-1"></a><span class="in">before = autoplot(prediction) + ggtitle("Default thresholds")</span></span>
<span id="cb183-1082"><a href="#cb183-1082" aria-hidden="true" tabindex="-1"></a><span class="in">new_thresh = proportions(table(tsk_zoo$truth(splits$train)))</span></span>
<span id="cb183-1083"><a href="#cb183-1083" aria-hidden="true" tabindex="-1"></a><span class="in">new_thresh</span></span>
<span id="cb183-1084"><a href="#cb183-1084" aria-hidden="true" tabindex="-1"></a><span class="in">prediction$set_threshold(new_thresh)</span></span>
<span id="cb183-1085"><a href="#cb183-1085" aria-hidden="true" tabindex="-1"></a><span class="in">after = autoplot(prediction) + ggtitle("Inverse weighting thresholds")</span></span>
<span id="cb183-1086"><a href="#cb183-1086" aria-hidden="true" tabindex="-1"></a><span class="in">before + after + plot_layout(guides = "collect")</span></span>
<span id="cb183-1087"><a href="#cb183-1087" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-1088"><a href="#cb183-1088" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1089"><a href="#cb183-1089" aria-hidden="true" tabindex="-1"></a>Again we see that the model better represents all classes after thresholding.</span>
<span id="cb183-1090"><a href="#cb183-1090" aria-hidden="true" tabindex="-1"></a>In this example we set the new thresholds to be the proportions of each class in the training set.</span>
<span id="cb183-1091"><a href="#cb183-1091" aria-hidden="true" tabindex="-1"></a>This is known as <span class="in">`r index('inverse weighting')`</span>, as we divide the predicted probability by these class proportions before we select the label with the highest ratio.</span>
<span id="cb183-1092"><a href="#cb183-1092" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1093"><a href="#cb183-1093" aria-hidden="true" tabindex="-1"></a>In @sec-cost-sens we will look at <span class="in">`r index('cost-sensitive classification', "cost-sensitive", parent = "classification")`</span> where each cell in the confusion matrix has a different associated cost.</span>
<span id="cb183-1094"><a href="#cb183-1094" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1095"><a href="#cb183-1095" aria-hidden="true" tabindex="-1"></a><span class="fu">## Task Column Roles {#sec-row-col-roles}</span></span>
<span id="cb183-1096"><a href="#cb183-1096" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1097"><a href="#cb183-1097" aria-hidden="true" tabindex="-1"></a>{{&lt; include ../../common/_optional.qmd &gt;}}</span>
<span id="cb183-1098"><a href="#cb183-1098" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1099"><a href="#cb183-1099" aria-hidden="true" tabindex="-1"></a>Now that we have covered regression and classification, we will briefly return to tasks and in particular to <span class="in">`r index('column roles')`</span>, which are used to customize tasks further.</span>
<span id="cb183-1100"><a href="#cb183-1100" aria-hidden="true" tabindex="-1"></a>Column roles are used by <span class="in">`Task`</span> objects to define important metadata that can be used by learners and other objects to interact with the task.</span>
<span id="cb183-1101"><a href="#cb183-1101" aria-hidden="true" tabindex="-1"></a>True to their name, they assign particular roles to columns in the data, we have already seen some of these in action with targets and features.</span>
<span id="cb183-1102"><a href="#cb183-1102" aria-hidden="true" tabindex="-1"></a>There are seven column roles:</span>
<span id="cb183-1103"><a href="#cb183-1103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1104"><a href="#cb183-1104" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span><span class="in">`"feature"`</span>: Features used for prediction.</span>
<span id="cb183-1105"><a href="#cb183-1105" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span><span class="in">`"target"`</span>: Target variable to predict.</span>
<span id="cb183-1106"><a href="#cb183-1106" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span><span class="in">`"name"`</span>: Row names/observation labels, e.g., for <span class="in">`mtcars`</span> this is the <span class="in">`"model"`</span> column.</span>
<span id="cb183-1107"><a href="#cb183-1107" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span><span class="in">`"order"`</span>: Variable(s) used to order data returned by <span class="in">`$data()`</span>; must be sortable with <span class="in">`order()`</span>.</span>
<span id="cb183-1108"><a href="#cb183-1108" aria-hidden="true" tabindex="-1"></a><span class="ss">5. </span><span class="in">`"group"`</span>: Variable used to keep observations together during resampling.</span>
<span id="cb183-1109"><a href="#cb183-1109" aria-hidden="true" tabindex="-1"></a><span class="ss">6. </span><span class="in">`"stratum"`</span>: Variable(s) to stratify during resampling.</span>
<span id="cb183-1110"><a href="#cb183-1110" aria-hidden="true" tabindex="-1"></a><span class="ss">7. </span><span class="in">`"weight"`</span>: Observation weights. Only one numeric column may have this role.</span>
<span id="cb183-1111"><a href="#cb183-1111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1112"><a href="#cb183-1112" aria-hidden="true" tabindex="-1"></a>We have already seen how features and targets work in @sec-tasks, which are the only column roles that each task must have.</span>
<span id="cb183-1113"><a href="#cb183-1113" aria-hidden="true" tabindex="-1"></a>In @sec-strat-group we will have a look at the <span class="in">`stratum`</span> and <span class="in">`group`</span> column roles.</span>
<span id="cb183-1114"><a href="#cb183-1114" aria-hidden="true" tabindex="-1"></a>So, for now, we will only look at <span class="in">`order`</span>, and <span class="in">`weight`</span>.</span>
<span id="cb183-1115"><a href="#cb183-1115" aria-hidden="true" tabindex="-1"></a>We will not go into detail about <span class="in">`name`</span>, which is primarily used in plotting and will almost always be the <span class="in">`rownames()`</span> of the underlying data.</span>
<span id="cb183-1116"><a href="#cb183-1116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1117"><a href="#cb183-1117" aria-hidden="true" tabindex="-1"></a>Column roles are updated using <span class="in">`r index("$set_col_roles()", parent = "Task", code = TRUE)`</span>.</span>
<span id="cb183-1118"><a href="#cb183-1118" aria-hidden="true" tabindex="-1"></a>When we set the <span class="in">`"order"`</span> column role, the data is ordered according to that column(s).</span>
<span id="cb183-1119"><a href="#cb183-1119" aria-hidden="true" tabindex="-1"></a>In the following example, we set the <span class="in">`"order"`</span> column role and then order data by this column by including <span class="in">`ordered = TRUE`</span>:</span>
<span id="cb183-1120"><a href="#cb183-1120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1123"><a href="#cb183-1123" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-1124"><a href="#cb183-1124" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> <span class="fu">data.frame</span>(mtcars[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, ], <span class="at">idx =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">1</span>)</span>
<span id="cb183-1125"><a href="#cb183-1125" aria-hidden="true" tabindex="-1"></a>tsk_mtcars_order <span class="ot">=</span> <span class="fu">as_task_regr</span>(df, <span class="at">target =</span> <span class="st">"mpg"</span>)</span>
<span id="cb183-1126"><a href="#cb183-1126" aria-hidden="true" tabindex="-1"></a><span class="co"># original order</span></span>
<span id="cb183-1127"><a href="#cb183-1127" aria-hidden="true" tabindex="-1"></a>tsk_mtcars_order<span class="sc">$</span><span class="fu">data</span>(<span class="at">ordered =</span> <span class="cn">TRUE</span>)</span>
<span id="cb183-1128"><a href="#cb183-1128" aria-hidden="true" tabindex="-1"></a><span class="co"># order by "idx" column</span></span>
<span id="cb183-1129"><a href="#cb183-1129" aria-hidden="true" tabindex="-1"></a>tsk_mtcars_order<span class="sc">$</span><span class="fu">set_col_roles</span>(<span class="st">"idx"</span>, <span class="at">roles =</span> <span class="st">"order"</span>)</span>
<span id="cb183-1130"><a href="#cb183-1130" aria-hidden="true" tabindex="-1"></a>tsk_mtcars_order<span class="sc">$</span><span class="fu">data</span>(<span class="at">ordered =</span> <span class="cn">TRUE</span>)</span>
<span id="cb183-1131"><a href="#cb183-1131" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-1132"><a href="#cb183-1132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1133"><a href="#cb183-1133" aria-hidden="true" tabindex="-1"></a>In this example we can see that by setting <span class="in">`"idx"`</span> to have the <span class="in">`"order"`</span> column role, it is no longer used as a feature when we run <span class="in">`$data()`</span> but instead is used to order the observations according to its value.</span>
<span id="cb183-1134"><a href="#cb183-1134" aria-hidden="true" tabindex="-1"></a>This metadata is not passed to a learner.</span>
<span id="cb183-1135"><a href="#cb183-1135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1136"><a href="#cb183-1136" aria-hidden="true" tabindex="-1"></a>The <span class="in">`weights`</span> column role is used to weight data points differently.</span>
<span id="cb183-1137"><a href="#cb183-1137" aria-hidden="true" tabindex="-1"></a>One example of why we would do this is in classification tasks with severe class imbalance, where weighting the minority class more heavily may improve the model's predictive performance for that class.</span>
<span id="cb183-1138"><a href="#cb183-1138" aria-hidden="true" tabindex="-1"></a>For example in the <span class="in">`breast_cancer`</span> dataset, there are more instances of benign tumors than malignant tumors, so if we want to better predict malignant tumors we could weight the data in favor of this class:</span>
<span id="cb183-1139"><a href="#cb183-1139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1142"><a href="#cb183-1142" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb183-1143"><a href="#cb183-1143" aria-hidden="true" tabindex="-1"></a>cancer_unweighted <span class="ot">=</span> <span class="fu">tsk</span>(<span class="st">"breast_cancer"</span>)</span>
<span id="cb183-1144"><a href="#cb183-1144" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(cancer_unweighted<span class="sc">$</span><span class="fu">data</span>()<span class="sc">$</span>class)</span>
<span id="cb183-1145"><a href="#cb183-1145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1146"><a href="#cb183-1146" aria-hidden="true" tabindex="-1"></a><span class="co"># add column where weight is 2 if class "malignant", and 1 otherwise</span></span>
<span id="cb183-1147"><a href="#cb183-1147" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> cancer_unweighted<span class="sc">$</span><span class="fu">data</span>()</span>
<span id="cb183-1148"><a href="#cb183-1148" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>weights <span class="ot">=</span> <span class="fu">ifelse</span>(df<span class="sc">$</span>class <span class="sc">==</span> <span class="st">"malignant"</span>, <span class="dv">2</span>, <span class="dv">1</span>)</span>
<span id="cb183-1149"><a href="#cb183-1149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1150"><a href="#cb183-1150" aria-hidden="true" tabindex="-1"></a><span class="co"># create new task and role</span></span>
<span id="cb183-1151"><a href="#cb183-1151" aria-hidden="true" tabindex="-1"></a>cancer_weighted <span class="ot">=</span> <span class="fu">as_task_classif</span>(df, <span class="at">target =</span> <span class="st">"class"</span>)</span>
<span id="cb183-1152"><a href="#cb183-1152" aria-hidden="true" tabindex="-1"></a>cancer_weighted<span class="sc">$</span><span class="fu">set_col_roles</span>(<span class="st">"weights"</span>, <span class="at">roles =</span> <span class="st">"weight"</span>)</span>
<span id="cb183-1153"><a href="#cb183-1153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1154"><a href="#cb183-1154" aria-hidden="true" tabindex="-1"></a><span class="co"># compare weighted and unweighted predictions</span></span>
<span id="cb183-1155"><a href="#cb183-1155" aria-hidden="true" tabindex="-1"></a>split <span class="ot">=</span> <span class="fu">partition</span>(cancer_unweighted)</span>
<span id="cb183-1156"><a href="#cb183-1156" aria-hidden="true" tabindex="-1"></a>lrn_rf <span class="ot">=</span> <span class="fu">lrn</span>(<span class="st">"classif.ranger"</span>)</span>
<span id="cb183-1157"><a href="#cb183-1157" aria-hidden="true" tabindex="-1"></a>lrn_rf<span class="sc">$</span><span class="fu">train</span>(cancer_unweighted, split<span class="sc">$</span>train)<span class="sc">$</span></span>
<span id="cb183-1158"><a href="#cb183-1158" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(cancer_unweighted, split<span class="sc">$</span>test)<span class="sc">$</span><span class="fu">score</span>()</span>
<span id="cb183-1159"><a href="#cb183-1159" aria-hidden="true" tabindex="-1"></a>lrn_rf<span class="sc">$</span><span class="fu">train</span>(cancer_weighted, split<span class="sc">$</span>train)<span class="sc">$</span></span>
<span id="cb183-1160"><a href="#cb183-1160" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(cancer_weighted, split<span class="sc">$</span>test)<span class="sc">$</span><span class="fu">score</span>()</span>
<span id="cb183-1161"><a href="#cb183-1161" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-1162"><a href="#cb183-1162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1163"><a href="#cb183-1163" aria-hidden="true" tabindex="-1"></a>In this example, weighting improves the overall model performance (but see @sec-performance for more thorough comparison methods).</span>
<span id="cb183-1164"><a href="#cb183-1164" aria-hidden="true" tabindex="-1"></a>Not all models can handle weights in tasks so check a learner's properties to make sure this column role is being used as expected.</span>
<span id="cb183-1165"><a href="#cb183-1165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1166"><a href="#cb183-1166" aria-hidden="true" tabindex="-1"></a><span class="fu">## Supported Learning Algorithms {#sec-lrns-add}</span></span>
<span id="cb183-1167"><a href="#cb183-1167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1168"><a href="#cb183-1168" aria-hidden="true" tabindex="-1"></a><span class="in">`mlr3`</span> supports many learning algorithms (some with multiple implementations) as <span class="in">`Learner`</span>s.</span>
<span id="cb183-1169"><a href="#cb183-1169" aria-hidden="true" tabindex="-1"></a>These are primarily provided by the <span class="in">`r mlr3`</span>, <span class="in">`r mlr3learners`</span> and <span class="in">`r mlr3extralearners`</span> packages.</span>
<span id="cb183-1170"><a href="#cb183-1170" aria-hidden="true" tabindex="-1"></a>However, all packages that implement new tasks (@sec-special) also include a handful of simple algorithms.</span>
<span id="cb183-1171"><a href="#cb183-1171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1172"><a href="#cb183-1172" aria-hidden="true" tabindex="-1"></a>The list of learners included in <span class="in">`mlr3`</span> is deliberately small to avoid large sets of dependencies:</span>
<span id="cb183-1173"><a href="#cb183-1173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1174"><a href="#cb183-1174" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Featureless learners (<span class="in">`"regr.featureless"`</span>/<span class="in">`"classif.featureless"`</span>), which are baseline learners (@sec-basics-featureless).</span>
<span id="cb183-1175"><a href="#cb183-1175" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Debug learners (<span class="in">`"regr.debug"`</span>/<span class="in">`"classif.debug"`</span>), which are used to debug code (@sec-error-handling).</span>
<span id="cb183-1176"><a href="#cb183-1176" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Classification and regression trees (also known as CART: <span class="in">`"regr.rpart"`</span>/<span class="in">`"classif.rpart"`</span>).</span>
<span id="cb183-1177"><a href="#cb183-1177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1178"><a href="#cb183-1178" aria-hidden="true" tabindex="-1"></a>The <span class="in">`r mlr3learners`</span> package contains a selection of algorithms (and select implementations) chosen by the mlr team that we recommend as a good starting point for most experiments:</span>
<span id="cb183-1179"><a href="#cb183-1179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1180"><a href="#cb183-1180" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Linear (<span class="in">`"regr.lm"`</span>) and logistic (<span class="in">`"classif.log_reg"`</span>) regression\index{logistic regression}.</span>
<span id="cb183-1181"><a href="#cb183-1181" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Penalized generalized linear models, where the penalization is either exposed as a hyperparameter (<span class="in">`"regr.glmnet"`</span>/<span class="in">`"classif.glmnet"`</span>)\index{generalized linear model} or where it is optimized automatically (<span class="in">`"regr.cv_glmnet"`</span>/<span class="in">`"classif.cv_glmnet"`</span>).</span>
<span id="cb183-1182"><a href="#cb183-1182" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Weighted $k$-Nearest Neighbors\index{k-nearest neighbors} (<span class="in">`"regr.kknn"`</span>/<span class="in">`"classif.kknn"`</span>).</span>
<span id="cb183-1183"><a href="#cb183-1183" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Kriging / Gaussian process\index{Gaussian process} regression (<span class="in">`"regr.km"`</span>).</span>
<span id="cb183-1184"><a href="#cb183-1184" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Linear (<span class="in">`"classif.lda"`</span>) and quadratic (<span class="in">`"classif.qda"`</span>) discriminant analysis.</span>
<span id="cb183-1185"><a href="#cb183-1185" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Naïve Bayes classification (<span class="in">`"classif.naive_bayes"`</span>).</span>
<span id="cb183-1186"><a href="#cb183-1186" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Support-vector machines\index{support vector machine} (<span class="in">`"regr.svm"`</span>/<span class="in">`"classif.svm"`</span>).</span>
<span id="cb183-1187"><a href="#cb183-1187" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Gradient boosting\index{boosting} (<span class="in">`"regr.xgboost"`</span>/<span class="in">`"classif.xgboost"`</span>).</span>
<span id="cb183-1188"><a href="#cb183-1188" aria-hidden="true" tabindex="-1"></a><span class="ss">* </span>Random forests\index{random forest} for regression and classification (<span class="in">`"regr.ranger"`</span>/<span class="in">`"classif.ranger"`</span>).</span>
<span id="cb183-1189"><a href="#cb183-1189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1190"><a href="#cb183-1190" aria-hidden="true" tabindex="-1"></a>The majority of other supported learners are in <span class="in">`r mlr3extralearners`</span>.</span>
<span id="cb183-1191"><a href="#cb183-1191" aria-hidden="true" tabindex="-1"></a>You can find an up-to-date list of learners at <span class="in">`r link("https://mlr-org.com/learners.html")`</span>.</span>
<span id="cb183-1192"><a href="#cb183-1192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1193"><a href="#cb183-1193" aria-hidden="true" tabindex="-1"></a>The dictionary <span class="in">`r ref("mlr_learners", index = TRUE)`</span> contains learners that are supported in loaded packages:</span>
<span id="cb183-1194"><a href="#cb183-1194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1195"><a href="#cb183-1195" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-learners-list}</span></span>
<span id="cb183-1196"><a href="#cb183-1196" aria-hidden="true" tabindex="-1"></a><span class="in">learners_dt = as.data.table(mlr_learners)</span></span>
<span id="cb183-1197"><a href="#cb183-1197" aria-hidden="true" tabindex="-1"></a><span class="in">learners_dt</span></span>
<span id="cb183-1198"><a href="#cb183-1198" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-1199"><a href="#cb183-1199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1200"><a href="#cb183-1200" aria-hidden="true" tabindex="-1"></a>The resulting <span class="in">`data.table`</span> contains a lot of metadata that is useful for identifying learners with particular properties.</span>
<span id="cb183-1201"><a href="#cb183-1201" aria-hidden="true" tabindex="-1"></a>For example, we can list all learners that support classification problems:</span>
<span id="cb183-1202"><a href="#cb183-1202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1203"><a href="#cb183-1203" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-learners-list-regr}</span></span>
<span id="cb183-1204"><a href="#cb183-1204" aria-hidden="true" tabindex="-1"></a><span class="in">learners_dt[task_type == "classif"]</span></span>
<span id="cb183-1205"><a href="#cb183-1205" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-1206"><a href="#cb183-1206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1207"><a href="#cb183-1207" aria-hidden="true" tabindex="-1"></a>We can filter by multiple conditions, for example to list all regression learners that can predict standard errors:</span>
<span id="cb183-1208"><a href="#cb183-1208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1209"><a href="#cb183-1209" aria-hidden="true" tabindex="-1"></a><span class="in">```{r basics-learners-regr-se}</span></span>
<span id="cb183-1210"><a href="#cb183-1210" aria-hidden="true" tabindex="-1"></a><span class="in">learners_dt[task_type == "regr" &amp;</span></span>
<span id="cb183-1211"><a href="#cb183-1211" aria-hidden="true" tabindex="-1"></a><span class="in">  sapply(predict_types, function(x) "se" %in% x)]</span></span>
<span id="cb183-1212"><a href="#cb183-1212" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb183-1213"><a href="#cb183-1213" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1214"><a href="#cb183-1214" aria-hidden="true" tabindex="-1"></a><span class="fu">## Conclusion</span></span>
<span id="cb183-1215"><a href="#cb183-1215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1216"><a href="#cb183-1216" aria-hidden="true" tabindex="-1"></a>In this chapter, we covered the building blocks of <span class="in">`r mlr3`</span>.</span>
<span id="cb183-1217"><a href="#cb183-1217" aria-hidden="true" tabindex="-1"></a>We first introduced basic ML methodology and then showed how this is implemented in <span class="in">`mlr3`</span>.</span>
<span id="cb183-1218"><a href="#cb183-1218" aria-hidden="true" tabindex="-1"></a>We began by looking at the <span class="in">`r ref("Task")`</span> class, which is used to define machine learning tasks or problems to solve.</span>
<span id="cb183-1219"><a href="#cb183-1219" aria-hidden="true" tabindex="-1"></a>We then looked at the <span class="in">`r ref("Learner")`</span> class, which encapsulates machine learning algorithms, hyperparameters, and other meta-information.</span>
<span id="cb183-1220"><a href="#cb183-1220" aria-hidden="true" tabindex="-1"></a>Finally, we considered how to evaluate machine learning models with objects from the <span class="in">`r ref("Measure")`</span> class.</span>
<span id="cb183-1221"><a href="#cb183-1221" aria-hidden="true" tabindex="-1"></a>After looking at regression implementations, we extended all the above to the classification setting, before finally looking at some extra details about tasks and the learning algorithms that are implemented across <span class="in">`mlr3`</span>.</span>
<span id="cb183-1222"><a href="#cb183-1222" aria-hidden="true" tabindex="-1"></a>The rest of this book will build on the basic elements seen in this chapter, starting with more advanced model comparison methods in @sec-performance before moving on to improve model performance with automated hyperparameter tuning in @sec-optimization.</span>
<span id="cb183-1223"><a href="#cb183-1223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1224"><a href="#cb183-1224" aria-hidden="true" tabindex="-1"></a>| Class | Constructor/Function | Fields/Methods |</span>
<span id="cb183-1225"><a href="#cb183-1225" aria-hidden="true" tabindex="-1"></a>| --- | ----- | ------ |</span>
<span id="cb183-1226"><a href="#cb183-1226" aria-hidden="true" tabindex="-1"></a>| <span class="in">`r ref("Task")`</span> | <span class="in">`r ref("tsk()")`</span>/<span class="in">`r ref("tsks()")`</span>/<span class="in">`as_task_X`</span> | <span class="in">`$filter()`</span>; <span class="in">`$select()`</span>; <span class="in">`$data()`</span> |</span>
<span id="cb183-1227"><a href="#cb183-1227" aria-hidden="true" tabindex="-1"></a>| <span class="in">`r ref("Learner")`</span> | <span class="in">`r ref("lrn()")`</span>/<span class="in">`r ref("lrns()")`</span> | <span class="in">`$train()`</span>; <span class="in">`$predict()`</span>; <span class="in">`$predict_newdata()`</span>; <span class="in">`$model()`</span> |</span>
<span id="cb183-1228"><a href="#cb183-1228" aria-hidden="true" tabindex="-1"></a>| <span class="in">`r ref("Prediction")`</span> | <span class="in">`some_learner$predict()`</span> | <span class="in">`$score()`</span>; <span class="in">`$set_threshold()`</span>; <span class="in">`$confusion`</span> |</span>
<span id="cb183-1229"><a href="#cb183-1229" aria-hidden="true" tabindex="-1"></a>| <span class="in">`r ref("Measure")`</span> | <span class="in">`r ref("msr()")`</span>/<span class="in">`r ref("msrs()")`</span> | - |</span>
<span id="cb183-1230"><a href="#cb183-1230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1231"><a href="#cb183-1231" aria-hidden="true" tabindex="-1"></a>: Important classes and functions covered in this chapter with underlying class (if applicable), class constructor or function, and important class fields and methods (if applicable). {#tbl-basics-api}</span>
<span id="cb183-1232"><a href="#cb183-1232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1233"><a href="#cb183-1233" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercises</span></span>
<span id="cb183-1234"><a href="#cb183-1234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1235"><a href="#cb183-1235" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Train a classification model with the <span class="in">`classif.rpart`</span> learner on the "Pima Indians Diabetes" dataset.</span>
<span id="cb183-1236"><a href="#cb183-1236" aria-hidden="true" tabindex="-1"></a>  Do this without using <span class="in">`tsk("pima")`</span>, and instead by constructing a task from the dataset in the <span class="in">`mlbench`</span>-package: <span class="in">`data(PimaIndiansDiabetes2, package = "mlbench")`</span>.</span>
<span id="cb183-1237"><a href="#cb183-1237" aria-hidden="true" tabindex="-1"></a>  Make sure to define the <span class="in">`pos`</span> outcome as positive class.</span>
<span id="cb183-1238"><a href="#cb183-1238" aria-hidden="true" tabindex="-1"></a>  Train the model on a random 80% subset of the given data and evaluate its performance with the classification error measure on the remaining data.</span>
<span id="cb183-1239"><a href="#cb183-1239" aria-hidden="true" tabindex="-1"></a>  (Note that the data set has NAs in its features.</span>
<span id="cb183-1240"><a href="#cb183-1240" aria-hidden="true" tabindex="-1"></a>  You can either rely on <span class="in">`rpart`</span>'s capability to handle them internally ('surrogate splits') or remove them from the initial <span class="in">`data.frame`</span> by using <span class="in">`na.omit`</span>.</span>
<span id="cb183-1241"><a href="#cb183-1241" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Calculate the true positive, false positive, true negative, and false negative rates of the predictions made by the model in Exercise 1.</span>
<span id="cb183-1242"><a href="#cb183-1242" aria-hidden="true" tabindex="-1"></a>  Try to solve this in two ways: (a) Using <span class="in">`mlr3measures`</span>-predefined measure objects, and (b) without using <span class="in">`mlr3`</span> tools by directly working on the ground truth and prediction vectors.</span>
<span id="cb183-1243"><a href="#cb183-1243" aria-hidden="true" tabindex="-1"></a>  Compare the results.</span>
<span id="cb183-1244"><a href="#cb183-1244" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Change the threshold of the model from Exercise 1 such that the false positive rate is lower than the false negative rate.</span>
<span id="cb183-1245"><a href="#cb183-1245" aria-hidden="true" tabindex="-1"></a>  What is one reason you might do this in practice?</span>
<span id="cb183-1246"><a href="#cb183-1246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-1247"><a href="#cb183-1247" aria-hidden="true" tabindex="-1"></a>::: {.content-visible when-format="html"}</span>
<span id="cb183-1248"><a href="#cb183-1248" aria-hidden="true" tabindex="-1"></a><span class="in">`r citeas(chapter)`</span></span>
<span id="cb183-1249"><a href="#cb183-1249" aria-hidden="true" tabindex="-1"></a>:::</span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
<p>All content licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> <br> © Bernd Bischl, Raphael Sonabend, Lars Kotthoff, Michel Lang.</p>
</div>   
    <div class="nav-footer-center">
<p><a href="https://mlr-org.com">Website</a> | <a href="https://github.com/mlr-org/mlr3book">GitHub</a> | <a href="https://mlr-org.com/gallery">Gallery</a> | <a href="https://lmmisld-lmu-stats-slds.srv.mwn.de/mlr_invite/">Mattermost</a></p>
<div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/mlr-org/mlr3book/edit/main/book/chapters/chapter2/data_and_basic_modeling.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/mlr-org/mlr3book/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li><li><a href="https://github.com/mlr-org/mlr3book/blob/main/book/chapters/chapter2/data_and_basic_modeling.qmd" class="toc-action"><i class="bi empty"></i>View source</a></li></ul></div></div>
    <div class="nav-footer-right">
<p>Built with <a href="https://quarto.org/">Quarto</a>.</p>
</div>
  </div>
</footer>


<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>